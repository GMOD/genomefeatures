function En(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Do(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function ts(t){let e,n,i;t.length!==2?(e=En,n=(o,c)=>En(t(o),c),i=(o,c)=>t(o)-c):(e=t===En||t===Do?t:Mo,n=t,i=t);function r(o,c,f=0,h=o.length){if(f<h){if(e(c,c)!==0)return h;do{const m=f+h>>>1;n(o[m],c)<0?f=m+1:h=m}while(f<h)}return f}function a(o,c,f=0,h=o.length){if(f<h){if(e(c,c)!==0)return h;do{const m=f+h>>>1;n(o[m],c)<=0?f=m+1:h=m}while(f<h)}return f}function s(o,c,f=0,h=o.length){const m=r(o,c,f,h-1);return m>f&&i(o[m-1],c)>-i(o[m],c)?m-1:m}return{left:r,center:s,right:a}}function Mo(){return 0}function Oo(t){return t===null?NaN:+t}const Lo=ts(En),Ho=Lo.right;ts(Oo).center;const Co=Math.sqrt(50),Fo=Math.sqrt(10),zo=Math.sqrt(2);function Rn(t,e,n){const i=(e-t)/Math.max(0,n),r=Math.floor(Math.log10(i)),a=i/Math.pow(10,r),s=a>=Co?10:a>=Fo?5:a>=zo?2:1;let o,c,f;return r<0?(f=Math.pow(10,-r)/s,o=Math.round(t*f),c=Math.round(e*f),o/f<t&&++o,c/f>e&&--c,f=-f):(f=Math.pow(10,r)*s,o=Math.round(t/f),c=Math.round(e/f),o*f<t&&++o,c*f>e&&--c),c<o&&.5<=n&&n<2?Rn(t,e,n*2):[o,c,f]}function Bo(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const i=e<t,[r,a,s]=i?Rn(e,t,n):Rn(t,e,n);if(!(a>=r))return[];const o=a-r+1,c=new Array(o);if(i)if(s<0)for(let f=0;f<o;++f)c[f]=(a-f)/-s;else for(let f=0;f<o;++f)c[f]=(a-f)*s;else if(s<0)for(let f=0;f<o;++f)c[f]=(r+f)/-s;else for(let f=0;f<o;++f)c[f]=(r+f)*s;return c}function Ei(t,e,n){return e=+e,t=+t,n=+n,Rn(t,e,n)[2]}function Po(t,e,n){e=+e,t=+t,n=+n;const i=e<t,r=i?Ei(e,t,n):Ei(t,e,n);return(i?-1:1)*(r<0?1/-r:r)}function Go(t){return t}var Tn=1,ti=2,Ti=3,hn=4,Sr=1e-6;function Uo(t){return"translate("+t+",0)"}function Vo(t){return"translate(0,"+t+")"}function Zo(t){return e=>+t(e)}function qo(t,e){return e=Math.max(0,t.bandwidth()-e*2)/2,t.round()&&(e=Math.round(e)),n=>+t(n)+e}function Wo(){return!this.__axis}function es(t,e){var n=[],i=null,r=null,a=6,s=6,o=3,c=typeof window<"u"&&window.devicePixelRatio>1?0:.5,f=t===Tn||t===hn?-1:1,h=t===hn||t===ti?"x":"y",m=t===Tn||t===Ti?Uo:Vo;function p(_){var T=i??(e.ticks?e.ticks.apply(e,n):e.domain()),C=r??(e.tickFormat?e.tickFormat.apply(e,n):Go),I=Math.max(a,0)+o,N=e.range(),E=+N[0]+c,b=+N[N.length-1]+c,y=(e.bandwidth?qo:Zo)(e.copy(),c),S=_.selection?_.selection():_,D=S.selectAll(".domain").data([null]),k=S.selectAll(".tick").data(T,e).order(),F=k.exit(),z=k.enter().append("g").attr("class","tick"),L=k.select("line"),v=k.select("text");D=D.merge(D.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),k=k.merge(z),L=L.merge(z.append("line").attr("stroke","currentColor").attr(h+"2",f*a)),v=v.merge(z.append("text").attr("fill","currentColor").attr(h,f*I).attr("dy",t===Tn?"0em":t===Ti?"0.71em":"0.32em")),_!==S&&(D=D.transition(_),k=k.transition(_),L=L.transition(_),v=v.transition(_),F=F.transition(_).attr("opacity",Sr).attr("transform",function(Z){return isFinite(Z=y(Z))?m(Z+c):this.getAttribute("transform")}),z.attr("opacity",Sr).attr("transform",function(Z){var P=this.parentNode.__axis;return m((P&&isFinite(P=P(Z))?P:y(Z))+c)})),F.remove(),D.attr("d",t===hn||t===ti?s?"M"+f*s+","+E+"H"+c+"V"+b+"H"+f*s:"M"+c+","+E+"V"+b:s?"M"+E+","+f*s+"V"+c+"H"+b+"V"+f*s:"M"+E+","+c+"H"+b),k.attr("opacity",1).attr("transform",function(Z){return m(y(Z)+c)}),L.attr(h+"2",f*a),v.attr(h,f*I).text(C),S.filter(Wo).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===ti?"start":t===hn?"end":"middle"),S.each(function(){this.__axis=y})}return p.scale=function(_){return arguments.length?(e=_,p):e},p.ticks=function(){return n=Array.from(arguments),p},p.tickArguments=function(_){return arguments.length?(n=_==null?[]:Array.from(_),p):n.slice()},p.tickValues=function(_){return arguments.length?(i=_==null?null:Array.from(_),p):i&&i.slice()},p.tickFormat=function(_){return arguments.length?(r=_,p):r},p.tickSize=function(_){return arguments.length?(a=s=+_,p):a},p.tickSizeInner=function(_){return arguments.length?(a=+_,p):a},p.tickSizeOuter=function(_){return arguments.length?(s=+_,p):s},p.tickPadding=function(_){return arguments.length?(o=+_,p):o},p.offset=function(_){return arguments.length?(c=+_,p):c},p}function Ar(t){return es(Tn,t)}function Xo(t){return es(Ti,t)}var Ko={value:()=>{}};function ns(){for(var t=0,e=arguments.length,n={},i;t<e;++t){if(!(i=arguments[t]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new Sn(n)}function Sn(t){this._=t}function Yo(t,e){return t.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}Sn.prototype=ns.prototype={constructor:Sn,on:function(t,e){var n=this._,i=Yo(t+"",n),r,a=-1,s=i.length;if(arguments.length<2){for(;++a<s;)if((r=(t=i[a]).type)&&(r=Jo(n[r],t.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++a<s;)if(r=(t=i[a]).type)n[r]=Nr(n[r],t.name,e);else if(e==null)for(r in n)n[r]=Nr(n[r],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Sn(t)},call:function(t,e){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,a;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=this._[t],i=0,r=a.length;i<r;++i)a[i].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,a=i.length;r<a;++r)i[r].value.apply(e,n)}};function Jo(t,e){for(var n=0,i=t.length,r;n<i;++n)if((r=t[n]).name===e)return r.value}function Nr(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=Ko,t=t.slice(0,i).concat(t.slice(i+1));break}return n!=null&&t.push({name:e,value:n}),t}var Si="http://www.w3.org/1999/xhtml";const Ir={svg:"http://www.w3.org/2000/svg",xhtml:Si,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Kn(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),Ir.hasOwnProperty(e)?{space:Ir[e],local:t}:t}function Qo(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Si&&e.documentElement.namespaceURI===Si?e.createElement(t):e.createElementNS(n,t)}}function jo(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function is(t){var e=Kn(t);return(e.local?jo:Qo)(e)}function tl(){}function Qi(t){return t==null?tl:function(){return this.querySelector(t)}}function el(t){typeof t!="function"&&(t=Qi(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var a=e[r],s=a.length,o=i[r]=new Array(s),c,f,h=0;h<s;++h)(c=a[h])&&(f=t.call(c,c.__data__,h,a))&&("__data__"in c&&(f.__data__=c.__data__),o[h]=f);return new qt(i,this._parents)}function rs(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function nl(){return[]}function as(t){return t==null?nl:function(){return this.querySelectorAll(t)}}function il(t){return function(){return rs(t.apply(this,arguments))}}function rl(t){typeof t=="function"?t=il(t):t=as(t);for(var e=this._groups,n=e.length,i=[],r=[],a=0;a<n;++a)for(var s=e[a],o=s.length,c,f=0;f<o;++f)(c=s[f])&&(i.push(t.call(c,c.__data__,f,s)),r.push(c));return new qt(i,r)}function ss(t){return function(){return this.matches(t)}}function os(t){return function(e){return e.matches(t)}}var al=Array.prototype.find;function sl(t){return function(){return al.call(this.children,t)}}function ol(){return this.firstElementChild}function ll(t){return this.select(t==null?ol:sl(typeof t=="function"?t:os(t)))}var cl=Array.prototype.filter;function fl(){return Array.from(this.children)}function hl(t){return function(){return cl.call(this.children,t)}}function ul(t){return this.selectAll(t==null?fl:hl(typeof t=="function"?t:os(t)))}function dl(t){typeof t!="function"&&(t=ss(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var a=e[r],s=a.length,o=i[r]=[],c,f=0;f<s;++f)(c=a[f])&&t.call(c,c.__data__,f,a)&&o.push(c);return new qt(i,this._parents)}function ls(t){return new Array(t.length)}function pl(){return new qt(this._enter||this._groups.map(ls),this._parents)}function Dn(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Dn.prototype={constructor:Dn,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function _l(t){return function(){return t}}function gl(t,e,n,i,r,a){for(var s=0,o,c=e.length,f=a.length;s<f;++s)(o=e[s])?(o.__data__=a[s],i[s]=o):n[s]=new Dn(t,a[s]);for(;s<c;++s)(o=e[s])&&(r[s]=o)}function ml(t,e,n,i,r,a,s){var o,c,f=new Map,h=e.length,m=a.length,p=new Array(h),_;for(o=0;o<h;++o)(c=e[o])&&(p[o]=_=s.call(c,c.__data__,o,e)+"",f.has(_)?r[o]=c:f.set(_,c));for(o=0;o<m;++o)_=s.call(t,a[o],o,a)+"",(c=f.get(_))?(i[o]=c,c.__data__=a[o],f.delete(_)):n[o]=new Dn(t,a[o]);for(o=0;o<h;++o)(c=e[o])&&f.get(p[o])===c&&(r[o]=c)}function vl(t){return t.__data__}function wl(t,e){if(!arguments.length)return Array.from(this,vl);var n=e?ml:gl,i=this._parents,r=this._groups;typeof t!="function"&&(t=_l(t));for(var a=r.length,s=new Array(a),o=new Array(a),c=new Array(a),f=0;f<a;++f){var h=i[f],m=r[f],p=m.length,_=yl(t.call(h,h&&h.__data__,f,i)),T=_.length,C=o[f]=new Array(T),I=s[f]=new Array(T),N=c[f]=new Array(p);n(h,m,C,I,N,_,e);for(var E=0,b=0,y,S;E<T;++E)if(y=C[E]){for(E>=b&&(b=E+1);!(S=I[b])&&++b<T;);y._next=S||null}}return s=new qt(s,i),s._enter=o,s._exit=c,s}function yl(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function xl(){return new qt(this._exit||this._groups.map(ls),this._parents)}function bl(t,e,n){var i=this.enter(),r=this,a=this.exit();return typeof t=="function"?(i=t(i),i&&(i=i.selection())):i=i.append(t+""),e!=null&&(r=e(r),r&&(r=r.selection())),n==null?a.remove():n(a),i&&r?i.merge(r).order():r}function kl(t){for(var e=t.selection?t.selection():t,n=this._groups,i=e._groups,r=n.length,a=i.length,s=Math.min(r,a),o=new Array(r),c=0;c<s;++c)for(var f=n[c],h=i[c],m=f.length,p=o[c]=new Array(m),_,T=0;T<m;++T)(_=f[T]||h[T])&&(p[T]=_);for(;c<r;++c)o[c]=n[c];return new qt(o,this._parents)}function El(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i=t[e],r=i.length-1,a=i[r],s;--r>=0;)(s=i[r])&&(a&&s.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(s,a),a=s);return this}function Tl(t){t||(t=Sl);function e(m,p){return m&&p?t(m.__data__,p.__data__):!m-!p}for(var n=this._groups,i=n.length,r=new Array(i),a=0;a<i;++a){for(var s=n[a],o=s.length,c=r[a]=new Array(o),f,h=0;h<o;++h)(f=s[h])&&(c[h]=f);c.sort(e)}return new qt(r,this._parents).order()}function Sl(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Al(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function Nl(){return Array.from(this)}function Il(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,a=i.length;r<a;++r){var s=i[r];if(s)return s}return null}function $l(){let t=0;for(const e of this)++t;return t}function Rl(){return!this.node()}function Dl(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r=e[n],a=0,s=r.length,o;a<s;++a)(o=r[a])&&t.call(o,o.__data__,a,r);return this}function Ml(t){return function(){this.removeAttribute(t)}}function Ol(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Ll(t,e){return function(){this.setAttribute(t,e)}}function Hl(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Cl(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function Fl(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function zl(t,e){var n=Kn(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((e==null?n.local?Ol:Ml:typeof e=="function"?n.local?Fl:Cl:n.local?Hl:Ll)(n,e))}function cs(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Bl(t){return function(){this.style.removeProperty(t)}}function Pl(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Gl(t,e,n){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function Ul(t,e,n){return arguments.length>1?this.each((e==null?Bl:typeof e=="function"?Gl:Pl)(t,e,n??"")):Be(this.node(),t)}function Be(t,e){return t.style.getPropertyValue(e)||cs(t).getComputedStyle(t,null).getPropertyValue(e)}function Vl(t){return function(){delete this[t]}}function Zl(t,e){return function(){this[t]=e}}function ql(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function Wl(t,e){return arguments.length>1?this.each((e==null?Vl:typeof e=="function"?ql:Zl)(t,e)):this.node()[t]}function fs(t){return t.trim().split(/^|\s+/)}function ji(t){return t.classList||new hs(t)}function hs(t){this._node=t,this._names=fs(t.getAttribute("class")||"")}hs.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function us(t,e){for(var n=ji(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function ds(t,e){for(var n=ji(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function Xl(t){return function(){us(this,t)}}function Kl(t){return function(){ds(this,t)}}function Yl(t,e){return function(){(e.apply(this,arguments)?us:ds)(this,t)}}function Jl(t,e){var n=fs(t+"");if(arguments.length<2){for(var i=ji(this.node()),r=-1,a=n.length;++r<a;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof e=="function"?Yl:e?Xl:Kl)(n,e))}function Ql(){this.textContent=""}function jl(t){return function(){this.textContent=t}}function tc(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function ec(t){return arguments.length?this.each(t==null?Ql:(typeof t=="function"?tc:jl)(t)):this.node().textContent}function nc(){this.innerHTML=""}function ic(t){return function(){this.innerHTML=t}}function rc(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function ac(t){return arguments.length?this.each(t==null?nc:(typeof t=="function"?rc:ic)(t)):this.node().innerHTML}function sc(){this.nextSibling&&this.parentNode.appendChild(this)}function oc(){return this.each(sc)}function lc(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function cc(){return this.each(lc)}function fc(t){var e=typeof t=="function"?t:is(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function hc(){return null}function uc(t,e){var n=typeof t=="function"?t:is(t),i=e==null?hc:typeof e=="function"?e:Qi(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function dc(){var t=this.parentNode;t&&t.removeChild(this)}function pc(){return this.each(dc)}function _c(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function gc(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function mc(t){return this.select(t?gc:_c)}function vc(t){return arguments.length?this.property("__data__",t):this.node().__data__}function wc(t){return function(e){t.call(this,e,this.__data__)}}function yc(t){return t.trim().split(/^|\s+/).map(function(e){var n="",i=e.indexOf(".");return i>=0&&(n=e.slice(i+1),e=e.slice(0,i)),{type:e,name:n}})}function xc(t){return function(){var e=this.__on;if(e){for(var n=0,i=-1,r=e.length,a;n<r;++n)a=e[n],(!t.type||a.type===t.type)&&a.name===t.name?this.removeEventListener(a.type,a.listener,a.options):e[++i]=a;++i?e.length=i:delete this.__on}}}function bc(t,e,n){return function(){var i=this.__on,r,a=wc(e);if(i){for(var s=0,o=i.length;s<o;++s)if((r=i[s]).type===t.type&&r.name===t.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=a,r.options=n),r.value=e;return}}this.addEventListener(t.type,a,n),r={type:t.type,name:t.name,value:e,listener:a,options:n},i?i.push(r):this.__on=[r]}}function kc(t,e,n){var i=yc(t+""),r,a=i.length,s;if(arguments.length<2){var o=this.node().__on;if(o){for(var c=0,f=o.length,h;c<f;++c)for(r=0,h=o[c];r<a;++r)if((s=i[r]).type===h.type&&s.name===h.name)return h.value}return}for(o=e?bc:xc,r=0;r<a;++r)this.each(o(i[r],e,n));return this}function ps(t,e,n){var i=cs(t),r=i.CustomEvent;typeof r=="function"?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function Ec(t,e){return function(){return ps(this,t,e)}}function Tc(t,e){return function(){return ps(this,t,e.apply(this,arguments))}}function Sc(t,e){return this.each((typeof e=="function"?Tc:Ec)(t,e))}function*Ac(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,a=i.length,s;r<a;++r)(s=i[r])&&(yield s)}var tr=[null];function qt(t,e){this._groups=t,this._parents=e}function Re(){return new qt([[document.documentElement]],tr)}function Nc(){return this}qt.prototype=Re.prototype={constructor:qt,select:el,selectAll:rl,selectChild:ll,selectChildren:ul,filter:dl,data:wl,enter:pl,exit:xl,join:bl,merge:kl,selection:Nc,order:El,sort:Tl,call:Al,nodes:Nl,node:Il,size:$l,empty:Rl,each:Dl,attr:zl,style:Ul,property:Wl,classed:Jl,text:ec,html:ac,raise:oc,lower:cc,append:fc,insert:uc,remove:pc,clone:mc,datum:vc,on:kc,dispatch:Sc,[Symbol.iterator]:Ac};function Ot(t){return typeof t=="string"?new qt([[document.querySelector(t)]],[document.documentElement]):new qt([[t]],tr)}function ee(t){return typeof t=="string"?new qt([document.querySelectorAll(t)],[document.documentElement]):new qt([rs(t)],tr)}function er(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function _s(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function ln(){}var tn=.7,Mn=1/tn,Fe="\\s*([+-]?\\d+)\\s*",en="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",oe="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ic=/^#([0-9a-f]{3,8})$/,$c=new RegExp(`^rgb\\(${Fe},${Fe},${Fe}\\)$`),Rc=new RegExp(`^rgb\\(${oe},${oe},${oe}\\)$`),Dc=new RegExp(`^rgba\\(${Fe},${Fe},${Fe},${en}\\)$`),Mc=new RegExp(`^rgba\\(${oe},${oe},${oe},${en}\\)$`),Oc=new RegExp(`^hsl\\(${en},${oe},${oe}\\)$`),Lc=new RegExp(`^hsla\\(${en},${oe},${oe},${en}\\)$`),$r={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};er(ln,Ae,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Rr,formatHex:Rr,formatHex8:Hc,formatHsl:Cc,formatRgb:Dr,toString:Dr});function Rr(){return this.rgb().formatHex()}function Hc(){return this.rgb().formatHex8()}function Cc(){return gs(this).formatHsl()}function Dr(){return this.rgb().formatRgb()}function Ae(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Ic.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?Mr(e):n===3?new Xt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?un(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?un(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=$c.exec(t))?new Xt(e[1],e[2],e[3],1):(e=Rc.exec(t))?new Xt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Dc.exec(t))?un(e[1],e[2],e[3],e[4]):(e=Mc.exec(t))?un(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Oc.exec(t))?Hr(e[1],e[2]/100,e[3]/100,1):(e=Lc.exec(t))?Hr(e[1],e[2]/100,e[3]/100,e[4]):$r.hasOwnProperty(t)?Mr($r[t]):t==="transparent"?new Xt(NaN,NaN,NaN,0):null}function Mr(t){return new Xt(t>>16&255,t>>8&255,t&255,1)}function un(t,e,n,i){return i<=0&&(t=e=n=NaN),new Xt(t,e,n,i)}function Fc(t){return t instanceof ln||(t=Ae(t)),t?(t=t.rgb(),new Xt(t.r,t.g,t.b,t.opacity)):new Xt}function Ai(t,e,n,i){return arguments.length===1?Fc(t):new Xt(t,e,n,i??1)}function Xt(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}er(Xt,Ai,_s(ln,{brighter(t){return t=t==null?Mn:Math.pow(Mn,t),new Xt(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?tn:Math.pow(tn,t),new Xt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Xt(Te(this.r),Te(this.g),Te(this.b),On(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Or,formatHex:Or,formatHex8:zc,formatRgb:Lr,toString:Lr}));function Or(){return`#${ke(this.r)}${ke(this.g)}${ke(this.b)}`}function zc(){return`#${ke(this.r)}${ke(this.g)}${ke(this.b)}${ke((isNaN(this.opacity)?1:this.opacity)*255)}`}function Lr(){const t=On(this.opacity);return`${t===1?"rgb(":"rgba("}${Te(this.r)}, ${Te(this.g)}, ${Te(this.b)}${t===1?")":`, ${t})`}`}function On(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Te(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function ke(t){return t=Te(t),(t<16?"0":"")+t.toString(16)}function Hr(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new ie(t,e,n,i)}function gs(t){if(t instanceof ie)return new ie(t.h,t.s,t.l,t.opacity);if(t instanceof ln||(t=Ae(t)),!t)return new ie;if(t instanceof ie)return t;t=t.rgb();var e=t.r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),a=Math.max(e,n,i),s=NaN,o=a-r,c=(a+r)/2;return o?(e===a?s=(n-i)/o+(n<i)*6:n===a?s=(i-e)/o+2:s=(e-n)/o+4,o/=c<.5?a+r:2-a-r,s*=60):o=c>0&&c<1?0:s,new ie(s,o,c,t.opacity)}function Bc(t,e,n,i){return arguments.length===1?gs(t):new ie(t,e,n,i??1)}function ie(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}er(ie,Bc,_s(ln,{brighter(t){return t=t==null?Mn:Math.pow(Mn,t),new ie(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?tn:Math.pow(tn,t),new ie(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new Xt(ei(t>=240?t-240:t+120,r,i),ei(t,r,i),ei(t<120?t+240:t-120,r,i),this.opacity)},clamp(){return new ie(Cr(this.h),dn(this.s),dn(this.l),On(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=On(this.opacity);return`${t===1?"hsl(":"hsla("}${Cr(this.h)}, ${dn(this.s)*100}%, ${dn(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Cr(t){return t=(t||0)%360,t<0?t+360:t}function dn(t){return Math.max(0,Math.min(1,t||0))}function ei(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const nr=t=>()=>t;function Pc(t,e){return function(n){return t+n*e}}function Gc(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}function Uc(t){return(t=+t)==1?ms:function(e,n){return n-e?Gc(e,n,t):nr(isNaN(e)?n:e)}}function ms(t,e){var n=e-t;return n?Pc(t,n):nr(isNaN(t)?e:t)}const Ln=(function t(e){var n=Uc(e);function i(r,a){var s=n((r=Ai(r)).r,(a=Ai(a)).r),o=n(r.g,a.g),c=n(r.b,a.b),f=ms(r.opacity,a.opacity);return function(h){return r.r=s(h),r.g=o(h),r.b=c(h),r.opacity=f(h),r+""}}return i.gamma=t,i})(1);function Vc(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,i=e.slice(),r;return function(a){for(r=0;r<n;++r)i[r]=t[r]*(1-a)+e[r]*a;return i}}function Zc(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function qc(t,e){var n=e?e.length:0,i=t?Math.min(n,t.length):0,r=new Array(i),a=new Array(n),s;for(s=0;s<i;++s)r[s]=ir(t[s],e[s]);for(;s<n;++s)a[s]=e[s];return function(o){for(s=0;s<i;++s)a[s]=r[s](o);return a}}function Wc(t,e){var n=new Date;return t=+t,e=+e,function(i){return n.setTime(t*(1-i)+e*i),n}}function ne(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Xc(t,e){var n={},i={},r;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(r in e)r in t?n[r]=ir(t[r],e[r]):i[r]=e[r];return function(a){for(r in n)i[r]=n[r](a);return i}}var Ni=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ni=new RegExp(Ni.source,"g");function Kc(t){return function(){return t}}function Yc(t){return function(e){return t(e)+""}}function vs(t,e){var n=Ni.lastIndex=ni.lastIndex=0,i,r,a,s=-1,o=[],c=[];for(t=t+"",e=e+"";(i=Ni.exec(t))&&(r=ni.exec(e));)(a=r.index)>n&&(a=e.slice(n,a),o[s]?o[s]+=a:o[++s]=a),(i=i[0])===(r=r[0])?o[s]?o[s]+=r:o[++s]=r:(o[++s]=null,c.push({i:s,x:ne(i,r)})),n=ni.lastIndex;return n<e.length&&(a=e.slice(n),o[s]?o[s]+=a:o[++s]=a),o.length<2?c[0]?Yc(c[0].x):Kc(e):(e=c.length,function(f){for(var h=0,m;h<e;++h)o[(m=c[h]).i]=m.x(f);return o.join("")})}function ir(t,e){var n=typeof e,i;return e==null||n==="boolean"?nr(e):(n==="number"?ne:n==="string"?(i=Ae(e))?(e=i,Ln):vs:e instanceof Ae?Ln:e instanceof Date?Wc:Zc(e)?Vc:Array.isArray(e)?qc:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Xc:ne)(t,e)}function Jc(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var Fr=180/Math.PI,Ii={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function ws(t,e,n,i,r,a){var s,o,c;return(s=Math.sqrt(t*t+e*e))&&(t/=s,e/=s),(c=t*n+e*i)&&(n-=t*c,i-=e*c),(o=Math.sqrt(n*n+i*i))&&(n/=o,i/=o,c/=o),t*i<e*n&&(t=-t,e=-e,c=-c,s=-s),{translateX:r,translateY:a,rotate:Math.atan2(e,t)*Fr,skewX:Math.atan(c)*Fr,scaleX:s,scaleY:o}}var pn;function Qc(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Ii:ws(e.a,e.b,e.c,e.d,e.e,e.f)}function jc(t){return t==null||(pn||(pn=document.createElementNS("http://www.w3.org/2000/svg","g")),pn.setAttribute("transform",t),!(t=pn.transform.baseVal.consolidate()))?Ii:(t=t.matrix,ws(t.a,t.b,t.c,t.d,t.e,t.f))}function ys(t,e,n,i){function r(f){return f.length?f.pop()+" ":""}function a(f,h,m,p,_,T){if(f!==m||h!==p){var C=_.push("translate(",null,e,null,n);T.push({i:C-4,x:ne(f,m)},{i:C-2,x:ne(h,p)})}else(m||p)&&_.push("translate("+m+e+p+n)}function s(f,h,m,p){f!==h?(f-h>180?h+=360:h-f>180&&(f+=360),p.push({i:m.push(r(m)+"rotate(",null,i)-2,x:ne(f,h)})):h&&m.push(r(m)+"rotate("+h+i)}function o(f,h,m,p){f!==h?p.push({i:m.push(r(m)+"skewX(",null,i)-2,x:ne(f,h)}):h&&m.push(r(m)+"skewX("+h+i)}function c(f,h,m,p,_,T){if(f!==m||h!==p){var C=_.push(r(_)+"scale(",null,",",null,")");T.push({i:C-4,x:ne(f,m)},{i:C-2,x:ne(h,p)})}else(m!==1||p!==1)&&_.push(r(_)+"scale("+m+","+p+")")}return function(f,h){var m=[],p=[];return f=t(f),h=t(h),a(f.translateX,f.translateY,h.translateX,h.translateY,m,p),s(f.rotate,h.rotate,m,p),o(f.skewX,h.skewX,m,p),c(f.scaleX,f.scaleY,h.scaleX,h.scaleY,m,p),f=h=null,function(_){for(var T=-1,C=p.length,I;++T<C;)m[(I=p[T]).i]=I.x(_);return m.join("")}}}var tf=ys(Qc,"px, ","px)","deg)"),ef=ys(jc,", ",")",")"),Pe=0,Xe=0,Ze=0,xs=1e3,Hn,Ke,Cn=0,Ne=0,Yn=0,nn=typeof performance=="object"&&performance.now?performance:Date,bs=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function rr(){return Ne||(bs(nf),Ne=nn.now()+Yn)}function nf(){Ne=0}function Fn(){this._call=this._time=this._next=null}Fn.prototype=ks.prototype={constructor:Fn,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?rr():+n)+(e==null?0:+e),!this._next&&Ke!==this&&(Ke?Ke._next=this:Hn=this,Ke=this),this._call=t,this._time=n,$i()},stop:function(){this._call&&(this._call=null,this._time=1/0,$i())}};function ks(t,e,n){var i=new Fn;return i.restart(t,e,n),i}function rf(){rr(),++Pe;for(var t=Hn,e;t;)(e=Ne-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Pe}function zr(){Ne=(Cn=nn.now())+Yn,Pe=Xe=0;try{rf()}finally{Pe=0,sf(),Ne=0}}function af(){var t=nn.now(),e=t-Cn;e>xs&&(Yn-=e,Cn=t)}function sf(){for(var t,e=Hn,n,i=1/0;e;)e._call?(i>e._time&&(i=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Hn=n);Ke=t,$i(i)}function $i(t){if(!Pe){Xe&&(Xe=clearTimeout(Xe));var e=t-Ne;e>24?(t<1/0&&(Xe=setTimeout(zr,t-nn.now()-Yn)),Ze&&(Ze=clearInterval(Ze))):(Ze||(Cn=nn.now(),Ze=setInterval(af,xs)),Pe=1,bs(zr))}}function Br(t,e,n){var i=new Fn;return e=e==null?0:+e,i.restart(r=>{i.stop(),t(r+e)},e,n),i}var of=ns("start","end","cancel","interrupt"),lf=[],Es=0,Pr=1,Ri=2,An=3,Gr=4,Di=5,Nn=6;function Jn(t,e,n,i,r,a){var s=t.__transition;if(!s)t.__transition={};else if(n in s)return;cf(t,n,{name:e,index:i,group:r,on:of,tween:lf,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:Es})}function ar(t,e){var n=re(t,e);if(n.state>Es)throw new Error("too late; already scheduled");return n}function le(t,e){var n=re(t,e);if(n.state>An)throw new Error("too late; already running");return n}function re(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function cf(t,e,n){var i=t.__transition,r;i[e]=n,n.timer=ks(a,0,n.time);function a(f){n.state=Pr,n.timer.restart(s,n.delay,n.time),n.delay<=f&&s(f-n.delay)}function s(f){var h,m,p,_;if(n.state!==Pr)return c();for(h in i)if(_=i[h],_.name===n.name){if(_.state===An)return Br(s);_.state===Gr?(_.state=Nn,_.timer.stop(),_.on.call("interrupt",t,t.__data__,_.index,_.group),delete i[h]):+h<e&&(_.state=Nn,_.timer.stop(),_.on.call("cancel",t,t.__data__,_.index,_.group),delete i[h])}if(Br(function(){n.state===An&&(n.state=Gr,n.timer.restart(o,n.delay,n.time),o(f))}),n.state=Ri,n.on.call("start",t,t.__data__,n.index,n.group),n.state===Ri){for(n.state=An,r=new Array(p=n.tween.length),h=0,m=-1;h<p;++h)(_=n.tween[h].value.call(t,t.__data__,n.index,n.group))&&(r[++m]=_);r.length=m+1}}function o(f){for(var h=f<n.duration?n.ease.call(null,f/n.duration):(n.timer.restart(c),n.state=Di,1),m=-1,p=r.length;++m<p;)r[m].call(t,h);n.state===Di&&(n.on.call("end",t,t.__data__,n.index,n.group),c())}function c(){n.state=Nn,n.timer.stop(),delete i[e];for(var f in i)return;delete t.__transition}}function ff(t,e){var n=t.__transition,i,r,a=!0,s;if(n){e=e==null?null:e+"";for(s in n){if((i=n[s]).name!==e){a=!1;continue}r=i.state>Ri&&i.state<Di,i.state=Nn,i.timer.stop(),i.on.call(r?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete n[s]}a&&delete t.__transition}}function hf(t){return this.each(function(){ff(this,t)})}function uf(t,e){var n,i;return function(){var r=le(this,t),a=r.tween;if(a!==n){i=n=a;for(var s=0,o=i.length;s<o;++s)if(i[s].name===e){i=i.slice(),i.splice(s,1);break}}r.tween=i}}function df(t,e,n){var i,r;if(typeof n!="function")throw new Error;return function(){var a=le(this,t),s=a.tween;if(s!==i){r=(i=s).slice();for(var o={name:e,value:n},c=0,f=r.length;c<f;++c)if(r[c].name===e){r[c]=o;break}c===f&&r.push(o)}a.tween=r}}function pf(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i=re(this.node(),n).tween,r=0,a=i.length,s;r<a;++r)if((s=i[r]).name===t)return s.value;return null}return this.each((e==null?uf:df)(n,t,e))}function sr(t,e,n){var i=t._id;return t.each(function(){var r=le(this,i);(r.value||(r.value={}))[e]=n.apply(this,arguments)}),function(r){return re(r,i).value[e]}}function Ts(t,e){var n;return(typeof e=="number"?ne:e instanceof Ae?Ln:(n=Ae(e))?(e=n,Ln):vs)(t,e)}function _f(t){return function(){this.removeAttribute(t)}}function gf(t){return function(){this.removeAttributeNS(t.space,t.local)}}function mf(t,e,n){var i,r=n+"",a;return function(){var s=this.getAttribute(t);return s===r?null:s===i?a:a=e(i=s,n)}}function vf(t,e,n){var i,r=n+"",a;return function(){var s=this.getAttributeNS(t.space,t.local);return s===r?null:s===i?a:a=e(i=s,n)}}function wf(t,e,n){var i,r,a;return function(){var s,o=n(this),c;return o==null?void this.removeAttribute(t):(s=this.getAttribute(t),c=o+"",s===c?null:s===i&&c===r?a:(r=c,a=e(i=s,o)))}}function yf(t,e,n){var i,r,a;return function(){var s,o=n(this),c;return o==null?void this.removeAttributeNS(t.space,t.local):(s=this.getAttributeNS(t.space,t.local),c=o+"",s===c?null:s===i&&c===r?a:(r=c,a=e(i=s,o)))}}function xf(t,e){var n=Kn(t),i=n==="transform"?ef:Ts;return this.attrTween(t,typeof e=="function"?(n.local?yf:wf)(n,i,sr(this,"attr."+t,e)):e==null?(n.local?gf:_f)(n):(n.local?vf:mf)(n,i,e))}function bf(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function kf(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function Ef(t,e){var n,i;function r(){var a=e.apply(this,arguments);return a!==i&&(n=(i=a)&&kf(t,a)),n}return r._value=e,r}function Tf(t,e){var n,i;function r(){var a=e.apply(this,arguments);return a!==i&&(n=(i=a)&&bf(t,a)),n}return r._value=e,r}function Sf(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var i=Kn(t);return this.tween(n,(i.local?Ef:Tf)(i,e))}function Af(t,e){return function(){ar(this,t).delay=+e.apply(this,arguments)}}function Nf(t,e){return e=+e,function(){ar(this,t).delay=e}}function If(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Af:Nf)(e,t)):re(this.node(),e).delay}function $f(t,e){return function(){le(this,t).duration=+e.apply(this,arguments)}}function Rf(t,e){return e=+e,function(){le(this,t).duration=e}}function Df(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?$f:Rf)(e,t)):re(this.node(),e).duration}function Mf(t,e){if(typeof e!="function")throw new Error;return function(){le(this,t).ease=e}}function Of(t){var e=this._id;return arguments.length?this.each(Mf(e,t)):re(this.node(),e).ease}function Lf(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;le(this,t).ease=n}}function Hf(t){if(typeof t!="function")throw new Error;return this.each(Lf(this._id,t))}function Cf(t){typeof t!="function"&&(t=ss(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var a=e[r],s=a.length,o=i[r]=[],c,f=0;f<s;++f)(c=a[f])&&t.call(c,c.__data__,f,a)&&o.push(c);return new _e(i,this._parents,this._name,this._id)}function Ff(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,a=Math.min(i,r),s=new Array(i),o=0;o<a;++o)for(var c=e[o],f=n[o],h=c.length,m=s[o]=new Array(h),p,_=0;_<h;++_)(p=c[_]||f[_])&&(m[_]=p);for(;o<i;++o)s[o]=e[o];return new _e(s,this._parents,this._name,this._id)}function zf(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function Bf(t,e,n){var i,r,a=zf(e)?ar:le;return function(){var s=a(this,t),o=s.on;o!==i&&(r=(i=o).copy()).on(e,n),s.on=r}}function Pf(t,e){var n=this._id;return arguments.length<2?re(this.node(),n).on.on(t):this.each(Bf(n,t,e))}function Gf(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function Uf(){return this.on("end.remove",Gf(this._id))}function Vf(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Qi(t));for(var i=this._groups,r=i.length,a=new Array(r),s=0;s<r;++s)for(var o=i[s],c=o.length,f=a[s]=new Array(c),h,m,p=0;p<c;++p)(h=o[p])&&(m=t.call(h,h.__data__,p,o))&&("__data__"in h&&(m.__data__=h.__data__),f[p]=m,Jn(f[p],e,n,p,f,re(h,n)));return new _e(a,this._parents,e,n)}function Zf(t){var e=this._name,n=this._id;typeof t!="function"&&(t=as(t));for(var i=this._groups,r=i.length,a=[],s=[],o=0;o<r;++o)for(var c=i[o],f=c.length,h,m=0;m<f;++m)if(h=c[m]){for(var p=t.call(h,h.__data__,m,c),_,T=re(h,n),C=0,I=p.length;C<I;++C)(_=p[C])&&Jn(_,e,n,C,p,T);a.push(p),s.push(h)}return new _e(a,s,e,n)}var qf=Re.prototype.constructor;function Wf(){return new qf(this._groups,this._parents)}function Xf(t,e){var n,i,r;return function(){var a=Be(this,t),s=(this.style.removeProperty(t),Be(this,t));return a===s?null:a===n&&s===i?r:r=e(n=a,i=s)}}function Ss(t){return function(){this.style.removeProperty(t)}}function Kf(t,e,n){var i,r=n+"",a;return function(){var s=Be(this,t);return s===r?null:s===i?a:a=e(i=s,n)}}function Yf(t,e,n){var i,r,a;return function(){var s=Be(this,t),o=n(this),c=o+"";return o==null&&(c=o=(this.style.removeProperty(t),Be(this,t))),s===c?null:s===i&&c===r?a:(r=c,a=e(i=s,o))}}function Jf(t,e){var n,i,r,a="style."+e,s="end."+a,o;return function(){var c=le(this,t),f=c.on,h=c.value[a]==null?o||(o=Ss(e)):void 0;(f!==n||r!==h)&&(i=(n=f).copy()).on(s,r=h),c.on=i}}function Qf(t,e,n){var i=(t+="")=="transform"?tf:Ts;return e==null?this.styleTween(t,Xf(t,i)).on("end.style."+t,Ss(t)):typeof e=="function"?this.styleTween(t,Yf(t,i,sr(this,"style."+t,e))).each(Jf(this._id,t)):this.styleTween(t,Kf(t,i,e),n).on("end.style."+t,null)}function jf(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}function th(t,e,n){var i,r;function a(){var s=e.apply(this,arguments);return s!==r&&(i=(r=s)&&jf(t,s,n)),i}return a._value=e,a}function eh(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,th(t,e,n??""))}function nh(t){return function(){this.textContent=t}}function ih(t){return function(){var e=t(this);this.textContent=e??""}}function rh(t){return this.tween("text",typeof t=="function"?ih(sr(this,"text",t)):nh(t==null?"":t+""))}function ah(t){return function(e){this.textContent=t.call(this,e)}}function sh(t){var e,n;function i(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&ah(r)),e}return i._value=t,i}function oh(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,sh(t))}function lh(){for(var t=this._name,e=this._id,n=As(),i=this._groups,r=i.length,a=0;a<r;++a)for(var s=i[a],o=s.length,c,f=0;f<o;++f)if(c=s[f]){var h=re(c,e);Jn(c,t,n,f,s,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new _e(i,this._parents,t,n)}function ch(){var t,e,n=this,i=n._id,r=n.size();return new Promise(function(a,s){var o={value:s},c={value:function(){--r===0&&a()}};n.each(function(){var f=le(this,i),h=f.on;h!==t&&(e=(t=h).copy(),e._.cancel.push(o),e._.interrupt.push(o),e._.end.push(c)),f.on=e}),r===0&&a()})}var fh=0;function _e(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function As(){return++fh}var he=Re.prototype;_e.prototype={constructor:_e,select:Vf,selectAll:Zf,selectChild:he.selectChild,selectChildren:he.selectChildren,filter:Cf,merge:Ff,selection:Wf,transition:lh,call:he.call,nodes:he.nodes,node:he.node,size:he.size,empty:he.empty,each:he.each,on:Pf,attr:xf,attrTween:Sf,style:Qf,styleTween:eh,text:rh,textTween:oh,remove:Uf,tween:pf,delay:If,duration:Df,ease:Of,easeVarying:Hf,end:ch,[Symbol.iterator]:he[Symbol.iterator]};function hh(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var uh={time:null,delay:0,duration:250,ease:hh};function dh(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function ph(t){var e,n;t instanceof _e?(e=t._id,t=t._name):(e=As(),(n=uh).time=rr(),t=t==null?null:t+"");for(var i=this._groups,r=i.length,a=0;a<r;++a)for(var s=i[a],o=s.length,c,f=0;f<o;++f)(c=s[f])&&Jn(c,t,e,f,s,n||dh(c,e));return new _e(i,this._parents,t,e)}Re.prototype.interrupt=hf;Re.prototype.transition=ph;const Mi=Math.PI,Oi=2*Mi,be=1e-6,_h=Oi-be;function Ns(t){this._+=t[0];for(let e=1,n=t.length;e<n;++e)this._+=arguments[e]+t[e]}function gh(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return Ns;const n=10**e;return function(i){this._+=i[0];for(let r=1,a=i.length;r<a;++r)this._+=Math.round(arguments[r]*n)/n+i[r]}}class mh{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?Ns:gh(e)}moveTo(e,n){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,n){this._append`L${this._x1=+e},${this._y1=+n}`}quadraticCurveTo(e,n,i,r){this._append`Q${+e},${+n},${this._x1=+i},${this._y1=+r}`}bezierCurveTo(e,n,i,r,a,s){this._append`C${+e},${+n},${+i},${+r},${this._x1=+a},${this._y1=+s}`}arcTo(e,n,i,r,a){if(e=+e,n=+n,i=+i,r=+r,a=+a,a<0)throw new Error(`negative radius: ${a}`);let s=this._x1,o=this._y1,c=i-e,f=r-n,h=s-e,m=o-n,p=h*h+m*m;if(this._x1===null)this._append`M${this._x1=e},${this._y1=n}`;else if(p>be)if(!(Math.abs(m*c-f*h)>be)||!a)this._append`L${this._x1=e},${this._y1=n}`;else{let _=i-s,T=r-o,C=c*c+f*f,I=_*_+T*T,N=Math.sqrt(C),E=Math.sqrt(p),b=a*Math.tan((Mi-Math.acos((C+p-I)/(2*N*E)))/2),y=b/E,S=b/N;Math.abs(y-1)>be&&this._append`L${e+y*h},${n+y*m}`,this._append`A${a},${a},0,0,${+(m*_>h*T)},${this._x1=e+S*c},${this._y1=n+S*f}`}}arc(e,n,i,r,a,s){if(e=+e,n=+n,i=+i,s=!!s,i<0)throw new Error(`negative radius: ${i}`);let o=i*Math.cos(r),c=i*Math.sin(r),f=e+o,h=n+c,m=1^s,p=s?r-a:a-r;this._x1===null?this._append`M${f},${h}`:(Math.abs(this._x1-f)>be||Math.abs(this._y1-h)>be)&&this._append`L${f},${h}`,i&&(p<0&&(p=p%Oi+Oi),p>_h?this._append`A${i},${i},0,1,${m},${e-o},${n-c}A${i},${i},0,1,${m},${this._x1=f},${this._y1=h}`:p>be&&this._append`A${i},${i},0,${+(p>=Mi)},${m},${this._x1=e+i*Math.cos(a)},${this._y1=n+i*Math.sin(a)}`)}rect(e,n,i,r){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}h${i=+i}v${+r}h${-i}Z`}toString(){return this._}}function vh(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function zn(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,i=t.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+t.slice(n+1)]}function Ge(t){return t=zn(Math.abs(t)),t?t[1]:NaN}function wh(t,e){return function(n,i){for(var r=n.length,a=[],s=0,o=t[0],c=0;r>0&&o>0&&(c+o+1>i&&(o=Math.max(1,i-c)),a.push(n.substring(r-=o,r+o)),!((c+=o+1)>i));)o=t[s=(s+1)%t.length];return a.reverse().join(e)}}function yh(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var xh=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Bn(t){if(!(e=xh.exec(t)))throw new Error("invalid format: "+t);var e;return new or({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Bn.prototype=or.prototype;function or(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}or.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function bh(t){t:for(var e=t.length,n=1,i=-1,r;n<e;++n)switch(t[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+t[n])break t;i>0&&(i=0);break}return i>0?t.slice(0,i)+t.slice(r+1):t}var Is;function kh(t,e){var n=zn(t,e);if(!n)return t+"";var i=n[0],r=n[1],a=r-(Is=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,s=i.length;return a===s?i:a>s?i+new Array(a-s+1).join("0"):a>0?i.slice(0,a)+"."+i.slice(a):"0."+new Array(1-a).join("0")+zn(t,Math.max(0,e+a-1))[0]}function Ur(t,e){var n=zn(t,e);if(!n)return t+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const Vr={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:vh,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Ur(t*100,e),r:Ur,s:kh,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Zr(t){return t}var qr=Array.prototype.map,Wr=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Eh(t){var e=t.grouping===void 0||t.thousands===void 0?Zr:wh(qr.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",i=t.currency===void 0?"":t.currency[1]+"",r=t.decimal===void 0?".":t.decimal+"",a=t.numerals===void 0?Zr:yh(qr.call(t.numerals,String)),s=t.percent===void 0?"%":t.percent+"",o=t.minus===void 0?"−":t.minus+"",c=t.nan===void 0?"NaN":t.nan+"";function f(m){m=Bn(m);var p=m.fill,_=m.align,T=m.sign,C=m.symbol,I=m.zero,N=m.width,E=m.comma,b=m.precision,y=m.trim,S=m.type;S==="n"?(E=!0,S="g"):Vr[S]||(b===void 0&&(b=12),y=!0,S="g"),(I||p==="0"&&_==="=")&&(I=!0,p="0",_="=");var D=C==="$"?n:C==="#"&&/[boxX]/.test(S)?"0"+S.toLowerCase():"",k=C==="$"?i:/[%p]/.test(S)?s:"",F=Vr[S],z=/[defgprs%]/.test(S);b=b===void 0?6:/[gprs]/.test(S)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b));function L(v){var Z=D,P=k,Q,nt,it;if(S==="c")P=F(v)+P,v="";else{v=+v;var W=v<0||1/v<0;if(v=isNaN(v)?c:F(Math.abs(v),b),y&&(v=bh(v)),W&&+v==0&&T!=="+"&&(W=!1),Z=(W?T==="("?T:o:T==="-"||T==="("?"":T)+Z,P=(S==="s"?Wr[8+Is/3]:"")+P+(W&&T==="("?")":""),z){for(Q=-1,nt=v.length;++Q<nt;)if(it=v.charCodeAt(Q),48>it||it>57){P=(it===46?r+v.slice(Q+1):v.slice(Q))+P,v=v.slice(0,Q);break}}}E&&!I&&(v=e(v,1/0));var st=Z.length+v.length+P.length,q=st<N?new Array(N-st+1).join(p):"";switch(E&&I&&(v=e(q+v,q.length?N-P.length:1/0),q=""),_){case"<":v=Z+v+P+q;break;case"=":v=Z+q+v+P;break;case"^":v=q.slice(0,st=q.length>>1)+Z+v+P+q.slice(st);break;default:v=q+Z+v+P;break}return a(v)}return L.toString=function(){return m+""},L}function h(m,p){var _=f((m=Bn(m),m.type="f",m)),T=Math.max(-8,Math.min(8,Math.floor(Ge(p)/3)))*3,C=Math.pow(10,-T),I=Wr[8+T/3];return function(N){return _(C*N)+I}}return{format:f,formatPrefix:h}}var _n,$s,Rs;Th({thousands:",",grouping:[3],currency:["$",""]});function Th(t){return _n=Eh(t),$s=_n.format,Rs=_n.formatPrefix,_n}function Sh(t){return Math.max(0,-Ge(Math.abs(t)))}function Ah(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Ge(e)/3)))*3-Ge(Math.abs(t)))}function Nh(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Ge(e)-Ge(t))+1}function Ih(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function $h(t){return function(){return t}}function Rh(t){return+t}var Xr=[0,1];function Ce(t){return t}function Li(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:$h(isNaN(e)?NaN:.5)}function Dh(t,e){var n;return t>e&&(n=t,t=e,e=n),function(i){return Math.max(t,Math.min(e,i))}}function Mh(t,e,n){var i=t[0],r=t[1],a=e[0],s=e[1];return r<i?(i=Li(r,i),a=n(s,a)):(i=Li(i,r),a=n(a,s)),function(o){return a(i(o))}}function Oh(t,e,n){var i=Math.min(t.length,e.length)-1,r=new Array(i),a=new Array(i),s=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++s<i;)r[s]=Li(t[s],t[s+1]),a[s]=n(e[s],e[s+1]);return function(o){var c=Ho(t,o,1,i)-1;return a[c](r[c](o))}}function Lh(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Hh(){var t=Xr,e=Xr,n=ir,i,r,a,s=Ce,o,c,f;function h(){var p=Math.min(t.length,e.length);return s!==Ce&&(s=Dh(t[0],t[p-1])),o=p>2?Oh:Mh,c=f=null,m}function m(p){return p==null||isNaN(p=+p)?a:(c||(c=o(t.map(i),e,n)))(i(s(p)))}return m.invert=function(p){return s(r((f||(f=o(e,t.map(i),ne)))(p)))},m.domain=function(p){return arguments.length?(t=Array.from(p,Rh),h()):t.slice()},m.range=function(p){return arguments.length?(e=Array.from(p),h()):e.slice()},m.rangeRound=function(p){return e=Array.from(p),n=Jc,h()},m.clamp=function(p){return arguments.length?(s=p?!0:Ce,h()):s!==Ce},m.interpolate=function(p){return arguments.length?(n=p,h()):n},m.unknown=function(p){return arguments.length?(a=p,m):a},function(p,_){return i=p,r=_,h()}}function Ch(){return Hh()(Ce,Ce)}function Fh(t,e,n,i){var r=Po(t,e,n),a;switch(i=Bn(i??",f"),i.type){case"s":{var s=Math.max(Math.abs(t),Math.abs(e));return i.precision==null&&!isNaN(a=Ah(r,s))&&(i.precision=a),Rs(i,s)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(a=Nh(r,Math.max(Math.abs(t),Math.abs(e))))&&(i.precision=a-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(a=Sh(r))&&(i.precision=a-(i.type==="%")*2);break}}return $s(i)}function zh(t){var e=t.domain;return t.ticks=function(n){var i=e();return Bo(i[0],i[i.length-1],n??10)},t.tickFormat=function(n,i){var r=e();return Fh(r[0],r[r.length-1],n??10,i)},t.nice=function(n){n==null&&(n=10);var i=e(),r=0,a=i.length-1,s=i[r],o=i[a],c,f,h=10;for(o<s&&(f=s,s=o,o=f,f=r,r=a,a=f);h-- >0;){if(f=Ei(s,o,n),f===c)return i[r]=s,i[a]=o,e(i);if(f>0)s=Math.floor(s/f)*f,o=Math.ceil(o/f)*f;else if(f<0)s=Math.ceil(s*f)/f,o=Math.floor(o*f)/f;else break;c=f}return t},t}function me(){var t=Ch();return t.copy=function(){return Lh(t,me())},Ih.apply(t,arguments),zh(t)}function gn(t){return function(){return t}}const lr=Math.sqrt,Ds=Math.PI,Bh=2*Ds;function Ph(t){let e=3;return t.digits=function(n){if(!arguments.length)return e;if(n==null)e=null;else{const i=Math.floor(n);if(!(i>=0))throw new RangeError(`invalid digits: ${n}`);e=i}return t},()=>new mh(e)}const Gh={draw(t,e){const n=lr(e/Ds);t.moveTo(n,0),t.arc(0,0,n,0,Bh)}},ii=lr(3),Ms={draw(t,e){const n=-lr(e/(ii*3));t.moveTo(0,n*2),t.lineTo(-ii*n,-n),t.lineTo(ii*n,-n),t.closePath()}};function Os(t,e){let n=null,i=Ph(r);t=typeof t=="function"?t:gn(t||Gh),e=typeof e=="function"?e:gn(e===void 0?64:+e);function r(){let a;if(n||(n=a=i()),t.apply(this,arguments).draw(n,+e.apply(this,arguments)),a)return n=null,a+""||null}return r.type=function(a){return arguments.length?(t=typeof a=="function"?a:gn(a),r):t},r.size=function(a){return arguments.length?(e=typeof a=="function"?a:gn(+a),r):e},r.context=function(a){return arguments.length?(n=a??null,r):n},r}function Ye(t,e,n){this.k=t,this.x=e,this.y=n}Ye.prototype={constructor:Ye,scale:function(t){return t===1?this:new Ye(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new Ye(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Ye.prototype;function cr(t,e,n){let i=0,r,a;if(t.length==0)i=1;else{for(let s=1;s<t.length;s++){for(const o of t[s]){const[c,f]=o.split(":");if(n<+c||e>+f)a=1;else{a=0;break}}if(a){r=1,i=s;break}}r||(i=t.length)}return i}function Ls(t,e){let n=-1,i=-1;for(const r of t){const a=r.children;a&&a.forEach(s=>{e.includes(s.type)&&((n<0||s.fmin<n)&&(n=s.fmin),(i<0||s.fmax>i)&&(i=s.fmax))})}return{fmin:n,fmax:i}}function Ue(t){const n=t.attr("class").split(" "),i=`.${n[0]}.${n[1]} .track`,r=ee(i).nodes();let a=0;return r.forEach(s=>{a+=s.getBoundingClientRect().height+1}),a}function fr(t,e){const n=e.node()?.getBBox().height??0;e.selectAll(".variant-deletion,.variant-SNV,.variant-insertion,.variant-delins").filter(r=>{let a=!1;return r.alleles?.length&&(r.alleles[0].replace(/"|\[|\]| /g,"").split(",").forEach(o=>{t.includes(o)&&(a=!0)}),r.alleles.forEach(o=>{t.includes(o)&&(a=!0)})),a}).datum(r=>(r.selected="true",r)).style("stroke","black").each(function(){let r=Ot(this).attr("x"),a=+Ot(this).attr("width");(a===0||Number.isNaN(a))&&(a=3,r=String(+r-a/2)),e.select(".deletions.track").append("rect").attr("class","highlight").attr("x",r).attr("width",a).attr("height",n).attr("fill","yellow").attr("opacity",.8).lower()})}const Uh=["mRNA","ncRNA","piRNA","lincRNA","miRNA","pre_miRNA","snoRNA","lnc_RNA","tRNA","snRNA","rRNA","ARS","antisense_RNA","C_gene_segment","V_gene_segment","pseudogene_attribute","snoRNA_gene","polypeptide_region","mature_protein_region"],Vh=["point_mutation","MNV","Deletion","Insertion","Delins"];function Je(t){return t.replace(/\|/g," ").replace(/"/g,"").replace(/^\[/,"").replace(/\]$/,"").trim()}const In={transcript_ablation:{impact:"HIGH",color:"#ff0000"},splice_acceptor_variant:{impact:"HIGH",color:"#ff581a"},splice_donor_variant:{impact:"HIGH",color:"#ff581a"},stop_gained:{impact:"HIGH",color:"#ff0000"},frameshift_variant:{impact:"HIGH",color:"#9400D3"},stop_lost:{impact:"HIGH",color:"#ff0000"},start_lost:{impact:"HIGH",color:"#ffd700"},transcript_amplification:{impact:"HIGH",color:"#ff69b4"},inframe_insertion:{impact:"MODERATE",color:"#ff69b4"},inframe_deletion:{impact:"MODERATE",color:"#ff69b4"},missense_variant:{impact:"MODERATE",color:"#ffd700"},protein_altering_variant:{impact:"MODERATE",color:"#ff0080"},splice_region_variant:{impact:"LOW",color:"#ff7f50"},incomplete_terminal_codon_variant:{impact:"LOW",color:"#ff00ff"},start_retained_variant:{impact:"LOW",color:"#76ee00"},stop_retained_variant:{impact:"LOW",color:"#76ee00"},synonymous_variant:{impact:"LOW",color:"#76ee00"},coding_sequence_variant:{impact:"MODIFIER",color:"#458b00"},mature_miRNA_variant:{impact:"MODIFIER",color:"#458b00"},five_prime_UTR_variant:{impact:"MODIFIER",color:"#7ac5cd"},three_prime_UTR_variant:{impact:"MODIFIER",color:"#7ac5cd"},non_coding_transcript_exon_variant:{impact:"MODIFIER",color:"#32cd32"},intron_variant:{impact:"MODIFIER",color:"#02599c"},NMD_transcript_variant:{impact:"MODIFIER",color:"#ff4500"},non_coding_transcript_variant:{impact:"MODIFIER",color:"#32cd32"},upstream_gene_variant:{impact:"MODIFIER",color:"#a2b5cd"},downstream_gene_variant:{impact:"MODIFIER",color:"#a2b5cd"},TFBS_ablation:{impact:"MODIFIER",color:"#a52a2a"},TFBS_amplification:{impact:"MODIFIER",color:"#a52a2a"},TF_binding_site_variant:{impact:"MODIFIER",color:"#a52a2a"},regulatory_region_ablation:{impact:"MODERATE",color:"#a52a2a"},regulatory_region_amplification:{impact:"MODIFIER",color:"#a52a2a"},feature_elongation:{impact:"MODIFIER",color:"#7f7f7f"},regulatory_region_variant:{impact:"MODIFIER",color:"#a52a2a"},feature_truncation:{impact:"MODIFIER",color:"#7f7f7f"},intergenic_variant:{impact:"MODIFIER",color:"#636363"}};function Hs(t){if(!t)return"black";const e=Je(t);if(e.split(" ").length>1||e.split("|").length>1){const i=e.includes("|")?e.split("|")[0].trim():e.split(" ")[0].trim();return Hs(i)}if(e==="UNKNOWN")return"gray";const n=In[e];return n?n.color:e==="5_prime_UTR_variant"?In.five_prime_UTR_variant.color:e==="3_prime_UTR_variant"?In.three_prime_UTR_variant.color:"#f0f"}const Se=10,ge=10;function hr(t){return`${t},${Se} ${t+ge/2},${Se/2} ${t},0 ${t-ge/2},${Se/2}`}function Cs(t){return`${t-ge/2},${Se} ${t},0 ${t+ge/2},${Se}`}function Kr(t,e,n){if(t.length==0)return 0;{let i=!0,r=0;return t.sort((a,s)=>a.row>s.row?1:-1),t.every(a=>r!=a.row&&i?!1:(r!=a.row&&(r=a.row,i=!0),a.fmin>e&&a.fmin>n||a.fmax<n&&a.fmax<e||(i=!1),!0)),i?r:r+1}}function Fs(t){return`${t-ge/2},${Se} ${t+ge/2},${Se} ${t-ge/2},0 ${t+ge/2},0`}function Zh(t){const e=Object.keys(t).length;return{descriptionWidth:Math.max(...Object.entries(t).map(i=>i[1]?.length??0)),descriptionHeight:e}}function qh(t,e,n){const{fmax:i,fmin:r,type:a}=e;return t.findIndex(s=>{const o=s.fmin+n,c=s.fmax-n;return a!==s.type?!1:o<=r&&c>=r||c<=i&&c>=i||o>=r&&c<=i})}function zs(t,e){const n=[];return t.forEach(i=>{const r=Bs(i),{type:a,fmax:s,fmin:o}=i,c=qh(n,i,e);if(c>=0&&a!="deletion"){const f=n[c],h=f.variantSet?f.variantSet.findIndex(m=>m.type===a&&m.consequence===r):-1;if(h>=0){const m=Math.min(f.variantSet[h].fmin,o),p=Math.max(f.variantSet[h].fmax,s);f.fmin=m,f.fmax=p,f.variantSet[h].fmin=m,f.variantSet[h].fmax=p,f.variantSet[h].variants?.push(i)}else{const m=Math.min(f.fmin,o),p=Math.max(f.fmax,s);f.fmin=m,f.fmax=p,f.variantSet.push({variants:[i],type:a,consequence:r,fmin:o,fmax:s})}f.variants?.push(i),f.fmin=Math.min(o,f.fmin),f.fmax=Math.max(s,f.fmax),n[c]=f}else n.push({fmin:o,fmax:s,type:a,consequence:r,variantSet:[{variants:[i],type:a,consequence:r,fmin:o,fmax:s}],variants:[i]})}),n}function Hi(t){if(t.length===1){let e='<div style="margin-top: 30px;">';return e+=Yr(t[0]),e+="</div>",e}else if(t.length>1){let e='<ul style="list-style-type: none; margin-top: 30px;">';for(const n of t)e+=`<li style="border-bottom: solid 1px black;">${Yr(n)}</li>`;return e+="</ul>",e}else return"No data available"}function Yr(t){const{descriptionWidth:e}=Zh(t);let n="";const i=t.location,[r,a]=i.split(":")[1].split("..");let s=t.alternative_alleles,o=t.reference_allele,c;if(t.type==="SNV")c="1bp";else if(t.type==="deletion")c=`${o.length-1}bp deleted`;else if(t.type==="insertion")s==="ALT_MISSING"?(c="unknown length inserted",s="n+"):c=`${s.length-1}bp inserted`;else if(t.type==="MNV")c=`${o.length}bp`;else if(t.type==="delins"){const h=`${o.length-1}bp deleted`;let m;s==="ALT_MISSING"?(m="unknown length inserted",s="n+"):m=`${s.length-1}bp inserted`,c=`${h}; ${m}`}else c=`${+a-+r}bp`;o=o.length>20?`${o.slice(0,1).toLowerCase()+o.slice(1,8).toUpperCase()}...${o.slice(Math.max(0,o.length-8)).toUpperCase()}`:o.slice(0,1).toLowerCase()+o.slice(1).toUpperCase(),s=s.length>20?`${s.slice(0,1).toLowerCase()+s.slice(1,8).toUpperCase()}...${s.slice(Math.max(0,s.length-8)).toUpperCase()}`:s.slice(0,1).toLowerCase()+s.slice(1).toUpperCase(),(t.type==="SNV"||t.type==="MNV")&&(s=s.toUpperCase(),o=o.toUpperCase());let f="";return t.type==="insertion"?f=`ins: ${s}`:t.type==="deletion"?f=`del: ${o}`:f=`${o}->${s}`,n+='<table class="tooltip-table"><tbody>',n+=`<tr><th>Symbol</th><td>${t.symbolDetail}</td></tr>`,n+=`<tr><th>Type</th><td>${t.type}</td></tr>`,n+=`<tr><th>Consequence</th><td>${t.consequence}</td></tr>`,t.impact&&(n+=`<tr><th>Impact</th><td>${t.impact.length>e?t.impact.slice(0,Math.max(0,e)):t.impact}</td></tr>`),n+=`<tr><th>Length</th><td>${c}</td></tr>`,t.name!==t.symbol&&(n+=`<tr><th>Name</th><td>${t.name}</td></tr>`),t.geneId&&t.geneSymbol?n+=`<tr><th>Allele of Genes</th><td> ${t.geneSymbol.length>e?t.geneSymbol.slice(0,Math.max(0,e)):t.geneSymbol} (${t.geneId})</td></tr>`:t.allele_of_genes&&(n+=`<tr><th>Allele of Genes</th><td>${t.allele_of_genes.length>e?t.allele_of_genes.slice(0,Math.max(0,e)):t.allele_of_genes}</td></tr>`),t.alternative_alleles&&(n+=`<tr><th>Sequence Change</th><td>${f}</td></tr>`),n+="</tbody></table>",n}function Ci(t){return(t.variants??[]).map(n=>{const i=Wh(n);return{...i,consequence:i.consequence||"UNKNOWN"}})}function Fi(t){return(t.variants??[]).flatMap(e=>{const n=e.allele_ids?.values?.[0];if(!n)return[];if(n.startsWith("[")&&n.endsWith("]"))try{const i=JSON.parse(n);return(Array.isArray(i)?i:[i]).map(String)}catch{}return n.replace(/"/g,"").split(",").map(i=>i.replace(/\[|\]| /g,""))}).filter(e=>!!e)}function zi(t){return t.map(e=>Hs(e.consequence))}function Bs(t){if(t.geneLevelConsequence?.values&&t.geneLevelConsequence.values.length>0)return Je(t.geneLevelConsequence.values[0]);if(t.consequence&&typeof t.consequence=="string")return Je(t.consequence);if(Array.isArray(t.consequence)&&t.consequence.length>0)return Je(t.consequence[0]);const e=t.variants??[];if(e.length>0){for(const n of e)if(n.consequence&&typeof n.consequence=="string")return Je(n.consequence)}return"UNKNOWN"}function mn(t){return(Array.isArray(t?.values)?t.values.join(" "):t?.values)??""}function Wh(t){return{symbol:rn(t),symbolDetail:Ps(t),location:`${t.seqId}:${t.fmin}..${t.fmax}`,consequence:Bs(t),type:t.type,name:t.name,description:t.description,reference_allele:t.reference_allele,geneId:t.allele_of_gene_ids?.values[0].replace(/"/g,""),geneSymbol:t.allele_of_gene_symbols?.values[0].replace(/"/g,""),allele_of_genes:mn(t.allele_of_genes),allele_ids:mn(t.allele_ids),alternative_alleles:mn(t.alternative_alleles),impact:mn(t.impact)}}function Ps(t){if(t.variants)return t.variants.length!==1?`${t.variants.length}`:Ps(t.variants[0]);if(t.allele_symbols?.values)if(t.allele_symbols.values[0].split(",").length>1)try{const e=[],n=t.allele_symbols.values[0].replace(/"|\[|\]/g,""),i=t.allele_ids?.values[0].replace(/"|\[|\]/g,"")??"",r=n.split(","),a=i.split(",");for(let s=0;s<a.length;s++)e.push(`${r[s].trim()} (${a[s].trim()})`);return e.join(", ")}catch{return`${t.allele_symbols.values[0].split(",").length}`}else return`${t.allele_symbols.values[0].replace(/"/g,"")}(${t.allele_ids?.values[0].replace(/"|\[|\]/g,"")})`;return""}function rn(t){if(t.variants)return t.variants.length!==1?`${t.variants.length}`:rn(t.variants[0]);if(t.allele_symbols_text?.values){const e=t.allele_symbols_text.values[0].split(",");return e.length>1?`${e.length}`:t.allele_symbols_text.values[0].replace(/"/g,"")}return""}function Xh(t){const e=[];for(const n of t)n.type.toLowerCase()==="deletion"||(n.type.toLowerCase()==="snv"||n.type.toLowerCase()==="point_mutation"?e.push("snv"):n.type.toLowerCase()==="insertion"?e.push("insertion"):(n.type.toLowerCase()==="delins"||n.type.toLowerCase()==="substitution"||n.type.toLowerCase()==="indel"||n.type.toLowerCase()==="mnv")&&e.push("delins"));return[...new Set(e)].sort()}function Bi(t,e){return`<svg width="15" top="3" viewBox="0 -2 15 15" style="display: inline;" xmlns="http://www.w3.org/2000/svg"><rect fill="${t}" stroke="none" height="10" width="10"></svg>${e}</polygons></svg>`}function Ft(t){return t=="unknown"?Bi("grey",t.replace(/_/g," ")):Bi(In[t].color,t.replace(/_/g," "))}function Kh(){let t="<table><tbody>";return t+="<tr>",t+='<td align="center" valign="top"><u><b>Variant types</b></u></td>',t+='<td align="center" valign="top" colspan="2"><u><b>Molecular Consequences</b></u></td>',t+="</tr>",t+="<tr>",t+='<td valign="top" ><ul style="list-style-type:none;">',t+=`<li><svg width="15" top="3" viewBox="-7 -2 15 15" style="display: inline;" xmlns="http://www.w3.org/2000/svg"><polygon stroke="black" fill="black" points="${hr(0)}"></svg>point mutation</polygons></svg></li>`,t+=`<li>${Bi("black","deletion")}</li>`,t+=`<li><svg width="15" top="3" viewBox="-7 -2 15 15" style="display: inline;" xmlns="http://www.w3.org/2000/svg"><polygon stroke="black" fill="black" points="${Cs(0)}"></svg>insertion</polygons></svg></li>`,t+=`<li><svg width="15" top="3" viewBox="-7 -2 15 15" style="display: inline;" xmlns="http://www.w3.org/2000/svg"><polygon stroke="black" fill="black" points="${Fs(0)}"></svg>delins/MNV </polygons></svg></li>`,t+="</ul></td>",t+='<td valign="top" ><ul style="list-style-type:none;">',t+=`<li>${Ft("transcript_ablation")}</li>`,t+=`<li>${Ft("splice_acceptor_variant")}</li>`,t+=`<li>${Ft("splice_donor_variant")}</li>`,t+=`<li>${Ft("stop_gained")}</li>`,t+=`<li>${Ft("frameshift_variant")}</li>`,t+=`<li>${Ft("stop_lost")}</li>`,t+=`<li>${Ft("start_lost")}</li>`,t+=`<li>${Ft("inframe_insertion")}</li>`,t+=`<li>${Ft("inframe_deletion")}</li>`,t+=`<li>${Ft("missense_variant")}</li>`,t+="</ul></td>",t+='<td valign="top" ><ul style="list-style-type:none;">',t+=`<li>${Ft("protein_altering_variant")}</li>`,t+=`<li>${Ft("splice_region_variant")}</li>`,t+=`<li>${Ft("start_retained_variant")}</li>`,t+=`<li>${Ft("stop_retained_variant")}</li>`,t+=`<li>${Ft("synonymous_variant")}</li>`,t+=`<li>${Ft("coding_sequence_variant")}</li>`,t+=`<li>${Ft("five_prime_UTR_variant")}</li>`,t+=`<li>${Ft("three_prime_UTR_variant")}</li>`,t+=`<li>${Ft("intron_variant")}</li>`,t+=`<li>${Ft("non_coding_transcript_variant")}</li>`,t+=`<li>${Ft("unknown")}</li>`,t+="</ul></td>",t+="</tr>",t+="<tr>",t+="<td></td>",t+='<td colspan="2"><a href="https://uswest.ensembl.org/info/genome/variation/prediction/predicted_data.html">Source: Ensembl</a></td>',t+="</tr>",t+="</tbody></table>",t}const pe={UTR:["UTR","five_prime_UTR","three_prime_UTR"],CDS:["CDS"],EXON:["exon"]};function ur(t,e,n){const i={};return n.forEach(r=>{i[r]=100}),t.forEach(r=>{i[r]=200}),e.forEach(r=>{i[r]=1e3}),i}function dr(t,e){return`0,0 0,${t} ${e},${e}`}function pr(t){return t.sort((e,n)=>e.selected&&!n.selected?-1:!e.selected&&n.selected?1:e.name.localeCompare(n.name))}function Pn(t,e=100){try{return t.node()?.getBBox().width??e}catch{return console.debug("Could not get bounding box for label, using fallback width"),e}}function Pi(t,e,n){return e+t>n?t-(e+t-n):t}function _r(){return Ot("body").append("div").attr("class","gfc-tooltip").style("visibility","visible").style("opacity",0)}function gr(t){return()=>{t.transition().duration(100).style("opacity",0).style("visibility","hidden")}}function kt(t,e,n,i){t.transition().duration(200).style("width","auto").style("height","auto").style("opacity",1).style("visibility","visible"),t.html(e).style("left",`${i.pageX+10}px`).style("top",`${i.pageY+10}px`).append("button").attr("type","button").text("Close").on("click",()=>{n()}),t.append("button").attr("type","button").html("&times;").attr("class","tooltipDivX").on("click",()=>{n()})}function Yh(t){return t===1?"+":t===-1?"-":t}function Pt(t){let e="";return e+='<table class="tooltip-table" style="margin-top: 30px;"><tbody>',e+=t.id.includes("http")?`<tr><th>Name</th><td>${t.name}</td></tr>`:`<tr><th>Name</th><td>${t.name} (${t.id})</td></tr>`,e+=`<tr><th>Type</th><td>${t.type}</td></tr>`,e+=`<tr><th>Source</th><td>${t.source}</td></tr>`,e+=`<tr><th>Location</th><td>${t.seqId}:${t.fmin}..${t.fmax} (${Yh(t.strand)})</td></tr>`,e+="</tbody></table>",e}function Gs(t,e,n,i){let r="";if(t==="FlyBase")r=`https://alliancegenome.org/jbrowse/?data=data%2FDrosophila%20melanogaster&tracks=Variants%2CAll%20Genes&highlight=&loc=${e}%3A${n}..${i}`;else if(t==="MGI")r=`https://alliancegenome.org/jbrowse/?data=data%2FMus%20musculus&tracks=Variants%2CAll%20Genes&highlight=&loc=${e}%3A${n}..${i}`;else if(t==="WormBase")r=`https://alliancegenome.org/jbrowse/?data=data%2FCaenorhabditis%20elegans&tracks=Variants%2CAll%20Genes&highlight=&loc=${e}%3A${n}..${i}`;else if(t==="ZFIN")r=`https://alliancegenome.org/jbrowse/?data=data%2FDanio%20rerio&tracks=Variants%2CAll%20Genes&highlight=&loc=${e}%3A${n}..${i}`;else if(t==="SGD")r=`https://alliancegenome.org/jbrowse/?data=data%2FSaccharomyces%20cerevisiae&tracks=Variants%2CAll%20Genes&highlight=&loc=${e}%3A${n}..${i}`;else if(t==="RGD")r=`https://alliancegenome.org/jbrowse/?data=data%2FRattus%20norvegicus&tracks=Variants%2CAll%20Genes&highlight=&loc=${e}%3A${n}..${i}`;else if(t==="human")r=`https://alliancegenome.org/jbrowse/?data=data%2FHomo%20sapiens&tracks=All%20Genes&highlight=&loc=${e}%3A${n}..${i}`;else return console.warn("no source found",t),"Maximum features displayed.  See full view for more.";return`<a href="${r}">Maximum features displayed.  See full view for more.</a>`}const mt=class mt{constructor({viewer:e,height:n,width:i,transcriptTypes:r,variantTypes:a,showVariantLabel:s,variantFilter:o,binRatio:c,isoformFilter:f,initialHighlight:h,trackData:m,variantData:p}){this.trackData=m??[],this.variantData=p??[],this.viewer=e,this.width=i,this.variantFilter=o,this.isoformFilter=f,this.initialHighlight=h,this.height=n,this.transcriptTypes=r,this.variantTypes=a,this.binRatio=c,this.showVariantLabel=s??!0}DrawTrack(){const e=this.isoformFilter;let n=this.trackData;const i=this.initialHighlight,r=this.filterVariantData(this.variantData,this.variantFilter),a=this.viewer,s=this.width,o=this.binRatio,c=Xh(r),f=c.length,h=this.trackData[0].source,m=this.trackData[0].seqId,p=e.length===0?mt.MAX_ROWS:mt.MAX_ROWS_WITH_FILTER,_=pe.UTR,T=pe.CDS,C=pe.EXON,I=this.transcriptTypes,N=Ls(n,I),E=N.fmin,b=N.fmax,y=mt.EXON_HEIGHT,S=mt.CDS_HEIGHT,D=mt.ISOFORM_HEIGHT,k=mt.GENE_LABEL_HEIGHT,F=mt.MIN_WIDTH,z=mt.ISOFORM_TITLE_HEIGHT,L=mt.UTR_HEIGHT,v=mt.VARIANT_HEIGHT,Z=mt.TRANSCRIPT_BACKBONE_HEIGHT,P=mt.ARROW_HEIGHT,Q=mt.ARROW_WIDTH,nt=dr(P,Q),it=mt.SNV_WIDTH,W=mt.VARIANT_TRACK_HEIGHT,st=mt.LABEL_PADDING,q=me().domain([E,b]).range([0,s]),V=a.append("g").attr("class","deletions track").attr("transform","translate(0,22.5)"),It=a.append("g").attr("class","label"),Et=ur(_,T,C),dt={};n=pr(n);let Tt=0;const ct=_r(),tt=gr(ct),ot=zs(r,(b-E)*o),at=ot.filter(bt=>bt.type==="deletion"),St=ot.filter(bt=>bt.type!=="deletion"),Dt=[];at.forEach(bt=>{const{fmax:pt,fmin:ht}=bt,ut=this.width,$t=rn(bt),G=Ci(bt),Mt=Fi(bt),ft=Hi(G),lt=zi(G)[0];Dt.push({fmin:ht,fmax:pt,row:Kr(Dt,ht,pt)});const Nt=Math.max(Math.ceil(q(pt)-q(ht)),F);V.append("rect").attr("class","variant-deletion").attr("id",`variant-${ht}`).attr("x",q(ht)).attr("transform",`translate(0,${v*Kr(Dt,ht,pt)})`).attr("z-index",30).attr("fill",lt).attr("height",v).attr("width",Nt).on("click",w=>{kt(ct,ft,tt,w)}).on("mouseover",w=>{const A=w.variant;ee(".variant-deletion").filter(u=>u.variant===A).style("stroke","black"),Ot(".label").selectAll(".variantLabel,.variantLabelBackground").raise().filter(u=>u.variant===A).style("opacity",1)}).on("mouseout",()=>{ee(".variant-deletion").filter(w=>w.selected!=="true").style("stroke",null),Ot(".label").selectAll(".variantLabel,.variantLabelBackground").style("opacity",0)}).datum({fmin:ht,fmax:pt,variant:$t+ht,alleles:Mt});let g=q(ht);const O=v*f+st,H=It.append("text").attr("class","variantLabel").attr("fill",lt).attr("opacity",0).attr("height",z).attr("transform",`translate(${g},${O})`).text($t).on("click",w=>{kt(ct,ft,tt,w)}).datum({fmin:ht,variant:$t+ht}),U=Pn(H,0);g=Pi(g,U,ut),H.attr("transform",`translate(${g},${O})`)});const Lt=Ue(this.viewer),X=a.append("g").attr("class","variants track").attr("transform",`translate(0,${Lt})`);St.forEach(bt=>{const{type:pt,fmax:ht,fmin:ut}=bt;let $t=!0,G=!1;const Mt=this.width,ft=rn(bt),lt=Ci(bt),Nt=Fi(bt),g=Hi(lt),O=zi(lt)[0];if(pt.toLowerCase()==="snv"||pt.toLowerCase()==="point_mutation"?(G=!0,X.append("polygon").attr("class","variant-SNV").attr("id",`variant-${ut}`).attr("points",hr(q(ut))).attr("fill",O).attr("x",q(ut)).attr("transform",`translate(0,${v*c.indexOf("snv")})`).attr("z-index",30).on("click",H=>{kt(ct,g,tt,H)}).on("mouseover",function(H){const U=H.variant;ee(".variant-SNV").filter(w=>w.variant===U).style("stroke","black"),Ot(".label").selectAll(".variantLabel,.variantLabelBackground").raise().filter(w=>w.variant===U).style("opacity",1)}).on("mouseout",()=>{ee(".variant-SNV").filter(H=>H.selected!="true").style("stroke",null),Ot(".label").selectAll(".variantLabel,.variantLabelBackground").style("opacity",0)}).datum({fmin:ut,fmax:ht,variant:ft+ut,alleles:Nt})):pt.toLowerCase()==="insertion"?(G=!0,X.append("polygon").attr("class","variant-insertion").attr("id",`variant-${ut}`).attr("points",Cs(q(ut))).attr("fill",O).attr("x",q(ut)).attr("transform",`translate(0,${v*c.indexOf("insertion")})`).attr("z-index",30).on("click",H=>{kt(ct,g,tt,H)}).on("mouseover",H=>{const U=H.variant;ee(".variant-insertion").filter(w=>w.variant===U).style("stroke","black"),Ot(".label").selectAll(".variantLabel,.variantLabelBackground").raise().filter(w=>w.variant===U).style("opacity",1)}).on("mouseout",()=>{ee(".variant-insertion").filter(H=>H.selected!="true").style("stroke",null),Ot(".label").selectAll(".variantLabel,.variantLabelBackground").style("opacity",0)}).datum({fmin:ut,fmax:ht,variant:ft+ut,alleles:Nt})):pt.toLowerCase()==="delins"||pt.toLowerCase()==="substitution"||pt.toLowerCase()==="indel"||pt.toLowerCase()==="mnv"?(G=!0,X.append("polygon").attr("class","variant-delins").attr("id",`variant-${ut}`).attr("points",Fs(q(ut))).attr("x",q(ut)).attr("transform",`translate(0,${v*c.indexOf("delins")})`).attr("fill",O).attr("z-index",30).on("click",H=>{kt(ct,g,tt,H)}).on("mouseover",H=>{const U=H.variant;ee(".variant-delins").filter(w=>w.variant===U).style("stroke","black"),Ot(".label").selectAll(".variantLabel,.variantLabelBackground").raise().filter(w=>w.variant===U).style("opacity",1)}).on("mouseout",()=>{ee(".variant-delins").filter(H=>H.selected!="true").style("stroke",null),Ot(".label").selectAll(".variantLabel,.variantLabelBackground").style("opacity",0)}).datum({fmin:ut,fmax:ht,variant:ft+ut,alleles:Nt})):(console.warn("type not found",pt,bt),$t=!1),$t){let H=0;H=G?q(ut)-it/2:q(ut);const U=v*f+st,w=It.append("text").attr("class","variantLabel").attr("fill",O).attr("opacity",0).attr("height",z).attr("transform",`translate(${H},${U})`).text(ft).on("click",u=>{kt(ct,g,tt,u)}).datum({fmin:ut,variant:ft+ut}),A=Pn(w,0);H=Pi(H,A,Mt),w.attr("transform",`translate(${H},${U})`)}});const _t=Lt;It.attr("transform",`translate(0,${_t})`);const At=Ue(this.viewer)+st,yt=a.append("g").attr("transform",`translate(0,${At})`).attr("class","track");let xt=0;const K=[];let rt=-1,Ht=-1;const Zt=[];for(let bt=0;bt<n.length&&xt<p;bt++){const pt=n[bt];let ht=pt.children;if(ht){const ut=pt.selected;ht=ht.sort((G,Mt)=>G.name.localeCompare(Mt.name));let $t=!1;ht.forEach(G=>{if(!(e.includes(G.id)||e.includes(G.name))&&e.length!==0||Zt.includes(G.id))return;Zt.push(G.id);const Mt=G.type;if(I.includes(Mt)){let ft=cr(K,q(G.fmin),q(G.fmax));if(xt<p){let lt="",Nt,g=!1;const O=pt.name;Object.keys(dt).includes(O)||(Tt+=k,g=!0,dt[O]="Green");const H=yt.append("g").attr("class","isoform").attr("transform",`translate(0,${xt*D+10+Tt})`);g&&(lt=O,Nt=H.append("text").attr("class","geneLabel").attr("fill",ut?"sandybrown":"black").attr("height",z).attr("transform",`translate(${q(G.fmin)},-${k})`).text(lt).on("click",A=>{kt(ct,Pt(pt),tt,A)}).datum({fmin:G.fmin})),H.append("polygon").datum(()=>({fmin:G.fmin,fmax:G.fmax,strand:pt.strand})).attr("class","transArrow").attr("points",nt).attr("transform",A=>pt.strand>0?`translate(${q(A.fmax)},0)`:`translate(${q(A.fmin)},${P}) rotate(180)`).on("click",A=>{kt(ct,Pt(G),tt,A)}),H.append("rect").attr("class","transcriptBackbone").attr("y",10+z).attr("height",Z).attr("transform",`translate(${q(G.fmin)},0)`).attr("width",q(G.fmax)-q(G.fmin)).on("click",A=>{kt(ct,Pt(G),tt,A)}).datum({fmin:G.fmin,fmax:G.fmax}),lt=G.name,Nt=H.append("text").attr("class","transcriptLabel").attr("fill",ut?"sandybrown":"gray").attr("opacity",ut?1:.5).attr("height",z).attr("transform",`translate(${q(G.fmin)},0)`).text(lt).on("click",A=>{kt(ct,Pt(G),tt,A)}).datum({fmin:G.fmin});let U=lt.length*2;try{U=Nt.node()?.getBBox().width??0}catch{}U+q(G.fmin)>s;const w=U>q(G.fmax)-q(G.fmin)?q(G.fmin)+U:q(G.fmax);if(K[ft]){const A=K[ft];A.push(`${q(G.fmin)}:${w}`),K[ft]=A}else K[ft]=[`${q(G.fmin)}:${w}`];(rt<0||rt>G.fmin)&&(rt=G.fmin),(Ht<0||Ht<G.fmax)&&(Ht=G.fmax),G.children&&(G.children=G.children.sort((A,u)=>{const B=Et[A.type],j=Et[u.type];return typeof B=="number"&&typeof j=="number"?B-j:typeof B=="number"&&typeof j!="number"?-1:typeof B!="number"&&typeof j=="number"?1:A.type.localeCompare(u.type)}),G.children.forEach(A=>{const u=A.type;C.includes(u)?H.append("rect").attr("class","exon").attr("x",q(A.fmin)).attr("transform",`translate(0,${y-Z})`).attr("height",y).attr("z-index",10).attr("width",q(A.fmax)-q(A.fmin)).on("click",B=>{kt(ct,Pt(G),tt,B)}).datum({fmin:A.fmin,fmax:A.fmax}):T.includes(u)?H.append("rect").attr("class","CDS").attr("x",q(A.fmin)).attr("transform",`translate(0,${S-Z})`).attr("z-index",20).attr("height",S).attr("width",q(A.fmax)-q(A.fmin)).on("click",B=>{kt(ct,Pt(G),tt,B)}).datum({fmin:A.fmin,fmax:A.fmax}):_.includes(u)&&H.append("rect").attr("class","UTR").attr("x",q(A.fmin)).attr("transform",`translate(0,${L-Z})`).attr("z-index",20).attr("height",L).attr("width",q(A.fmax)-q(A.fmin)).on("click",B=>{kt(ct,Pt(G),tt,B)}).datum({fmin:A.fmin,fmax:A.fmax})})),xt+=1}if(xt===p&&!$t){const lt=Gs(h,m,E,b);++ft,$t=!0,yt.append("a").attr("class","transcriptLabel").attr("xlink:show","new").append("text").attr("x",10).attr("y",10).attr("transform",`translate(0,${xt*D+20+Tt})`).attr("fill","red").attr("opacity",1).attr("height",z).html(lt)}}})}}return i&&fr(i,a),xt===0&&yt.append("text").attr("x",30).attr("y",z+10).attr("fill","orange").attr("opacity",.6).text("Overview of non-coding genome features unavailable at this time."),xt*D+Tt+W}filterVariantData(e,n){return n.length===0?e:e.filter(i=>{let r=!1;try{(n.includes(i.name)||i.allele_symbols?.values&&n.includes(i.allele_symbols.values[0].replace(/"/g,""))||i.symbol?.values&&n.includes(i.symbol.values[0].replace(/"/g,""))||i.symbol_text?.values&&n.includes(i.symbol_text.values[0].replace(/"/g,"")))&&(r=!0),(i.allele_ids?.values[0].replace(/"|\[|\]| /g,"").split(",")??[]).forEach(s=>{n.includes(s)&&(r=!0)})}catch(a){console.error("error processing filter with so returning anyway",n,i,a),r=!0}return r})}setInitialHighlight(e,n){const i=n.node()?.getBBox().height??0;n.selectAll(".variant-deletion,.variant-SNV,.variant-insertion,.variant-delins").filter(a=>{let s=!1;return a.alleles&&(a.alleles[0].replace(/"|\[|\]| /g,"").split(",").forEach(c=>{e.includes(c)&&(s=!0)}),a.alleles.forEach(c=>{e.includes(c)&&(s=!0)})),s}).datum(a=>(a.selected="true",a)).style("stroke","black").each(function(){const a=+(Ot(this).attr("width")||3),s=+Ot(this).attr("x")-a/2;n.select(".deletions.track").append("rect").attr("class","highlight").attr("x",s).attr("width",a).attr("height",i).attr("fill","yellow").attr("opacity",.8).lower()})}};mt.EXON_HEIGHT=10,mt.CDS_HEIGHT=10,mt.ISOFORM_HEIGHT=40,mt.GENE_LABEL_HEIGHT=20,mt.MIN_WIDTH=2,mt.ISOFORM_TITLE_HEIGHT=0,mt.UTR_HEIGHT=10,mt.VARIANT_HEIGHT=10,mt.TRANSCRIPT_BACKBONE_HEIGHT=4,mt.ARROW_HEIGHT=20,mt.ARROW_WIDTH=10,mt.SNV_WIDTH=10,mt.VARIANT_TRACK_HEIGHT=40,mt.LABEL_PADDING=22.5,mt.MAX_ROWS=9,mt.MAX_ROWS_WITH_FILTER=30;let Gi=mt;const wt=class wt{constructor({viewer:e,height:n,width:i,transcriptTypes:r,variantTypes:a,showVariantLabel:s,variantFilter:o,initialHighlight:c,trackData:f,variantData:h}){this.trackData=f??[],this.variantData=h??[],this.viewer=e,this.width=i,this.variantFilter=o,this.initialHighlight=c,this.height=n,this.transcriptTypes=r,this.variantTypes=a,this.showVariantLabel=s??!0}DrawTrack(){const e=this.variantData;let i=this.trackData;const r=this.filterVariantData(e,this.variantFilter),a=zs(r,1),s=new Map;a.forEach(X=>{const _t=Fi(X);s.set(X,_t)});const o=this.viewer,c=this.width,f=this.showVariantLabel,h=pe.UTR,m=pe.CDS,p=pe.EXON,_=this.transcriptTypes,T=Ls(i,_),C=T.fmin,I=T.fmax,N=wt.MAX_ROWS,E=wt.EXON_HEIGHT,b=wt.CDS_HEIGHT,y=wt.ISOFORM_HEIGHT,S=wt.GENE_LABEL_HEIGHT,D=wt.MIN_WIDTH,k=wt.ISOFORM_TITLE_HEIGHT,F=wt.UTR_HEIGHT,z=wt.VARIANT_HEIGHT,L=wt.VARIANT_OFFSET,v=wt.TRANSCRIPT_BACKBONE_HEIGHT,Z=wt.ARROW_HEIGHT,P=wt.ARROW_WIDTH,Q=dr(Z,P),nt=wt.SNV_HEIGHT,it=wt.SNV_WIDTH,W=X=>`${X-it/2},${nt} ${X},0 ${X+it/2},${nt}`,st=X=>`${X-it/2},${nt} ${X+it/2},${nt} ${X-it/2},0 ${X+it/2},0`,q=X=>`${X},${nt} ${X+it/2},${nt/2} ${X},0 ${X-it/2},${nt/2}`,V=me().domain([C,I]).range([0,c]),It=Ue(this.viewer),Et=o.append("g").attr("transform",`translate(0,${It})`).attr("class","track"),dt=ur(h,m,p),Tt={};i=pr(i);let ct=0;const tt=_r(),ot=gr(tt);let at=0;const St=[];let Dt=-1,Lt=-1;for(let X=0;X<i.length&&at<N;X++){const _t=i[X];let At=_t.children;if(At){const yt=_t.selected;At=At.sort((K,rt)=>K.name<rt.name?-1:K.name>rt.name?1:K-rt);let xt=!1;At.forEach(K=>{const rt=K.type;if(_.includes(rt)){let Ht=cr(St,V(K.fmin),V(K.fmax));if(at<N){let Zt,bt,pt=!1;Object.keys(Tt).includes(_t.name)||(ct+=S,pt=!0,Tt[_t.name]="Green");const ht=Et.append("g").attr("class","isoform").attr("transform",`translate(0,${at*y+10+ct})`);pt&&(Zt=_t.name,bt=ht.append("text").attr("class","geneLabel").attr("fill",yt?"sandybrown":"black").attr("height",k).attr("transform",`translate(${V(K.fmin)},-${S})`).text(Zt).on("click",G=>{kt(tt,Pt(_t),ot,G)}).datum({fmin:K.fmin})),ht.append("polygon").datum(()=>({fmin:K.fmin,fmax:K.fmax,strand:_t.strand})).attr("class","transArrow").attr("points",Q).attr("transform",G=>_t.strand>0?`translate(${V(G.fmax)},0)`:`translate(${V(G.fmin)},${Z}) rotate(180)`).on("click",G=>{kt(tt,Pt(K),ot,G)}),ht.append("rect").attr("class","transcriptBackbone").attr("y",10+k).attr("height",v).attr("transform",`translate(${V(K.fmin)},0)`).attr("width",V(K.fmax)-V(K.fmin)).on("click",G=>{kt(tt,Pt(K),ot,G)}).datum({fmin:K.fmin,fmax:K.fmax}),Zt=K.name,bt=ht.append("text").attr("class","transcriptLabel").attr("fill",yt?"sandybrown":"gray").attr("opacity",yt?1:.5).attr("height",k).attr("transform",`translate(${V(K.fmin)},0)`).text(Zt).on("click",G=>{kt(tt,Pt(K),ot,G)}).datum({fmin:K.fmin});let ut=Zt.length*2;try{ut=bt.node().getBBox().width}catch{}ut+V(K.fmin)>c;const $t=ut>V(K.fmax)-V(K.fmin)?V(K.fmin)+ut:V(K.fmax);if(St[Ht]){const G=St[Ht];G.push(`${V(K.fmin)}:${$t}`),St[Ht]=G}else St[Ht]=[`${V(K.fmin)}:${$t}`];(Dt<0||Dt>K.fmin)&&(Dt=K.fmin),(Lt<0||Lt<K.fmax)&&(Lt=K.fmax),K.children&&(K.children=K.children.sort((G,Mt)=>{const ft=dt[G.type],lt=dt[Mt.type];return typeof ft=="number"&&typeof lt=="number"?ft-lt:typeof ft=="number"&&typeof lt!="number"?-1:typeof ft!="number"&&typeof lt=="number"?1:G.type-Mt.type}),K.children.forEach(G=>{const Mt=G.type;let ft=!1;p.includes(Mt)?(ft=!0,ht.append("rect").attr("class","exon").attr("x",V(G.fmin)).attr("transform",`translate(0,${E-v})`).attr("height",E).attr("z-index",10).attr("width",V(G.fmax)-V(G.fmin)).on("click",lt=>{kt(tt,Pt(K),ot,lt)}).datum({fmin:G.fmin,fmax:G.fmax})):m.includes(Mt)?(ft=!0,ht.append("rect").attr("class","CDS").attr("x",V(G.fmin)).attr("transform",`translate(0,${b-v})`).attr("z-index",20).attr("height",b).attr("width",V(G.fmax)-V(G.fmin)).on("click",lt=>{kt(tt,Pt(K),ot,lt)}).datum({fmin:G.fmin,fmax:G.fmax})):h.includes(Mt)&&(ft=!0,ht.append("rect").attr("class","UTR").attr("x",V(G.fmin)).attr("transform",`translate(0,${F-v})`).attr("z-index",20).attr("height",F).attr("width",V(G.fmax)-V(G.fmin)).on("click",lt=>{kt(tt,Pt(K),ot,lt)}).datum({fmin:G.fmin,fmax:G.fmax})),ft&&a.forEach(lt=>{const{type:Nt,fmax:g,fmin:O}=lt;if(O<G.fmin&&g>G.fmin||g>G.fmax&&O<G.fmax||g<=G.fmax&&O>=G.fmin){let U=!0;const w=Ci(lt),A=zi(w)[0],u=Hi(w),B=Math.max(Math.ceil(V(g)-V(O)),D);if(Nt.toLowerCase()==="deletion"||Nt.toLowerCase()==="mnv"?ht.append("rect").attr("class","variant-deletion").attr("x",V(O)).attr("transform",`translate(0,${L-v})`).attr("z-index",30).attr("fill",A).attr("height",z).attr("width",B).on("click",j=>{kt(tt,u,ot,j)}).datum({fmin:O,fmax:g,alleles:s.get(lt)??[]}):Nt.toLowerCase()==="snv"||Nt.toLowerCase()==="point_mutation"?ht.append("polygon").attr("class","variant-SNV").attr("points",q(V(O))).attr("fill",A).attr("x",V(O)).attr("transform",`translate(0,${L-v})`).attr("z-index",30).on("click",j=>{kt(tt,u,ot,j)}).datum({fmin:O,fmax:g,alleles:s.get(lt)??[]}):Nt.toLowerCase()==="insertion"?ht.append("polygon").attr("class","variant-insertion").attr("points",W(V(O))).attr("fill",A).attr("x",V(O)).attr("transform",`translate(0,${L-v})`).attr("z-index",30).on("click",j=>{kt(tt,u,ot,j)}).datum({fmin:O,fmax:g,alleles:s.get(lt)??[]}):Nt.toLowerCase()==="delins"||Nt.toLowerCase()==="substitution"||Nt.toLowerCase()==="indel"?ht.append("polygon").attr("class","variant-delins").attr("points",st(V(O))).attr("x",V(O)).attr("transform",`translate(0,${L-v})`).attr("fill",A).attr("z-index",30).on("click",j=>{kt(tt,u,ot,j)}).datum({fmin:O,fmax:g,alleles:s.get(lt)??[]}):U=!1,U&&f){const j=rn(lt),l=j.length||1;ht.append("text").attr("class","variantLabel").attr("fill",yt?"sandybrown":A).attr("opacity",yt?1:.5).attr("height",k).attr("transform",`translate(${V(O-l/2*100)},${L*2.2-v})`).html(j).on("click",R=>{kt(tt,u,ot,R)}).datum({fmin:K.fmin})}}})})),at+=1}at===N&&!xt&&(++Ht,xt=!0,Et.append("a").attr("class","transcriptLabel").attr("xlink:show","new").append("text").attr("x",10).attr("y",10).attr("transform",`translate(0,${at*y+20+ct})`).attr("fill","red").attr("opacity",1).attr("height",k).text("Maximum features displayed.  See full view for more."))}})}}if(at===0&&Et.append("text").attr("x",30).attr("y",k+10).attr("fill","orange").attr("opacity",.6).text("Overview of non-coding genome features unavailable at this time."),this.initialHighlight)try{fr(this.initialHighlight,this.viewer)}catch{}return at*y+ct}filterVariantData(e,n){if(n.length===0)return e;const i=new Set(n);return e.filter(a=>{let s=!1;try{if(i.has(a.name)&&(s=!0),a.allele_symbols?.values){const c=a.allele_symbols.values[0].replace(/"|\\[|\\]| /g,"");i.has(c)&&(s=!0)}if(a.symbol?.values){const c=a.symbol.values[0].replace(/"|\\[|\\]| /g,"");i.has(c)&&(s=!0)}if(a.symbol_text?.values){const c=a.symbol_text.values[0].replace(/"|\\[|\\]| /g,"");i.has(c)&&(s=!0)}const o=a.allele_ids?.values?.[0];if(o){let c=[];if(o.startsWith("[")&&o.endsWith("]"))try{const f=JSON.parse(o);c=(Array.isArray(f)?f:[f]).map(String)}catch{c=o.replace(/"|\\[|\\]| /g,"").split(",")}else c=o.replace(/"|\\[|\\]| /g,"").split(",");for(const f of c)if(i.has(f)){s=!0;break}}}catch{s=!0}return s})}};wt.MAX_ROWS=10,wt.EXON_HEIGHT=10,wt.CDS_HEIGHT=10,wt.ISOFORM_HEIGHT=40,wt.GENE_LABEL_HEIGHT=20,wt.MIN_WIDTH=2,wt.ISOFORM_TITLE_HEIGHT=0,wt.UTR_HEIGHT=10,wt.VARIANT_HEIGHT=10,wt.VARIANT_OFFSET=20,wt.TRANSCRIPT_BACKBONE_HEIGHT=4,wt.ARROW_HEIGHT=20,wt.ARROW_WIDTH=10,wt.SNV_HEIGHT=10,wt.SNV_WIDTH=10;let Ui=wt;const Bt=class Bt{constructor({viewer:e,height:n,width:i,transcriptTypes:r,htpVariant:a,trackData:s,region:o,genome:c}){this.trackData=s??[],this.viewer=e,this.width=i,this.height=n,this.transcriptTypes=r,this.htpVariant=a,this.region=o,this.genome=c}DrawTrack(){let e=this.trackData;const n=this.htpVariant,i=this.viewer,r=this.width,a=this.genome,s=e[0]?.seqId,o=Bt.MAX_ROWS,c=pe.UTR,f=pe.CDS,h=pe.EXON,m=this.transcriptTypes,p=Bt.EXON_HEIGHT,_=Bt.CDS_HEIGHT,T=Bt.ISOFORM_HEIGHT,C=Bt.ISOFORM_TITLE_HEIGHT,I=Bt.UTR_HEIGHT,N=Bt.TRANSCRIPT_BACKBONE_HEIGHT,E=Bt.ARROW_HEIGHT,b=Bt.ARROW_WIDTH,y=dr(E,b),S=me().domain([this.region.start,this.region.end]).range([0,r]),D=ur(c,f,h);e=pr(e);const k=_r(),F=gr(k);if(n){const it=i.append("g").attr("class","variants track").attr("transform","translate(0,22.5)"),[,W]=n.split(":");it.append("polygon").attr("class","variant-SNV").attr("points",hr(S(+W))).attr("fill","red").attr("x",S(+W)).attr("z-index",30)}const z=Ue(this.viewer),L=i.append("g").attr("transform",`translate(0,${z})`).attr("class","track");let v=0;const Z=[];let P=-1,Q=-1;const nt=[];for(let it=0;it<e.length&&v<o;it++){const W=e[it];let st=W.children;if(st){const q=W.selected;st=st.sort((V,It)=>V.name<It.name?-1:V.name>It.name?1:0),st.forEach(V=>{const It=V.type;if(!nt.includes(V.id)&&(nt.push(V.id),m.includes(It))){let Et=cr(Z,S(V.fmin),S(V.fmax));if(v<o){const dt=L.append("g").attr("class","isoform").attr("transform",`translate(0,${v*T+10})`),Tt=Math.max(S(V.fmin),0),ct=Math.min(S(V.fmax),this.width);dt.append("polygon").datum(()=>({strand:W.strand})).attr("class","transArrow").attr("points",y).attr("transform",()=>W.strand>0?`translate(${ct},0)`:`translate(${Tt},${arrow_height}) rotate(180)`).on("click",X=>{kt(k,Pt(V),F,X)}),dt.append("rect").attr("class","transcriptBackbone").attr("y",10+C).attr("height",N).attr("transform",`translate(${Tt},0)`).attr("width",ct-Tt).datum({fmin:V.fmin,fmax:V.fmax}).on("click",X=>{kt(k,Pt(V),F,X)});let tt=V.name;W.name!==V.name&&(tt+=` (${W.name})`);let ot=Math.max(S(V.fmin),0);const at=dt.append("svg:text").attr("class","transcriptLabel").attr("fill",q?"sandybrown":"gray").attr("opacity",q?1:.5).attr("height",C).attr("transform",`translate(${ot},0)`).text(tt).datum({fmin:V.fmin}).on("click",X=>{kt(k,Pt(V),F,X)}),St=Pn(at);ot=Pi(ot,St,this.width),at.attr("transform",`translate(${ot},0)`);const Dt=Pn(at,tt.length*2),Lt=Dt>S(V.fmax)-S(V.fmin)?S(V.fmin)+Dt:S(V.fmax);if(Z[Et]){const X=Z[Et];X.push(`${S(V.fmin)}:${Lt}`),Z[Et]=X}else Z[Et]=[`${S(V.fmin)}:${Lt}`];(P<0||P>V.fmin)&&(P=V.fmin),(Q<0||Q<V.fmax)&&(Q=V.fmax),V.children&&(V.children=V.children.sort(function(X,_t){const At=D[X.type],yt=D[_t.type];return typeof At=="number"&&typeof yt=="number"?At-yt:typeof At=="number"&&typeof yt!="number"?-1:typeof At!="number"&&typeof yt=="number"?1:X.type.localeCompare(_t.type)}),V.children.forEach(X=>{const _t=X.type;if(S(X.fmin)>this.width||S(X.fmax)<0)return;const At=Math.max(S(X.fmin),0),yt=Math.min(S(X.fmax),this.width);h.includes(_t)?dt.append("rect").attr("class","exon").attr("x",At).attr("transform",`translate(0,${p-N})`).attr("height",p).attr("z-index",10).attr("width",yt-At).datum({fmin:X.fmin,fmax:X.fmax}).on("click",xt=>{kt(k,Pt(V),F,xt)}):f.includes(_t)?dt.append("rect").attr("class","CDS").attr("x",At).attr("transform",`translate(0,${_-N})`).attr("z-index",20).attr("height",_).attr("width",yt-At).datum({fmin:X.fmin,fmax:X.fmax}).on("click",xt=>{kt(k,Pt(V),F,xt)}):c.includes(_t)&&dt.append("rect").attr("class","UTR").attr("x",At).attr("transform",`translate(0,${I-N})`).attr("z-index",20).attr("height",I).attr("width",yt-At).datum({fmin:X.fmin,fmax:X.fmax}).on("click",xt=>{kt(k,Pt(V),F,xt)})})),v+=1}if(v===o){const dt=Gs(a,s,this.region.start,this.region.end);++Et,L.append("a").attr("class","transcriptLabel").attr("xlink:show","new").append("text").attr("x",10).attr("transform",`translate(0,${v*T+10})`).attr("fill","red").attr("opacity",1).attr("height",C).html(dt)}}})}}return v===0&&L.append("text").attr("x",30).attr("y",C+10).attr("fill","orange").attr("opacity",.6).text("Overview of non-coding genome features unavailable at this time."),v*T}};Bt.MAX_ROWS=10,Bt.EXON_HEIGHT=10,Bt.CDS_HEIGHT=10,Bt.ISOFORM_HEIGHT=40,Bt.ISOFORM_TITLE_HEIGHT=0,Bt.UTR_HEIGHT=10,Bt.TRANSCRIPT_BACKBONE_HEIGHT=4,Bt.ARROW_HEIGHT=20,Bt.ARROW_WIDTH=10;let Vi=Bt;class Jh{constructor({viewer:e,track:n,height:i,width:r}){this.refSeq="",this.viewer=e,this.width=r,this.height=i,this.track=n}DrawScrollableTrack(){const e=this.viewer,n=this.refSeq,i=me().domain([this.track.start,this.track.end+1]).range(this.track.range),r=Xo(i).tickValues(this._getRefTick(this.track.start+1,this.track.end)).tickFormat((c,f)=>n[f]).tickSize(8).tickSizeInner(8).tickPadding(6),a=Math.floor(n.length/10),s=Ar(i).ticks(a).tickValues(this._getRefTick(this.track.start+1,this.track.end,10));e.append("g").attr("class","axis x-local-axis track").attr("width",this.track.range[1]).attr("transform","translate(0, 20)").call(r),e.append("g").attr("class","axis x-local-numerical track").attr("width",this.track.range[1]).attr("transform","translate(0, 20)").call(s);const o=ee(".x-local-numerical .tick text");o.first().attr("text-anchor","start"),o.last().attr("text-anchor","end"),ee(".x-local-axis .tick text").each(function(){const f=Ot(this).text();let h="nucleotide nt-a";f==="T"?h="nucleotide nt-t":f==="C"?h="nucleotide nt-c":f==="G"&&(h="nucleotide nt-g"),Ot(this.parentNode).append("rect").attr("class",h).attr("transform","translate(-8,8)")})}DrawOverviewTrack(){const e=this.viewer,n=this.track.start,i=this.track.end,r=this.width,a=me().domain([n,i]).range(this.track.range),s=Ar(a).ticks(8,"s").tickSize(8);e.append("g").attr("class","axis track").attr("width",r).attr("height",20).attr("transform","translate(0,20)").call(s)}_getRefTick(e,n,i){return i?new Array(Math.ceil((n-e+1)/10)).fill(0).map((r,a)=>e+a*10):new Array(n-e+1).fill(0).map((r,a)=>e+a)}async getTrackData(){}}const qe={ISOFORM_EMBEDDED_VARIANT:"ISOFORM_EMBEDDED_VARIANT",ISOFORM_AND_VARIANT:"ISOFORM_AND_VARIANT",ISOFORM:"ISOFORM",VARIANT:"VARIANT",VARIANT_GLOBAL:"VARIANT_GLOBAL"};var Qt="$";function Gn(){}Gn.prototype=mr.prototype={constructor:Gn,has:function(t){return Qt+t in this},get:function(t){return this[Qt+t]},set:function(t,e){return this[Qt+t]=e,this},remove:function(t){var e=Qt+t;return e in this&&delete this[e]},clear:function(){for(var t in this)t[0]===Qt&&delete this[t]},keys:function(){var t=[];for(var e in this)e[0]===Qt&&t.push(e.slice(1));return t},values:function(){var t=[];for(var e in this)e[0]===Qt&&t.push(this[e]);return t},entries:function(){var t=[];for(var e in this)e[0]===Qt&&t.push({key:e.slice(1),value:this[e]});return t},size:function(){var t=0;for(var e in this)e[0]===Qt&&++t;return t},empty:function(){for(var t in this)if(t[0]===Qt)return!1;return!0},each:function(t){for(var e in this)e[0]===Qt&&t(this[e],e.slice(1),this)}};function mr(t,e){var n=new Gn;if(t instanceof Gn)t.each(function(o,c){n.set(c,o)});else if(Array.isArray(t)){var i=-1,r=t.length,a;if(e==null)for(;++i<r;)n.set(i,t[i]);else for(;++i<r;)n.set(e(a=t[i],i,t),a)}else if(t)for(var s in t)n.set(s,t[s]);return n}function Jr(){}var we=mr.prototype;Jr.prototype={constructor:Jr,has:we.has,add:function(t){return t+="",this[Qt+t]=t,this},remove:we.remove,clear:we.clear,values:we.keys,size:we.size,empty:we.empty,each:we.each};var Zi="http://www.w3.org/1999/xhtml";const Qr={svg:"http://www.w3.org/2000/svg",xhtml:Zi,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Us(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),Qr.hasOwnProperty(e)?{space:Qr[e],local:t}:t}function Qh(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Zi&&e.documentElement.namespaceURI===Zi?e.createElement(t):e.createElementNS(n,t)}}function jh(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Vs(t){var e=Us(t);return(e.local?jh:Qh)(e)}function tu(){}function Zs(t){return t==null?tu:function(){return this.querySelector(t)}}function eu(t){typeof t!="function"&&(t=Zs(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var a=e[r],s=a.length,o=i[r]=new Array(s),c,f,h=0;h<s;++h)(c=a[h])&&(f=t.call(c,c.__data__,h,a))&&("__data__"in c&&(f.__data__=c.__data__),o[h]=f);return new Kt(i,this._parents)}function nu(){return[]}function iu(t){return t==null?nu:function(){return this.querySelectorAll(t)}}function ru(t){typeof t!="function"&&(t=iu(t));for(var e=this._groups,n=e.length,i=[],r=[],a=0;a<n;++a)for(var s=e[a],o=s.length,c,f=0;f<o;++f)(c=s[f])&&(i.push(t.call(c,c.__data__,f,s)),r.push(c));return new Kt(i,r)}function au(t){return function(){return this.matches(t)}}function su(t){typeof t!="function"&&(t=au(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var a=e[r],s=a.length,o=i[r]=[],c,f=0;f<s;++f)(c=a[f])&&t.call(c,c.__data__,f,a)&&o.push(c);return new Kt(i,this._parents)}function qs(t){return new Array(t.length)}function ou(){return new Kt(this._enter||this._groups.map(qs),this._parents)}function Un(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Un.prototype={constructor:Un,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function lu(t){return function(){return t}}var jr="$";function cu(t,e,n,i,r,a){for(var s=0,o,c=e.length,f=a.length;s<f;++s)(o=e[s])?(o.__data__=a[s],i[s]=o):n[s]=new Un(t,a[s]);for(;s<c;++s)(o=e[s])&&(r[s]=o)}function fu(t,e,n,i,r,a,s){var o,c,f={},h=e.length,m=a.length,p=new Array(h),_;for(o=0;o<h;++o)(c=e[o])&&(p[o]=_=jr+s.call(c,c.__data__,o,e),_ in f?r[o]=c:f[_]=c);for(o=0;o<m;++o)_=jr+s.call(t,a[o],o,a),(c=f[_])?(i[o]=c,c.__data__=a[o],f[_]=null):n[o]=new Un(t,a[o]);for(o=0;o<h;++o)(c=e[o])&&f[p[o]]===c&&(r[o]=c)}function hu(t,e){if(!t)return _=new Array(this.size()),f=-1,this.each(function(D){_[++f]=D}),_;var n=e?fu:cu,i=this._parents,r=this._groups;typeof t!="function"&&(t=lu(t));for(var a=r.length,s=new Array(a),o=new Array(a),c=new Array(a),f=0;f<a;++f){var h=i[f],m=r[f],p=m.length,_=t.call(h,h&&h.__data__,f,i),T=_.length,C=o[f]=new Array(T),I=s[f]=new Array(T),N=c[f]=new Array(p);n(h,m,C,I,N,_,e);for(var E=0,b=0,y,S;E<T;++E)if(y=C[E]){for(E>=b&&(b=E+1);!(S=I[b])&&++b<T;);y._next=S||null}}return s=new Kt(s,i),s._enter=o,s._exit=c,s}function uu(){return new Kt(this._exit||this._groups.map(qs),this._parents)}function du(t,e,n){var i=this.enter(),r=this,a=this.exit();return i=typeof t=="function"?t(i):i.append(t+""),e!=null&&(r=e(r)),n==null?a.remove():n(a),i&&r?i.merge(r).order():r}function pu(t){for(var e=this._groups,n=t._groups,i=e.length,r=n.length,a=Math.min(i,r),s=new Array(i),o=0;o<a;++o)for(var c=e[o],f=n[o],h=c.length,m=s[o]=new Array(h),p,_=0;_<h;++_)(p=c[_]||f[_])&&(m[_]=p);for(;o<i;++o)s[o]=e[o];return new Kt(s,this._parents)}function _u(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i=t[e],r=i.length-1,a=i[r],s;--r>=0;)(s=i[r])&&(a&&s.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(s,a),a=s);return this}function gu(t){t||(t=mu);function e(m,p){return m&&p?t(m.__data__,p.__data__):!m-!p}for(var n=this._groups,i=n.length,r=new Array(i),a=0;a<i;++a){for(var s=n[a],o=s.length,c=r[a]=new Array(o),f,h=0;h<o;++h)(f=s[h])&&(c[h]=f);c.sort(e)}return new Kt(r,this._parents).order()}function mu(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function vu(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function wu(){var t=new Array(this.size()),e=-1;return this.each(function(){t[++e]=this}),t}function yu(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,a=i.length;r<a;++r){var s=i[r];if(s)return s}return null}function xu(){var t=0;return this.each(function(){++t}),t}function bu(){return!this.node()}function ku(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r=e[n],a=0,s=r.length,o;a<s;++a)(o=r[a])&&t.call(o,o.__data__,a,r);return this}function Eu(t){return function(){this.removeAttribute(t)}}function Tu(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Su(t,e){return function(){this.setAttribute(t,e)}}function Au(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Nu(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function Iu(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function $u(t,e){var n=Us(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((e==null?n.local?Tu:Eu:typeof e=="function"?n.local?Iu:Nu:n.local?Au:Su)(n,e))}function Ws(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Ru(t){return function(){this.style.removeProperty(t)}}function Du(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Mu(t,e,n){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function Ou(t,e,n){return arguments.length>1?this.each((e==null?Ru:typeof e=="function"?Mu:Du)(t,e,n??"")):Lu(this.node(),t)}function Lu(t,e){return t.style.getPropertyValue(e)||Ws(t).getComputedStyle(t,null).getPropertyValue(e)}function Hu(t){return function(){delete this[t]}}function Cu(t,e){return function(){this[t]=e}}function Fu(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function zu(t,e){return arguments.length>1?this.each((e==null?Hu:typeof e=="function"?Fu:Cu)(t,e)):this.node()[t]}function Xs(t){return t.trim().split(/^|\s+/)}function vr(t){return t.classList||new Ks(t)}function Ks(t){this._node=t,this._names=Xs(t.getAttribute("class")||"")}Ks.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Ys(t,e){for(var n=vr(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function Js(t,e){for(var n=vr(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function Bu(t){return function(){Ys(this,t)}}function Pu(t){return function(){Js(this,t)}}function Gu(t,e){return function(){(e.apply(this,arguments)?Ys:Js)(this,t)}}function Uu(t,e){var n=Xs(t+"");if(arguments.length<2){for(var i=vr(this.node()),r=-1,a=n.length;++r<a;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof e=="function"?Gu:e?Bu:Pu)(n,e))}function Vu(){this.textContent=""}function Zu(t){return function(){this.textContent=t}}function qu(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Wu(t){return arguments.length?this.each(t==null?Vu:(typeof t=="function"?qu:Zu)(t)):this.node().textContent}function Xu(){this.innerHTML=""}function Ku(t){return function(){this.innerHTML=t}}function Yu(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Ju(t){return arguments.length?this.each(t==null?Xu:(typeof t=="function"?Yu:Ku)(t)):this.node().innerHTML}function Qu(){this.nextSibling&&this.parentNode.appendChild(this)}function ju(){return this.each(Qu)}function td(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ed(){return this.each(td)}function nd(t){var e=typeof t=="function"?t:Vs(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function id(){return null}function rd(t,e){var n=typeof t=="function"?t:Vs(t),i=e==null?id:typeof e=="function"?e:Zs(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function ad(){var t=this.parentNode;t&&t.removeChild(this)}function sd(){return this.each(ad)}function od(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function ld(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function cd(t){return this.select(t?ld:od)}function fd(t){return arguments.length?this.property("__data__",t):this.node().__data__}var Qs={};if(typeof document<"u"){var hd=document.documentElement;"onmouseenter"in hd||(Qs={mouseenter:"mouseover",mouseleave:"mouseout"})}function ud(t,e,n){return t=js(t,e,n),function(i){var r=i.relatedTarget;(!r||r!==this&&!(r.compareDocumentPosition(this)&8))&&t.call(this,i)}}function js(t,e,n){return function(i){try{t.call(this,this.__data__,e,n)}finally{}}}function dd(t){return t.trim().split(/^|\s+/).map(function(e){var n="",i=e.indexOf(".");return i>=0&&(n=e.slice(i+1),e=e.slice(0,i)),{type:e,name:n}})}function pd(t){return function(){var e=this.__on;if(e){for(var n=0,i=-1,r=e.length,a;n<r;++n)a=e[n],(!t.type||a.type===t.type)&&a.name===t.name?this.removeEventListener(a.type,a.listener,a.capture):e[++i]=a;++i?e.length=i:delete this.__on}}}function _d(t,e,n){var i=Qs.hasOwnProperty(t.type)?ud:js;return function(r,a,s){var o=this.__on,c,f=i(e,a,s);if(o){for(var h=0,m=o.length;h<m;++h)if((c=o[h]).type===t.type&&c.name===t.name){this.removeEventListener(c.type,c.listener,c.capture),this.addEventListener(c.type,c.listener=f,c.capture=n),c.value=e;return}}this.addEventListener(t.type,f,n),c={type:t.type,name:t.name,value:e,listener:f,capture:n},o?o.push(c):this.__on=[c]}}function gd(t,e,n){var i=dd(t+""),r,a=i.length,s;if(arguments.length<2){var o=this.node().__on;if(o){for(var c=0,f=o.length,h;c<f;++c)for(r=0,h=o[c];r<a;++r)if((s=i[r]).type===h.type&&s.name===h.name)return h.value}return}for(o=e?_d:pd,n==null&&(n=!1),r=0;r<a;++r)this.each(o(i[r],e,n));return this}function to(t,e,n){var i=Ws(t),r=i.CustomEvent;typeof r=="function"?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function md(t,e){return function(){return to(this,t,e)}}function vd(t,e){return function(){return to(this,t,e.apply(this,arguments))}}function wd(t,e){return this.each((typeof e=="function"?vd:md)(t,e))}var eo=[null];function Kt(t,e){this._groups=t,this._parents=e}function qi(){return new Kt([[document.documentElement]],eo)}Kt.prototype=qi.prototype={constructor:Kt,select:eu,selectAll:ru,filter:su,data:hu,enter:ou,exit:uu,join:du,merge:pu,order:_u,sort:gu,call:vu,nodes:wu,node:yu,size:xu,empty:bu,each:ku,attr:$u,style:Ou,property:zu,classed:Uu,text:Wu,html:Ju,raise:ju,lower:ed,append:nd,insert:rd,remove:sd,clone:cd,datum:fd,on:gd,dispatch:wd};function ta(t){return typeof t=="string"?new Kt([[document.querySelector(t)]],[document.documentElement]):new Kt([[t]],eo)}function yd(){var t=f,e=h,n=m,i=document.body,r=D(),a=null,s=null,o=null;function c(v){a=k(v),a&&(s=a.createSVGPoint(),i.appendChild(r))}c.show=function(){var v=Array.prototype.slice.call(arguments);v[v.length-1]instanceof SVGElement&&(o=v.pop());var Z=n.apply(this,v),P=e.apply(this,v),Q=t.apply(this,v),nt=F(),it=_.length,W,st=document.documentElement.scrollTop||i.scrollTop,q=document.documentElement.scrollLeft||i.scrollLeft;for(nt.html(Z).style("opacity",1).style("pointer-events","all");it--;)nt.classed(_[it],!1);return W=p.get(Q).apply(this),nt.classed(Q,!0).style("top",W.top+P[0]+st+"px").style("left",W.left+P[1]+q+"px"),c},c.hide=function(){var v=F();return v.style("opacity",0).style("pointer-events","none"),c},c.attr=function(v,Z){if(arguments.length<2&&typeof v=="string")return F().attr(v);var P=Array.prototype.slice.call(arguments);return qi.prototype.attr.apply(F(),P),c},c.style=function(v,Z){if(arguments.length<2&&typeof v=="string")return F().style(v);var P=Array.prototype.slice.call(arguments);return qi.prototype.style.apply(F(),P),c},c.direction=function(v){return arguments.length?(t=v==null?v:L(v),c):t},c.offset=function(v){return arguments.length?(e=v==null?v:L(v),c):e},c.html=function(v){return arguments.length?(n=v==null?v:L(v),c):n},c.rootElement=function(v){return arguments.length?(i=v==null?v:L(v),c):i},c.destroy=function(){return r&&(F().remove(),r=null),c};function f(){return"n"}function h(){return[0,0]}function m(){return" "}var p=mr({n:T,s:C,e:I,w:N,nw:E,ne:b,sw:y,se:S}),_=p.keys();function T(){var v=z(this);return{top:v.n.y-r.offsetHeight,left:v.n.x-r.offsetWidth/2}}function C(){var v=z(this);return{top:v.s.y,left:v.s.x-r.offsetWidth/2}}function I(){var v=z(this);return{top:v.e.y-r.offsetHeight/2,left:v.e.x}}function N(){var v=z(this);return{top:v.w.y-r.offsetHeight/2,left:v.w.x-r.offsetWidth}}function E(){var v=z(this);return{top:v.nw.y-r.offsetHeight,left:v.nw.x-r.offsetWidth}}function b(){var v=z(this);return{top:v.ne.y-r.offsetHeight,left:v.ne.x}}function y(){var v=z(this);return{top:v.sw.y,left:v.sw.x-r.offsetWidth}}function S(){var v=z(this);return{top:v.se.y,left:v.se.x}}function D(){var v=ta(document.createElement("div"));return v.style("position","absolute").style("top",0).style("opacity",0).style("pointer-events","none").style("box-sizing","border-box"),v.node()}function k(v){var Z=v.node();return Z?Z.tagName.toLowerCase()==="svg"?Z:Z.ownerSVGElement:null}function F(){return r==null&&(r=D(),i.appendChild(r)),ta(r)}function z(v){for(var Z=o||v;Z.getScreenCTM==null&&Z.parentNode!=null;)Z=Z.parentNode;var P={},Q=Z.getScreenCTM(),nt=Z.getBBox(),it=nt.width,W=nt.height,st=nt.x,q=nt.y;return s.x=st,s.y=q,P.nw=s.matrixTransform(Q),s.x+=it,P.ne=s.matrixTransform(Q),s.y+=W,P.se=s.matrixTransform(Q),s.x-=it,P.sw=s.matrixTransform(Q),s.y-=W/2,P.w=s.matrixTransform(Q),s.x+=it,P.e=s.matrixTransform(Q),s.x-=it/2,s.y-=W/2,P.n=s.matrixTransform(Q),s.y+=W,P.s=s.matrixTransform(Q),P}function L(v){return typeof v=="function"?v:function(){return v}}return c}const Wn=class Wn{constructor({region:e,viewer:n,height:i,width:r,range:a}){this.variants=[],this.viewer=n,this.width=r,this.height=i,this.region=e,this.range=a}DrawTrack(){const e=this.viewer,n=this.variants,i=me().domain([this.region.start,this.region.end+1]).range(this.range),r=Os().type(Ms).size(20),a=yd();a.attr("class","d3-tip").html(f=>`<table><th colspan="2">${"Case Variant".toUpperCase()}</th><tr><td>Position</td> <td>${f.position}</td></tr><tr><td>Mutation</td> <td>${f.ref} > ${f.mutant}</td></tr></table>`).offset([10,0]).direction("s"),e.call(a);const s=Wn.TRACK_HEIGHT,o=Ue(this.viewer),c=e.append("g").attr("transform",`translate(0,${o})`).attr("class","track");c.append("rect").attr("height",s).attr("width",-this.range[0]+this.range[1]).attr("fill-opacity",.1).attr("fill","rgb(148, 140, 140)").attr("stroke-width",0).attr("stroke-opacity",0).attr("transform",`translate(${this.range[0]},0)`),c.selectAll("path").data(n).enter().append("path").attr("d",r).attr("class","case-variant").attr("stroke","red").attr("fill","red").attr("transform",f=>`translate(${i(f.position)},10)`).on("mouseenter",a.show).on("mouseout",a.hide)}async getTrackData(){}};Wn.TRACK_HEIGHT=20;let Wi=Wn;const Xn=class Xn{constructor({viewer:e,track:n,height:i,width:r,region:a}){this.variants=[],this.region=a,this.viewer=e,this.width=r,this.height=i,this.track=n}DrawTrack(){const e=this.viewer,n=this.variants,i=me().domain([this.region.start,this.region.end]).range(this.track.range),r=Os().type(Ms).size(20),a=Xn.TRACK_HEIGHT,s=Ue(this.viewer),o=e.append("g").attr("transform",`translate(0,${s})`).attr("class","track");o.append("rect").attr("height",a).attr("width",-this.track.range[0]+this.track.range[1]).attr("fill-opacity",.1).attr("fill","rgb(148, 140, 140)").attr("stroke-width",0).attr("stroke-opacity",0),o.selectAll("path").data(n).enter().append("path").attr("d",r).attr("class","global-variant").attr("stroke","red").attr("fill","red").attr("transform",c=>`translate(${i(c.position)},10)`)}async getTrackData(){}};Xn.TRACK_HEIGHT=20;let Xi=Xn;function wr(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ri,ea;function xd(){if(ea)return ri;ea=1;class t{constructor(n={}){if(!(n.maxSize&&n.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");this.maxSize=n.maxSize,this.cache=new Map,this.oldCache=new Map,this._size=0}_set(n,i){this.cache.set(n,i),this._size++,this._size>=this.maxSize&&(this._size=0,this.oldCache=this.cache,this.cache=new Map)}get(n){if(this.cache.has(n))return this.cache.get(n);if(this.oldCache.has(n)){const i=this.oldCache.get(n);return this.oldCache.delete(n),this._set(n,i),i}}set(n,i){return this.cache.has(n)?this.cache.set(n,i):this._set(n,i),this}has(n){return this.cache.has(n)||this.oldCache.has(n)}peek(n){if(this.cache.has(n))return this.cache.get(n);if(this.oldCache.has(n))return this.oldCache.get(n)}delete(n){const i=this.cache.delete(n);return i&&this._size--,this.oldCache.delete(n)||i}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}*keys(){for(const[n]of this)yield n}*values(){for(const[,n]of this)yield n}*[Symbol.iterator](){for(const n of this.cache)yield n;for(const n of this.oldCache){const[i]=n;this.cache.has(i)||(yield n)}}get size(){let n=0;for(const i of this.oldCache.keys())this.cache.has(i)||n++;return this._size+n}}return ri=t,ri}var bd=xd();const an=wr(bd);class kd{}class Ed{constructor(){this.signals=new Set,this.abortController=new AbortController}addSignal(e=new kd){if(this.signal.aborted)throw new Error("cannot add a signal, already aborted!");this.signals.add(e),e.aborted?this.handleAborted(e):typeof e.addEventListener=="function"&&e.addEventListener("abort",()=>{this.handleAborted(e)})}handleAborted(e){this.signals.delete(e),this.signals.size===0&&this.abortController.abort()}get signal(){return this.abortController.signal}abort(){this.abortController.abort()}}class Td{constructor(){this.callbacks=new Set}addCallback(e=()=>{}){this.callbacks.add(e),this.currentMessage&&e(this.currentMessage)}callback(e){this.currentMessage=e;for(const n of this.callbacks)n(e)}}class Ie{constructor({fill:e,cache:n}){if(typeof e!="function")throw new TypeError("must pass a fill function");if(typeof n!="object")throw new TypeError("must pass a cache object");if(typeof n.get!="function"||typeof n.set!="function"||typeof n.delete!="function")throw new TypeError("cache must implement get(key), set(key, val), and and delete(key)");this.cache=n,this.fillCallback=e}static isAbortException(e){return e.name==="AbortError"||e.code==="ERR_ABORTED"||e.message==="AbortError: aborted"||e.message==="Error: aborted"}evict(e,n){this.cache.get(e)===n&&this.cache.delete(e)}fill(e,n,i,r){const a=new Ed,s=new Td;s.addCallback(r);const o={aborter:a,promise:this.fillCallback(n,a.signal,c=>{s.callback(c)}),settled:!1,statusReporter:s,get aborted(){return this.aborter.signal.aborted}};o.aborter.addSignal(i),o.aborter.signal.addEventListener("abort",()=>{o.settled||this.evict(e,o)}),o.promise.then(()=>{o.settled=!0},()=>{o.settled=!0,this.evict(e,o)}).catch(c=>{throw console.error(c),c}),this.cache.set(e,o)}static checkSinglePromise(e,n){function i(){if(n?.aborted)throw Object.assign(new Error("aborted"),{code:"ERR_ABORTED"})}return e.then(r=>(i(),r),r=>{throw i(),r})}has(e){return this.cache.has(e)}get(e,n,i,r){if(!i&&n instanceof AbortSignal)throw new TypeError("second get argument appears to be an AbortSignal, perhaps you meant to pass `null` for the fill data?");const a=this.cache.get(e);return a?a.aborted&&!a.settled?(this.evict(e,a),this.get(e,n,i,r)):a.settled?a.promise:(a.aborter.addSignal(i),a.statusReporter.addCallback(r),Ie.checkSinglePromise(a.promise,i)):(this.fill(e,n,i,r),Ie.checkSinglePromise(this.cache.get(e).promise,i))}delete(e){const n=this.cache.get(e);n&&(n.settled||n.aborter.abort(),this.cache.delete(e))}clear(){const e=this.cache.keys();let n=0;for(let i=e.next();!i.done;i=e.next())this.delete(i.value),n+=1;return n}}var $n={exports:{}},Sd=$n.exports,na;function Ad(){return na||(na=1,(function(t,e){(function(n,i){t.exports=i()})(Sd,(function(){const n=/^[\w+.-]+:\/\//,i=/^([\w+.-]+:)\/\/([^@/#?]*@)?([^:/#?]*)(:\d+)?(\/[^#?]*)?(\?[^#]*)?(#.*)?/,r=/^file:(?:\/\/((?![a-z]:)[^/#?]*)?)?(\/?[^#?]*)(\?[^#]*)?(#.*)?/i;function a(E){return n.test(E)}function s(E){return E.startsWith("//")}function o(E){return E.startsWith("/")}function c(E){return E.startsWith("file:")}function f(E){return/^[.?#]/.test(E)}function h(E){const b=i.exec(E);return p(b[1],b[2]||"",b[3],b[4]||"",b[5]||"/",b[6]||"",b[7]||"")}function m(E){const b=r.exec(E),y=b[2];return p("file:","",b[1]||"","",o(y)?y:"/"+y,b[3]||"",b[4]||"")}function p(E,b,y,S,D,k,F){return{scheme:E,user:b,host:y,port:S,path:D,query:k,hash:F,type:7}}function _(E){if(s(E)){const y=h("http:"+E);return y.scheme="",y.type=6,y}if(o(E)){const y=h("http://foo.com"+E);return y.scheme="",y.host="",y.type=5,y}if(c(E))return m(E);if(a(E))return h(E);const b=h("http://foo.com/"+E);return b.scheme="",b.host="",b.type=E?E.startsWith("?")?3:E.startsWith("#")?2:4:1,b}function T(E){if(E.endsWith("/.."))return E;const b=E.lastIndexOf("/");return E.slice(0,b+1)}function C(E,b){I(b,b.type),E.path==="/"?E.path=b.path:E.path=T(b.path)+E.path}function I(E,b){const y=b<=4,S=E.path.split("/");let D=1,k=0,F=!1;for(let L=1;L<S.length;L++){const v=S[L];if(!v){F=!0;continue}if(F=!1,v!=="."){if(v===".."){k?(F=!0,k--,D--):y&&(S[D++]=v);continue}S[D++]=v,k++}}let z="";for(let L=1;L<D;L++)z+="/"+S[L];(!z||F&&!z.endsWith("/.."))&&(z+="/"),E.path=z}function N(E,b){if(!E&&!b)return"";const y=_(E);let S=y.type;if(b&&S!==7){const k=_(b),F=k.type;switch(S){case 1:y.hash=k.hash;case 2:y.query=k.query;case 3:case 4:C(y,k);case 5:y.user=k.user,y.host=k.host,y.port=k.port;case 6:y.scheme=k.scheme}F>S&&(S=F)}I(y,S);const D=y.query+y.hash;switch(S){case 2:case 3:return D;case 4:{const k=y.path.slice(1);return k?f(b||E)&&!f(k)?"./"+k+D:k+D:D||"."}case 5:return y.path+D;default:return y.scheme+"//"+y.user+y.host+y.port+y.path+D}}return N}))})($n)),$n.exports}var Nd=Ad();const Id=wr(Nd);async function yr(t,e,n={}){const{defaultContent:i={}}=n;try{const r=await e(t,{encoding:"utf8"}),a=new TextDecoder("utf8");return JSON.parse(a.decode(r))}catch(r){if(r.code==="ENOENT"||r.status===404||r.message.includes("404")||r.message.includes("ENOENT"))return i;throw r}}function xr(t,e="."){return Id(t,e)}class $d{constructor({readFile:e,cacheSize:n=100}){if(this.topList=[],this.chunkCache=new Ie({cache:new an({maxSize:n}),fill:this.readChunkItems.bind(this)}),this.readFile=e,!this.readFile)throw new Error('must provide a "readFile" function')}importExisting(e,n,i,r,a){this.topList=e,this.attrs=n,this.start=n.makeFastGetter("Start"),this.end=n.makeFastGetter("End"),this.lazyClass=a,this.baseURL=i,this.lazyUrlTemplate=r}binarySearch(e,n,i){let r=-1,a=e.length,s;for(;a-r>1;)s=r+a>>>1,i(e[s])>=n?a=s:r=s;return i===this.end?a:r}readChunkItems(e){const n=xr(this.lazyUrlTemplate.replaceAll(/\{Chunk\}/gi,e),this.baseURL);return yr(n,this.readFile,{defaultContent:[]})}async*iterateSublist(e,n,i,r,a,s,o){const c=this.attrs.makeGetter("Chunk"),f=this.attrs.makeGetter("Sublist"),h=[];for(let m=this.binarySearch(e,n,a);m<e.length&&m>=0&&r*s(e[m])<r*i;m+=r){if(e[m][0]===this.lazyClass){const _=c(e[m]),T=this.chunkCache.get(_,_).then(C=>[C,_]);h.push(T)}else yield[e[m],o.concat(m)];const p=f(e[m]);p&&(yield*this.iterateSublist(p,n,i,r,a,s,o.concat(m)))}for(const m of h){const[p,_]=await m;p&&(yield*this.iterateSublist(p,n,i,r,a,s,[...o,_]))}}async*iterate(e,n){const i=e>n?-1:1,r=e>n?this.start:this.end,a=e>n?this.end:this.start;this.topList.length>0&&(yield*this.iterateSublist(this.topList,e,n,i,r,a,[0]))}async histogram(e,n,i){const r=new Array(i);r.fill(0);const a=(n-e)/i;for await(const s of this.iterate(e,n)){const o=Math.max(0,(this.start(s)-e)/a|0),c=Math.min(i,(this.end(s)-e)/a|0);for(let f=o;f<=c;f+=1)r[f]+=1}return r}}class Rd{constructor(e){this.classes=e,this.fields=[];for(let n=0;n<e.length;n+=1){this.fields[n]={};for(let i=0;i<e[n].attributes.length;i+=1)this.fields[n][e[n].attributes[i]]=i+1;e[n].proto===void 0&&(e[n].proto={}),e[n].isArrayAttr===void 0&&(e[n].isArrayAttr={})}}attrIndices(e){return this.classes.map(n=>n.attributes.indexOf(e)+1||n.attributes.indexOf(e.toLowerCase())+1||void 0)}get(e,n){if(n in this.fields[e[0]])return e[this.fields[e[0]][n]];const i=n.toLowerCase();if(i in this.fields[e[0]])return e[this.fields[e[0]][i]];const r=this.classes[e[0]].attributes.length+1;return r>=e.length||!(n in e[r])?n in this.classes[e[0]].proto?this.classes[e[0]].proto[n]:void 0:e[r][n]}makeSetter(e){return(n,i)=>{this.set(n,e,i)}}makeGetter(e){return n=>this.get(n,e)}makeFastGetter(e){const n=this.attrIndices(e);return function(r){if(n[r[0]]!==void 0)return r[n[r[0]]]}}accessors(){return this._accessors||(this._accessors=this._makeAccessors()),this._accessors}_makeAccessors(){const e={},n={get(r){const a=this.get.field_accessors[r.toLowerCase()];if(a)return a.call(this)},set(r,a){const s=this.set.field_accessors[r];if(s)return s.call(this,a)},tags(){return i[this[0]]||[]}};n.get.field_accessors={},n.set.field_accessors={},this.classes.forEach((r,a)=>{(r.attributes||[]).forEach((s,o)=>{e[s]=e[s]||[],e[s][a]=o+1,s=s.toLowerCase(),e[s]=e[s]||[],e[s][a]=o+1})});const i=this.classes.map(r=>r.attributes);return Object.keys(e).forEach(r=>{const a=e[r];n.get.field_accessors[r]=a?function(){return this[a[this[0]]]}:function(){}}),n}}class Dd{constructor({urlTemplate:e,chunkSize:n,length:i,cacheSize:r=100,readFile:a},s){if(this.urlTemplate=e,this.chunkSize=n,this.length=i,this.baseUrl=s===void 0?"":s,this.readFile=a,!a)throw new Error("must provide readFile callback");this.chunkCache=new Ie({cache:new an({maxSize:r}),fill:this.getChunk.bind(this)})}index(e,n,i){this.range(e,e,n,void 0,i)}async*range(e,n){e=Math.max(0,e),n=Math.min(n,this.length-1);const i=Math.floor(e/this.chunkSize),r=Math.floor(n/this.chunkSize),a=[];for(let s=i;s<=r;s+=1)a.push(this.chunkCache.get(s,s));for(const s of a){const[o,c]=await s;yield*this.filterChunkData(e,n,o,c)}}async getChunk(e){let n=this.urlTemplate.replaceAll(/\{Chunk\}/gi,e);this.baseUrl&&(n=xr(n,this.baseUrl));const i=await yr(n,this.readFile);return[e,i]}*filterChunkData(e,n,i,r){const a=i*this.chunkSize,s=Math.max(0,e-a),o=Math.min(n-a,this.chunkSize-1);for(let c=s;c<=o;c+=1)yield[c+a,r[c]]}}function Md(){return this._uniqueID}function Od(){return this._parent}function Ld(){return this.get("subfeatures")}class Hd{constructor({baseUrl:e,urlTemplate:n,readFile:i,cacheSize:r=10}){if(this.baseUrl=e,this.urlTemplates={root:n},this.readFile=i,!this.readFile)throw new Error('must provide a "readFile" function argument');this.dataRootCache=new Ie({cache:new an({maxSize:r}),fill:this.fetchDataRoot.bind(this)})}makeNCList(){return new $d({readFile:this.readFile})}loadNCList(e,n,i){e.nclist.importExisting(n.intervals.nclist,e.attrs,i,n.intervals.urlTemplate,n.intervals.lazyClass)}getDataRoot(e){return this.dataRootCache.get(e,e)}fetchDataRoot(e){const n=xr(this.urlTemplates.root.replaceAll(/{\s*refseq\s*}/g,e),this.baseUrl);return yr(n,this.readFile).then(i=>this.parseTrackInfo(i,n))}parseTrackInfo(e,n){const i={nclist:this.makeNCList(),stats:{featureCount:e.featureCount||0}};e.intervals&&(i.attrs=new Rd(e.intervals.classes),this.loadNCList(i,e,n));const{histograms:r}=e;if(r?.meta){for(let a=0;a<r.meta.length;a+=1)r.meta[a].lazyArray=new Dd({...r.meta[a].arrayParams,readFile:this.readFile},n);i._histograms=r}return i._histograms&&Object.keys(i._histograms).forEach(a=>{i._histograms[a].forEach(o=>{Object.keys(o).forEach(c=>{typeof o[c]=="string"&&String(Number(o[c]))===o[c]&&(o[c]=Number(o[c]))})})}),i}async getRegionStats(e){return(await this.getDataRoot(e.ref)).stats}async getRegionFeatureDensities({refName:e,start:n,end:i,numBins:r,basesPerBin:a}){const s=await this.getDataRoot(e);if(r)a=(i-n)/r;else if(a)r=Math.ceil((i-n)/a);else throw new TypeError("numBins or basesPerBin arg required for getRegionFeatureDensities");const c=(s._histograms.stats||[]).find(p=>p.basesPerBin>=a);let f=s._histograms.meta[0];for(let p=0;p<s._histograms.meta.length;p+=1)a>=s._histograms.meta[p].basesPerBin&&(f=s._histograms.meta[p]);let h=a/f.basesPerBin;if(h>.9&&Math.abs(h-Math.round(h))<1e-4){const p=Math.floor(n/f.basesPerBin);h=Math.round(h);const _=[];for(let T=0;T<r;T+=1)_[T]=0;for await(const[T,C]of f.lazyArray.range(p,p+h*r-1))_[Math.floor((T-p)/h)]+=C;return{bins:_,stats:c}}return{bins:await s.nclist.histogram(n,i,r),stats:c}}async*getFeatures({refName:e,start:n,end:i}){const r=await this.getDataRoot(e),a=r.attrs?.accessors();for await(const[s,o]of r.nclist.iterate(n,i)){if(!s.decorated){const c=o.join(",");this.decorateFeature(a,s,`${e},${c}`)}yield s}}decorateFeature(e,n,i,r){n.get=e.get,n.tags=e.tags,n._uniqueID=i,n.id=Md,n._parent=r,n.parent=Od,n.children=Ld,(n.get("subfeatures")||[]).forEach((a,s)=>{this.decorateFeature(e,a,`${i}-${s}`,n)}),n.decorated=!0}}function Ve(t){let e=t.length;for(;--e>=0;)t[e]=0}const Cd=3,Fd=258,no=29,zd=256,Bd=zd+1+no,io=30,Pd=512,Gd=new Array((Bd+2)*2);Ve(Gd);const Ud=new Array(io*2);Ve(Ud);const Vd=new Array(Pd);Ve(Vd);const Zd=new Array(Fd-Cd+1);Ve(Zd);const qd=new Array(no);Ve(qd);const Wd=new Array(io);Ve(Wd);const Xd=(t,e,n,i)=>{let r=t&65535|0,a=t>>>16&65535|0,s=0;for(;n!==0;){s=n>2e3?2e3:n,n-=s;do r=r+e[i++]|0,a=a+r|0;while(--s);r%=65521,a%=65521}return r|a<<16|0};var Ki=Xd;const Kd=()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var i=0;i<8;i++)t=t&1?3988292384^t>>>1:t>>>1;e[n]=t}return e},Yd=new Uint32Array(Kd()),Jd=(t,e,n,i)=>{const r=Yd,a=i+n;t^=-1;for(let s=i;s<a;s++)t=t>>>8^r[(t^e[s])&255];return t^-1};var se=Jd,Yi={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},ro={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const Qd=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var jd=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const i in n)Qd(n,i)&&(t[i]=n[i])}}return t},t0=t=>{let e=0;for(let i=0,r=t.length;i<r;i++)e+=t[i].length;const n=new Uint8Array(e);for(let i=0,r=0,a=t.length;i<a;i++){let s=t[i];n.set(s,r),r+=s.length}return n},ao={assign:jd,flattenChunks:t0};let so=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{so=!1}const sn=new Uint8Array(256);for(let t=0;t<256;t++)sn[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;sn[254]=sn[254]=1;var e0=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,n,i,r,a,s=t.length,o=0;for(r=0;r<s;r++)n=t.charCodeAt(r),(n&64512)===55296&&r+1<s&&(i=t.charCodeAt(r+1),(i&64512)===56320&&(n=65536+(n-55296<<10)+(i-56320),r++)),o+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(o),a=0,r=0;a<o;r++)n=t.charCodeAt(r),(n&64512)===55296&&r+1<s&&(i=t.charCodeAt(r+1),(i&64512)===56320&&(n=65536+(n-55296<<10)+(i-56320),r++)),n<128?e[a++]=n:n<2048?(e[a++]=192|n>>>6,e[a++]=128|n&63):n<65536?(e[a++]=224|n>>>12,e[a++]=128|n>>>6&63,e[a++]=128|n&63):(e[a++]=240|n>>>18,e[a++]=128|n>>>12&63,e[a++]=128|n>>>6&63,e[a++]=128|n&63);return e};const n0=(t,e)=>{if(e<65534&&t.subarray&&so)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let n="";for(let i=0;i<e;i++)n+=String.fromCharCode(t[i]);return n};var i0=(t,e)=>{const n=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let i,r;const a=new Array(n*2);for(r=0,i=0;i<n;){let s=t[i++];if(s<128){a[r++]=s;continue}let o=sn[s];if(o>4){a[r++]=65533,i+=o-1;continue}for(s&=o===2?31:o===3?15:7;o>1&&i<n;)s=s<<6|t[i++]&63,o--;if(o>1){a[r++]=65533;continue}s<65536?a[r++]=s:(s-=65536,a[r++]=55296|s>>10&1023,a[r++]=56320|s&1023)}return n0(a,r)},r0=(t,e)=>{e=e||t.length,e>t.length&&(e=t.length);let n=e-1;for(;n>=0&&(t[n]&192)===128;)n--;return n<0||n===0?e:n+sn[t[n]]>e?n:e},Ji={string2buf:e0,buf2string:i0,utf8border:r0};function a0(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var s0=a0;const vn=16209,o0=16191;var l0=function(e,n){let i,r,a,s,o,c,f,h,m,p,_,T,C,I,N,E,b,y,S,D,k,F,z,L;const v=e.state;i=e.next_in,z=e.input,r=i+(e.avail_in-5),a=e.next_out,L=e.output,s=a-(n-e.avail_out),o=a+(e.avail_out-257),c=v.dmax,f=v.wsize,h=v.whave,m=v.wnext,p=v.window,_=v.hold,T=v.bits,C=v.lencode,I=v.distcode,N=(1<<v.lenbits)-1,E=(1<<v.distbits)-1;t:do{T<15&&(_+=z[i++]<<T,T+=8,_+=z[i++]<<T,T+=8),b=C[_&N];e:for(;;){if(y=b>>>24,_>>>=y,T-=y,y=b>>>16&255,y===0)L[a++]=b&65535;else if(y&16){S=b&65535,y&=15,y&&(T<y&&(_+=z[i++]<<T,T+=8),S+=_&(1<<y)-1,_>>>=y,T-=y),T<15&&(_+=z[i++]<<T,T+=8,_+=z[i++]<<T,T+=8),b=I[_&E];n:for(;;){if(y=b>>>24,_>>>=y,T-=y,y=b>>>16&255,y&16){if(D=b&65535,y&=15,T<y&&(_+=z[i++]<<T,T+=8,T<y&&(_+=z[i++]<<T,T+=8)),D+=_&(1<<y)-1,D>c){e.msg="invalid distance too far back",v.mode=vn;break t}if(_>>>=y,T-=y,y=a-s,D>y){if(y=D-y,y>h&&v.sane){e.msg="invalid distance too far back",v.mode=vn;break t}if(k=0,F=p,m===0){if(k+=f-y,y<S){S-=y;do L[a++]=p[k++];while(--y);k=a-D,F=L}}else if(m<y){if(k+=f+m-y,y-=m,y<S){S-=y;do L[a++]=p[k++];while(--y);if(k=0,m<S){y=m,S-=y;do L[a++]=p[k++];while(--y);k=a-D,F=L}}}else if(k+=m-y,y<S){S-=y;do L[a++]=p[k++];while(--y);k=a-D,F=L}for(;S>2;)L[a++]=F[k++],L[a++]=F[k++],L[a++]=F[k++],S-=3;S&&(L[a++]=F[k++],S>1&&(L[a++]=F[k++]))}else{k=a-D;do L[a++]=L[k++],L[a++]=L[k++],L[a++]=L[k++],S-=3;while(S>2);S&&(L[a++]=L[k++],S>1&&(L[a++]=L[k++]))}}else if((y&64)===0){b=I[(b&65535)+(_&(1<<y)-1)];continue n}else{e.msg="invalid distance code",v.mode=vn;break t}break}}else if((y&64)===0){b=C[(b&65535)+(_&(1<<y)-1)];continue e}else if(y&32){v.mode=o0;break t}else{e.msg="invalid literal/length code",v.mode=vn;break t}break}}while(i<r&&a<o);S=T>>3,i-=S,T-=S<<3,_&=(1<<T)-1,e.next_in=i,e.next_out=a,e.avail_in=i<r?5+(r-i):5-(i-r),e.avail_out=a<o?257+(o-a):257-(a-o),v.hold=_,v.bits=T};const Me=15,ia=852,ra=592,aa=0,ai=1,sa=2,c0=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),f0=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),h0=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),u0=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),d0=(t,e,n,i,r,a,s,o)=>{const c=o.bits;let f=0,h=0,m=0,p=0,_=0,T=0,C=0,I=0,N=0,E=0,b,y,S,D,k,F=null,z;const L=new Uint16Array(Me+1),v=new Uint16Array(Me+1);let Z=null,P,Q,nt;for(f=0;f<=Me;f++)L[f]=0;for(h=0;h<i;h++)L[e[n+h]]++;for(_=c,p=Me;p>=1&&L[p]===0;p--);if(_>p&&(_=p),p===0)return r[a++]=1<<24|64<<16|0,r[a++]=1<<24|64<<16|0,o.bits=1,0;for(m=1;m<p&&L[m]===0;m++);for(_<m&&(_=m),I=1,f=1;f<=Me;f++)if(I<<=1,I-=L[f],I<0)return-1;if(I>0&&(t===aa||p!==1))return-1;for(v[1]=0,f=1;f<Me;f++)v[f+1]=v[f]+L[f];for(h=0;h<i;h++)e[n+h]!==0&&(s[v[e[n+h]]++]=h);if(t===aa?(F=Z=s,z=20):t===ai?(F=c0,Z=f0,z=257):(F=h0,Z=u0,z=0),E=0,h=0,f=m,k=a,T=_,C=0,S=-1,N=1<<_,D=N-1,t===ai&&N>ia||t===sa&&N>ra)return 1;for(;;){P=f-C,s[h]+1<z?(Q=0,nt=s[h]):s[h]>=z?(Q=Z[s[h]-z],nt=F[s[h]-z]):(Q=96,nt=0),b=1<<f-C,y=1<<T,m=y;do y-=b,r[k+(E>>C)+y]=P<<24|Q<<16|nt|0;while(y!==0);for(b=1<<f-1;E&b;)b>>=1;if(b!==0?(E&=b-1,E+=b):E=0,h++,--L[f]===0){if(f===p)break;f=e[n+s[h]]}if(f>_&&(E&D)!==S){for(C===0&&(C=_),k+=m,T=f-C,I=1<<T;T+C<p&&(I-=L[T+C],!(I<=0));)T++,I<<=1;if(N+=1<<T,t===ai&&N>ia||t===sa&&N>ra)return 1;S=E&D,r[S]=_<<24|T<<16|k-a|0}}return E!==0&&(r[k+E]=f-C<<24|64<<16|0),o.bits=_,0};var je=d0;const p0=0,oo=1,lo=2,{Z_FINISH:oa,Z_BLOCK:_0,Z_TREES:wn,Z_OK:$e,Z_STREAM_END:g0,Z_NEED_DICT:m0,Z_STREAM_ERROR:jt,Z_DATA_ERROR:co,Z_MEM_ERROR:fo,Z_BUF_ERROR:v0,Z_DEFLATED:la}=ro,Qn=16180,ca=16181,fa=16182,ha=16183,ua=16184,da=16185,pa=16186,_a=16187,ga=16188,ma=16189,Vn=16190,ue=16191,si=16192,va=16193,oi=16194,wa=16195,ya=16196,xa=16197,ba=16198,yn=16199,xn=16200,ka=16201,Ea=16202,Ta=16203,Sa=16204,Aa=16205,li=16206,Na=16207,Ia=16208,Rt=16209,ho=16210,uo=16211,w0=852,y0=592,x0=15,b0=x0,$a=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function k0(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const De=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<Qn||e.mode>uo?1:0},po=t=>{if(De(t))return jt;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=e.wrap&1),e.mode=Qn,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(w0),e.distcode=e.distdyn=new Int32Array(y0),e.sane=1,e.back=-1,$e},_o=t=>{if(De(t))return jt;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,po(t)},go=(t,e)=>{let n;if(De(t))return jt;const i=t.state;return e<0?(n=0,e=-e):(n=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?jt:(i.window!==null&&i.wbits!==e&&(i.window=null),i.wrap=n,i.wbits=e,_o(t))},mo=(t,e)=>{if(!t)return jt;const n=new k0;t.state=n,n.strm=t,n.window=null,n.mode=Qn;const i=go(t,e);return i!==$e&&(t.state=null),i},E0=t=>mo(t,b0);let Ra=!0,ci,fi;const T0=t=>{if(Ra){ci=new Int32Array(512),fi=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(je(oo,t.lens,0,288,ci,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;je(lo,t.lens,0,32,fi,0,t.work,{bits:5}),Ra=!1}t.lencode=ci,t.lenbits=9,t.distcode=fi,t.distbits=5},vo=(t,e,n,i)=>{let r;const a=t.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),i>=a.wsize?(a.window.set(e.subarray(n-a.wsize,n),0),a.wnext=0,a.whave=a.wsize):(r=a.wsize-a.wnext,r>i&&(r=i),a.window.set(e.subarray(n-i,n-i+r),a.wnext),i-=r,i?(a.window.set(e.subarray(n-i,n),0),a.wnext=i,a.whave=a.wsize):(a.wnext+=r,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=r))),0},S0=(t,e)=>{let n,i,r,a,s,o,c,f,h,m,p,_,T,C,I=0,N,E,b,y,S,D,k,F;const z=new Uint8Array(4);let L,v;const Z=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(De(t)||!t.output||!t.input&&t.avail_in!==0)return jt;n=t.state,n.mode===ue&&(n.mode=si),s=t.next_out,r=t.output,c=t.avail_out,a=t.next_in,i=t.input,o=t.avail_in,f=n.hold,h=n.bits,m=o,p=c,F=$e;t:for(;;)switch(n.mode){case Qn:if(n.wrap===0){n.mode=si;break}for(;h<16;){if(o===0)break t;o--,f+=i[a++]<<h,h+=8}if(n.wrap&2&&f===35615){n.wbits===0&&(n.wbits=15),n.check=0,z[0]=f&255,z[1]=f>>>8&255,n.check=se(n.check,z,2,0),f=0,h=0,n.mode=ca;break}if(n.head&&(n.head.done=!1),!(n.wrap&1)||(((f&255)<<8)+(f>>8))%31){t.msg="incorrect header check",n.mode=Rt;break}if((f&15)!==la){t.msg="unknown compression method",n.mode=Rt;break}if(f>>>=4,h-=4,k=(f&15)+8,n.wbits===0&&(n.wbits=k),k>15||k>n.wbits){t.msg="invalid window size",n.mode=Rt;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=f&512?ma:ue,f=0,h=0;break;case ca:for(;h<16;){if(o===0)break t;o--,f+=i[a++]<<h,h+=8}if(n.flags=f,(n.flags&255)!==la){t.msg="unknown compression method",n.mode=Rt;break}if(n.flags&57344){t.msg="unknown header flags set",n.mode=Rt;break}n.head&&(n.head.text=f>>8&1),n.flags&512&&n.wrap&4&&(z[0]=f&255,z[1]=f>>>8&255,n.check=se(n.check,z,2,0)),f=0,h=0,n.mode=fa;case fa:for(;h<32;){if(o===0)break t;o--,f+=i[a++]<<h,h+=8}n.head&&(n.head.time=f),n.flags&512&&n.wrap&4&&(z[0]=f&255,z[1]=f>>>8&255,z[2]=f>>>16&255,z[3]=f>>>24&255,n.check=se(n.check,z,4,0)),f=0,h=0,n.mode=ha;case ha:for(;h<16;){if(o===0)break t;o--,f+=i[a++]<<h,h+=8}n.head&&(n.head.xflags=f&255,n.head.os=f>>8),n.flags&512&&n.wrap&4&&(z[0]=f&255,z[1]=f>>>8&255,n.check=se(n.check,z,2,0)),f=0,h=0,n.mode=ua;case ua:if(n.flags&1024){for(;h<16;){if(o===0)break t;o--,f+=i[a++]<<h,h+=8}n.length=f,n.head&&(n.head.extra_len=f),n.flags&512&&n.wrap&4&&(z[0]=f&255,z[1]=f>>>8&255,n.check=se(n.check,z,2,0)),f=0,h=0}else n.head&&(n.head.extra=null);n.mode=da;case da:if(n.flags&1024&&(_=n.length,_>o&&(_=o),_&&(n.head&&(k=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(a,a+_),k)),n.flags&512&&n.wrap&4&&(n.check=se(n.check,i,_,a)),o-=_,a+=_,n.length-=_),n.length))break t;n.length=0,n.mode=pa;case pa:if(n.flags&2048){if(o===0)break t;_=0;do k=i[a+_++],n.head&&k&&n.length<65536&&(n.head.name+=String.fromCharCode(k));while(k&&_<o);if(n.flags&512&&n.wrap&4&&(n.check=se(n.check,i,_,a)),o-=_,a+=_,k)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=_a;case _a:if(n.flags&4096){if(o===0)break t;_=0;do k=i[a+_++],n.head&&k&&n.length<65536&&(n.head.comment+=String.fromCharCode(k));while(k&&_<o);if(n.flags&512&&n.wrap&4&&(n.check=se(n.check,i,_,a)),o-=_,a+=_,k)break t}else n.head&&(n.head.comment=null);n.mode=ga;case ga:if(n.flags&512){for(;h<16;){if(o===0)break t;o--,f+=i[a++]<<h,h+=8}if(n.wrap&4&&f!==(n.check&65535)){t.msg="header crc mismatch",n.mode=Rt;break}f=0,h=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=ue;break;case ma:for(;h<32;){if(o===0)break t;o--,f+=i[a++]<<h,h+=8}t.adler=n.check=$a(f),f=0,h=0,n.mode=Vn;case Vn:if(n.havedict===0)return t.next_out=s,t.avail_out=c,t.next_in=a,t.avail_in=o,n.hold=f,n.bits=h,m0;t.adler=n.check=1,n.mode=ue;case ue:if(e===_0||e===wn)break t;case si:if(n.last){f>>>=h&7,h-=h&7,n.mode=li;break}for(;h<3;){if(o===0)break t;o--,f+=i[a++]<<h,h+=8}switch(n.last=f&1,f>>>=1,h-=1,f&3){case 0:n.mode=va;break;case 1:if(T0(n),n.mode=yn,e===wn){f>>>=2,h-=2;break t}break;case 2:n.mode=ya;break;case 3:t.msg="invalid block type",n.mode=Rt}f>>>=2,h-=2;break;case va:for(f>>>=h&7,h-=h&7;h<32;){if(o===0)break t;o--,f+=i[a++]<<h,h+=8}if((f&65535)!==(f>>>16^65535)){t.msg="invalid stored block lengths",n.mode=Rt;break}if(n.length=f&65535,f=0,h=0,n.mode=oi,e===wn)break t;case oi:n.mode=wa;case wa:if(_=n.length,_){if(_>o&&(_=o),_>c&&(_=c),_===0)break t;r.set(i.subarray(a,a+_),s),o-=_,a+=_,c-=_,s+=_,n.length-=_;break}n.mode=ue;break;case ya:for(;h<14;){if(o===0)break t;o--,f+=i[a++]<<h,h+=8}if(n.nlen=(f&31)+257,f>>>=5,h-=5,n.ndist=(f&31)+1,f>>>=5,h-=5,n.ncode=(f&15)+4,f>>>=4,h-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=Rt;break}n.have=0,n.mode=xa;case xa:for(;n.have<n.ncode;){for(;h<3;){if(o===0)break t;o--,f+=i[a++]<<h,h+=8}n.lens[Z[n.have++]]=f&7,f>>>=3,h-=3}for(;n.have<19;)n.lens[Z[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,L={bits:n.lenbits},F=je(p0,n.lens,0,19,n.lencode,0,n.work,L),n.lenbits=L.bits,F){t.msg="invalid code lengths set",n.mode=Rt;break}n.have=0,n.mode=ba;case ba:for(;n.have<n.nlen+n.ndist;){for(;I=n.lencode[f&(1<<n.lenbits)-1],N=I>>>24,E=I>>>16&255,b=I&65535,!(N<=h);){if(o===0)break t;o--,f+=i[a++]<<h,h+=8}if(b<16)f>>>=N,h-=N,n.lens[n.have++]=b;else{if(b===16){for(v=N+2;h<v;){if(o===0)break t;o--,f+=i[a++]<<h,h+=8}if(f>>>=N,h-=N,n.have===0){t.msg="invalid bit length repeat",n.mode=Rt;break}k=n.lens[n.have-1],_=3+(f&3),f>>>=2,h-=2}else if(b===17){for(v=N+3;h<v;){if(o===0)break t;o--,f+=i[a++]<<h,h+=8}f>>>=N,h-=N,k=0,_=3+(f&7),f>>>=3,h-=3}else{for(v=N+7;h<v;){if(o===0)break t;o--,f+=i[a++]<<h,h+=8}f>>>=N,h-=N,k=0,_=11+(f&127),f>>>=7,h-=7}if(n.have+_>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=Rt;break}for(;_--;)n.lens[n.have++]=k}}if(n.mode===Rt)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=Rt;break}if(n.lenbits=9,L={bits:n.lenbits},F=je(oo,n.lens,0,n.nlen,n.lencode,0,n.work,L),n.lenbits=L.bits,F){t.msg="invalid literal/lengths set",n.mode=Rt;break}if(n.distbits=6,n.distcode=n.distdyn,L={bits:n.distbits},F=je(lo,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,L),n.distbits=L.bits,F){t.msg="invalid distances set",n.mode=Rt;break}if(n.mode=yn,e===wn)break t;case yn:n.mode=xn;case xn:if(o>=6&&c>=258){t.next_out=s,t.avail_out=c,t.next_in=a,t.avail_in=o,n.hold=f,n.bits=h,l0(t,p),s=t.next_out,r=t.output,c=t.avail_out,a=t.next_in,i=t.input,o=t.avail_in,f=n.hold,h=n.bits,n.mode===ue&&(n.back=-1);break}for(n.back=0;I=n.lencode[f&(1<<n.lenbits)-1],N=I>>>24,E=I>>>16&255,b=I&65535,!(N<=h);){if(o===0)break t;o--,f+=i[a++]<<h,h+=8}if(E&&(E&240)===0){for(y=N,S=E,D=b;I=n.lencode[D+((f&(1<<y+S)-1)>>y)],N=I>>>24,E=I>>>16&255,b=I&65535,!(y+N<=h);){if(o===0)break t;o--,f+=i[a++]<<h,h+=8}f>>>=y,h-=y,n.back+=y}if(f>>>=N,h-=N,n.back+=N,n.length=b,E===0){n.mode=Aa;break}if(E&32){n.back=-1,n.mode=ue;break}if(E&64){t.msg="invalid literal/length code",n.mode=Rt;break}n.extra=E&15,n.mode=ka;case ka:if(n.extra){for(v=n.extra;h<v;){if(o===0)break t;o--,f+=i[a++]<<h,h+=8}n.length+=f&(1<<n.extra)-1,f>>>=n.extra,h-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=Ea;case Ea:for(;I=n.distcode[f&(1<<n.distbits)-1],N=I>>>24,E=I>>>16&255,b=I&65535,!(N<=h);){if(o===0)break t;o--,f+=i[a++]<<h,h+=8}if((E&240)===0){for(y=N,S=E,D=b;I=n.distcode[D+((f&(1<<y+S)-1)>>y)],N=I>>>24,E=I>>>16&255,b=I&65535,!(y+N<=h);){if(o===0)break t;o--,f+=i[a++]<<h,h+=8}f>>>=y,h-=y,n.back+=y}if(f>>>=N,h-=N,n.back+=N,E&64){t.msg="invalid distance code",n.mode=Rt;break}n.offset=b,n.extra=E&15,n.mode=Ta;case Ta:if(n.extra){for(v=n.extra;h<v;){if(o===0)break t;o--,f+=i[a++]<<h,h+=8}n.offset+=f&(1<<n.extra)-1,f>>>=n.extra,h-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=Rt;break}n.mode=Sa;case Sa:if(c===0)break t;if(_=p-c,n.offset>_){if(_=n.offset-_,_>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=Rt;break}_>n.wnext?(_-=n.wnext,T=n.wsize-_):T=n.wnext-_,_>n.length&&(_=n.length),C=n.window}else C=r,T=s-n.offset,_=n.length;_>c&&(_=c),c-=_,n.length-=_;do r[s++]=C[T++];while(--_);n.length===0&&(n.mode=xn);break;case Aa:if(c===0)break t;r[s++]=n.length,c--,n.mode=xn;break;case li:if(n.wrap){for(;h<32;){if(o===0)break t;o--,f|=i[a++]<<h,h+=8}if(p-=c,t.total_out+=p,n.total+=p,n.wrap&4&&p&&(t.adler=n.check=n.flags?se(n.check,r,p,s-p):Ki(n.check,r,p,s-p)),p=c,n.wrap&4&&(n.flags?f:$a(f))!==n.check){t.msg="incorrect data check",n.mode=Rt;break}f=0,h=0}n.mode=Na;case Na:if(n.wrap&&n.flags){for(;h<32;){if(o===0)break t;o--,f+=i[a++]<<h,h+=8}if(n.wrap&4&&f!==(n.total&4294967295)){t.msg="incorrect length check",n.mode=Rt;break}f=0,h=0}n.mode=Ia;case Ia:F=g0;break t;case Rt:F=co;break t;case ho:return fo;case uo:default:return jt}return t.next_out=s,t.avail_out=c,t.next_in=a,t.avail_in=o,n.hold=f,n.bits=h,(n.wsize||p!==t.avail_out&&n.mode<Rt&&(n.mode<li||e!==oa))&&vo(t,t.output,t.next_out,p-t.avail_out),m-=t.avail_in,p-=t.avail_out,t.total_in+=m,t.total_out+=p,n.total+=p,n.wrap&4&&p&&(t.adler=n.check=n.flags?se(n.check,r,p,t.next_out-p):Ki(n.check,r,p,t.next_out-p)),t.data_type=n.bits+(n.last?64:0)+(n.mode===ue?128:0)+(n.mode===yn||n.mode===oi?256:0),(m===0&&p===0||e===oa)&&F===$e&&(F=v0),F},A0=t=>{if(De(t))return jt;let e=t.state;return e.window&&(e.window=null),t.state=null,$e},N0=(t,e)=>{if(De(t))return jt;const n=t.state;return(n.wrap&2)===0?jt:(n.head=e,e.done=!1,$e)},I0=(t,e)=>{const n=e.length;let i,r,a;return De(t)||(i=t.state,i.wrap!==0&&i.mode!==Vn)?jt:i.mode===Vn&&(r=1,r=Ki(r,e,n,0),r!==i.check)?co:(a=vo(t,e,n,n),a?(i.mode=ho,fo):(i.havedict=1,$e))};var $0=_o,R0=go,D0=po,M0=E0,O0=mo,L0=S0,H0=A0,C0=N0,F0=I0,z0="pako inflate (from Nodeca project)",de={inflateReset:$0,inflateReset2:R0,inflateResetKeep:D0,inflateInit:M0,inflateInit2:O0,inflate:L0,inflateEnd:H0,inflateGetHeader:C0,inflateSetDictionary:F0,inflateInfo:z0};function B0(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var P0=B0;const wo=Object.prototype.toString,{Z_NO_FLUSH:G0,Z_FINISH:U0,Z_OK:on,Z_STREAM_END:hi,Z_NEED_DICT:ui,Z_STREAM_ERROR:V0,Z_DATA_ERROR:Da,Z_MEM_ERROR:Z0}=ro;function jn(t){this.options=ao.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(t&&t.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)===0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s0,this.strm.avail_out=0;let n=de.inflateInit2(this.strm,e.windowBits);if(n!==on)throw new Error(Yi[n]);if(this.header=new P0,de.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=Ji.string2buf(e.dictionary):wo.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=de.inflateSetDictionary(this.strm,e.dictionary),n!==on)))throw new Error(Yi[n])}jn.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize,r=this.options.dictionary;let a,s,o;if(this.ended)return!1;for(e===~~e?s=e:s=e===!0?U0:G0,wo.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),a=de.inflate(n,s),a===ui&&r&&(a=de.inflateSetDictionary(n,r),a===on?a=de.inflate(n,s):a===Da&&(a=ui));n.avail_in>0&&a===hi&&n.state.wrap>0&&t[n.next_in]!==0;)de.inflateReset(n),a=de.inflate(n,s);switch(a){case V0:case Da:case ui:case Z0:return this.onEnd(a),this.ended=!0,!1}if(o=n.avail_out,n.next_out&&(n.avail_out===0||a===hi))if(this.options.to==="string"){let c=Ji.utf8border(n.output,n.next_out),f=n.next_out-c,h=Ji.buf2string(n.output,c);n.next_out=f,n.avail_out=i-f,f&&n.output.set(n.output.subarray(c,c+f),0),this.onData(h)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(!(a===on&&o===0)){if(a===hi)return a=de.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(n.avail_in===0)break}}return!0};jn.prototype.onData=function(t){this.chunks.push(t)};jn.prototype.onEnd=function(t){t===on&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=ao.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function q0(t,e){const n=new jn(e);if(n.push(t),n.err)throw n.msg||Yi[n.err];return n.result}var W0=q0,X0={inflate:W0};const{inflate:K0}=X0;var Y0=K0;const J0={refName:"seq_id"},Q0={seq_id:"refName"};class Zn{constructor(e,n,i){this.ncFeature=e,this.uniqueId=i||e.id(),this.parentHandle=n}jb2TagToJb1Tag(e){return(J0[e]||e).toLowerCase()}jb1TagToJb2Tag(e){const n=e.toLowerCase();return Q0[n]||n}get(e){const n=this.ncFeature.get(this.jb2TagToJb1Tag(e));return n&&e==="subfeatures"?n.map(i=>new Zn(i,this)):n}tags(){return this.ncFeature.tags().map(e=>this.jb1TagToJb2Tag(e))}id(){return this.uniqueId}parent(){return this.parentHandle}children(){return this.get("subfeatures")}toJSON(){const e={uniqueId:this.id(),subfeatures:[]};return this.ncFeature.tags().forEach(n=>{const i=this.jb1TagToJb2Tag(n),r=this.ncFeature.get(n);i==="subfeatures"?e.children=(r||[]).map(a=>new Zn(a,this).toJSON()):e[i]=r}),{...e,fmin:e.start,fmax:e.end,seqId:e.refName}}}function j0(t){return t[0]===31&&t[1]===139&&t[2]===8}async function tp(t){const e=await fetch(t);if(!e.ok)throw new Error(`HTTP ${e.status} fetching ${t}`);const n=await e.arrayBuffer();return j0(new Uint8Array(n))?Y0(n):n}async function zp({urlTemplate:t,baseUrl:e,region:n}){const i=new Hd({urlTemplate:t,baseUrl:e,readFile:tp}),r=[];for await(const a of i.getFeatures({refName:n.chromosome,start:n.start,end:n.end}))r.push(new Zn(a).toJSON());return r}var di={},Ma;function ve(){return Ma||(Ma=1,(function(t){var e=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function n(a,s){return Object.prototype.hasOwnProperty.call(a,s)}t.assign=function(a){for(var s=Array.prototype.slice.call(arguments,1);s.length;){var o=s.shift();if(o){if(typeof o!="object")throw new TypeError(o+"must be non-object");for(var c in o)n(o,c)&&(a[c]=o[c])}}return a},t.shrinkBuf=function(a,s){return a.length===s?a:a.subarray?a.subarray(0,s):(a.length=s,a)};var i={arraySet:function(a,s,o,c,f){if(s.subarray&&a.subarray){a.set(s.subarray(o,o+c),f);return}for(var h=0;h<c;h++)a[f+h]=s[o+h]},flattenChunks:function(a){var s,o,c,f,h,m;for(c=0,s=0,o=a.length;s<o;s++)c+=a[s].length;for(m=new Uint8Array(c),f=0,s=0,o=a.length;s<o;s++)h=a[s],m.set(h,f),f+=h.length;return m}},r={arraySet:function(a,s,o,c,f){for(var h=0;h<c;h++)a[f+h]=s[o+h]},flattenChunks:function(a){return[].concat.apply([],a)}};t.setTyped=function(a){a?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,i)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,r))},t.setTyped(e)})(di)),di}var Oe={},te={},ye={},Oa;function ep(){if(Oa)return ye;Oa=1;var t=ve(),e=4,n=0,i=1,r=2;function a(g){for(var O=g.length;--O>=0;)g[O]=0}var s=0,o=1,c=2,f=3,h=258,m=29,p=256,_=p+1+m,T=30,C=19,I=2*_+1,N=15,E=16,b=7,y=256,S=16,D=17,k=18,F=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],z=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],L=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],v=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Z=512,P=new Array((_+2)*2);a(P);var Q=new Array(T*2);a(Q);var nt=new Array(Z);a(nt);var it=new Array(h-f+1);a(it);var W=new Array(m);a(W);var st=new Array(T);a(st);function q(g,O,H,U,w){this.static_tree=g,this.extra_bits=O,this.extra_base=H,this.elems=U,this.max_length=w,this.has_stree=g&&g.length}var V,It,Et;function dt(g,O){this.dyn_tree=g,this.max_code=0,this.stat_desc=O}function Tt(g){return g<256?nt[g]:nt[256+(g>>>7)]}function ct(g,O){g.pending_buf[g.pending++]=O&255,g.pending_buf[g.pending++]=O>>>8&255}function tt(g,O,H){g.bi_valid>E-H?(g.bi_buf|=O<<g.bi_valid&65535,ct(g,g.bi_buf),g.bi_buf=O>>E-g.bi_valid,g.bi_valid+=H-E):(g.bi_buf|=O<<g.bi_valid&65535,g.bi_valid+=H)}function ot(g,O,H){tt(g,H[O*2],H[O*2+1])}function at(g,O){var H=0;do H|=g&1,g>>>=1,H<<=1;while(--O>0);return H>>>1}function St(g){g.bi_valid===16?(ct(g,g.bi_buf),g.bi_buf=0,g.bi_valid=0):g.bi_valid>=8&&(g.pending_buf[g.pending++]=g.bi_buf&255,g.bi_buf>>=8,g.bi_valid-=8)}function Dt(g,O){var H=O.dyn_tree,U=O.max_code,w=O.stat_desc.static_tree,A=O.stat_desc.has_stree,u=O.stat_desc.extra_bits,B=O.stat_desc.extra_base,j=O.stat_desc.max_length,l,R,M,d,x,$,et=0;for(d=0;d<=N;d++)g.bl_count[d]=0;for(H[g.heap[g.heap_max]*2+1]=0,l=g.heap_max+1;l<I;l++)R=g.heap[l],d=H[H[R*2+1]*2+1]+1,d>j&&(d=j,et++),H[R*2+1]=d,!(R>U)&&(g.bl_count[d]++,x=0,R>=B&&(x=u[R-B]),$=H[R*2],g.opt_len+=$*(d+x),A&&(g.static_len+=$*(w[R*2+1]+x)));if(et!==0){do{for(d=j-1;g.bl_count[d]===0;)d--;g.bl_count[d]--,g.bl_count[d+1]+=2,g.bl_count[j]--,et-=2}while(et>0);for(d=j;d!==0;d--)for(R=g.bl_count[d];R!==0;)M=g.heap[--l],!(M>U)&&(H[M*2+1]!==d&&(g.opt_len+=(d-H[M*2+1])*H[M*2],H[M*2+1]=d),R--)}}function Lt(g,O,H){var U=new Array(N+1),w=0,A,u;for(A=1;A<=N;A++)U[A]=w=w+H[A-1]<<1;for(u=0;u<=O;u++){var B=g[u*2+1];B!==0&&(g[u*2]=at(U[B]++,B))}}function X(){var g,O,H,U,w,A=new Array(N+1);for(H=0,U=0;U<m-1;U++)for(W[U]=H,g=0;g<1<<F[U];g++)it[H++]=U;for(it[H-1]=U,w=0,U=0;U<16;U++)for(st[U]=w,g=0;g<1<<z[U];g++)nt[w++]=U;for(w>>=7;U<T;U++)for(st[U]=w<<7,g=0;g<1<<z[U]-7;g++)nt[256+w++]=U;for(O=0;O<=N;O++)A[O]=0;for(g=0;g<=143;)P[g*2+1]=8,g++,A[8]++;for(;g<=255;)P[g*2+1]=9,g++,A[9]++;for(;g<=279;)P[g*2+1]=7,g++,A[7]++;for(;g<=287;)P[g*2+1]=8,g++,A[8]++;for(Lt(P,_+1,A),g=0;g<T;g++)Q[g*2+1]=5,Q[g*2]=at(g,5);V=new q(P,F,p+1,_,N),It=new q(Q,z,0,T,N),Et=new q(new Array(0),L,0,C,b)}function _t(g){var O;for(O=0;O<_;O++)g.dyn_ltree[O*2]=0;for(O=0;O<T;O++)g.dyn_dtree[O*2]=0;for(O=0;O<C;O++)g.bl_tree[O*2]=0;g.dyn_ltree[y*2]=1,g.opt_len=g.static_len=0,g.last_lit=g.matches=0}function At(g){g.bi_valid>8?ct(g,g.bi_buf):g.bi_valid>0&&(g.pending_buf[g.pending++]=g.bi_buf),g.bi_buf=0,g.bi_valid=0}function yt(g,O,H,U){At(g),ct(g,H),ct(g,~H),t.arraySet(g.pending_buf,g.window,O,H,g.pending),g.pending+=H}function xt(g,O,H,U){var w=O*2,A=H*2;return g[w]<g[A]||g[w]===g[A]&&U[O]<=U[H]}function K(g,O,H){for(var U=g.heap[H],w=H<<1;w<=g.heap_len&&(w<g.heap_len&&xt(O,g.heap[w+1],g.heap[w],g.depth)&&w++,!xt(O,U,g.heap[w],g.depth));)g.heap[H]=g.heap[w],H=w,w<<=1;g.heap[H]=U}function rt(g,O,H){var U,w,A=0,u,B;if(g.last_lit!==0)do U=g.pending_buf[g.d_buf+A*2]<<8|g.pending_buf[g.d_buf+A*2+1],w=g.pending_buf[g.l_buf+A],A++,U===0?ot(g,w,O):(u=it[w],ot(g,u+p+1,O),B=F[u],B!==0&&(w-=W[u],tt(g,w,B)),U--,u=Tt(U),ot(g,u,H),B=z[u],B!==0&&(U-=st[u],tt(g,U,B)));while(A<g.last_lit);ot(g,y,O)}function Ht(g,O){var H=O.dyn_tree,U=O.stat_desc.static_tree,w=O.stat_desc.has_stree,A=O.stat_desc.elems,u,B,j=-1,l;for(g.heap_len=0,g.heap_max=I,u=0;u<A;u++)H[u*2]!==0?(g.heap[++g.heap_len]=j=u,g.depth[u]=0):H[u*2+1]=0;for(;g.heap_len<2;)l=g.heap[++g.heap_len]=j<2?++j:0,H[l*2]=1,g.depth[l]=0,g.opt_len--,w&&(g.static_len-=U[l*2+1]);for(O.max_code=j,u=g.heap_len>>1;u>=1;u--)K(g,H,u);l=A;do u=g.heap[1],g.heap[1]=g.heap[g.heap_len--],K(g,H,1),B=g.heap[1],g.heap[--g.heap_max]=u,g.heap[--g.heap_max]=B,H[l*2]=H[u*2]+H[B*2],g.depth[l]=(g.depth[u]>=g.depth[B]?g.depth[u]:g.depth[B])+1,H[u*2+1]=H[B*2+1]=l,g.heap[1]=l++,K(g,H,1);while(g.heap_len>=2);g.heap[--g.heap_max]=g.heap[1],Dt(g,O),Lt(H,j,g.bl_count)}function Zt(g,O,H){var U,w=-1,A,u=O[1],B=0,j=7,l=4;for(u===0&&(j=138,l=3),O[(H+1)*2+1]=65535,U=0;U<=H;U++)A=u,u=O[(U+1)*2+1],!(++B<j&&A===u)&&(B<l?g.bl_tree[A*2]+=B:A!==0?(A!==w&&g.bl_tree[A*2]++,g.bl_tree[S*2]++):B<=10?g.bl_tree[D*2]++:g.bl_tree[k*2]++,B=0,w=A,u===0?(j=138,l=3):A===u?(j=6,l=3):(j=7,l=4))}function bt(g,O,H){var U,w=-1,A,u=O[1],B=0,j=7,l=4;for(u===0&&(j=138,l=3),U=0;U<=H;U++)if(A=u,u=O[(U+1)*2+1],!(++B<j&&A===u)){if(B<l)do ot(g,A,g.bl_tree);while(--B!==0);else A!==0?(A!==w&&(ot(g,A,g.bl_tree),B--),ot(g,S,g.bl_tree),tt(g,B-3,2)):B<=10?(ot(g,D,g.bl_tree),tt(g,B-3,3)):(ot(g,k,g.bl_tree),tt(g,B-11,7));B=0,w=A,u===0?(j=138,l=3):A===u?(j=6,l=3):(j=7,l=4)}}function pt(g){var O;for(Zt(g,g.dyn_ltree,g.l_desc.max_code),Zt(g,g.dyn_dtree,g.d_desc.max_code),Ht(g,g.bl_desc),O=C-1;O>=3&&g.bl_tree[v[O]*2+1]===0;O--);return g.opt_len+=3*(O+1)+5+5+4,O}function ht(g,O,H,U){var w;for(tt(g,O-257,5),tt(g,H-1,5),tt(g,U-4,4),w=0;w<U;w++)tt(g,g.bl_tree[v[w]*2+1],3);bt(g,g.dyn_ltree,O-1),bt(g,g.dyn_dtree,H-1)}function ut(g){var O=4093624447,H;for(H=0;H<=31;H++,O>>>=1)if(O&1&&g.dyn_ltree[H*2]!==0)return n;if(g.dyn_ltree[18]!==0||g.dyn_ltree[20]!==0||g.dyn_ltree[26]!==0)return i;for(H=32;H<p;H++)if(g.dyn_ltree[H*2]!==0)return i;return n}var $t=!1;function G(g){$t||(X(),$t=!0),g.l_desc=new dt(g.dyn_ltree,V),g.d_desc=new dt(g.dyn_dtree,It),g.bl_desc=new dt(g.bl_tree,Et),g.bi_buf=0,g.bi_valid=0,_t(g)}function Mt(g,O,H,U){tt(g,(s<<1)+(U?1:0),3),yt(g,O,H)}function ft(g){tt(g,o<<1,3),ot(g,y,P),St(g)}function lt(g,O,H,U){var w,A,u=0;g.level>0?(g.strm.data_type===r&&(g.strm.data_type=ut(g)),Ht(g,g.l_desc),Ht(g,g.d_desc),u=pt(g),w=g.opt_len+3+7>>>3,A=g.static_len+3+7>>>3,A<=w&&(w=A)):w=A=H+5,H+4<=w&&O!==-1?Mt(g,O,H,U):g.strategy===e||A===w?(tt(g,(o<<1)+(U?1:0),3),rt(g,P,Q)):(tt(g,(c<<1)+(U?1:0),3),ht(g,g.l_desc.max_code+1,g.d_desc.max_code+1,u+1),rt(g,g.dyn_ltree,g.dyn_dtree)),_t(g),U&&At(g)}function Nt(g,O,H){return g.pending_buf[g.d_buf+g.last_lit*2]=O>>>8&255,g.pending_buf[g.d_buf+g.last_lit*2+1]=O&255,g.pending_buf[g.l_buf+g.last_lit]=H&255,g.last_lit++,O===0?g.dyn_ltree[H*2]++:(g.matches++,O--,g.dyn_ltree[(it[H]+p+1)*2]++,g.dyn_dtree[Tt(O)*2]++),g.last_lit===g.lit_bufsize-1}return ye._tr_init=G,ye._tr_stored_block=Mt,ye._tr_flush_block=lt,ye._tr_tally=Nt,ye._tr_align=ft,ye}var pi,La;function yo(){if(La)return pi;La=1;function t(e,n,i,r){for(var a=e&65535|0,s=e>>>16&65535|0,o=0;i!==0;){o=i>2e3?2e3:i,i-=o;do a=a+n[r++]|0,s=s+a|0;while(--o);a%=65521,s%=65521}return a|s<<16|0}return pi=t,pi}var _i,Ha;function xo(){if(Ha)return _i;Ha=1;function t(){for(var i,r=[],a=0;a<256;a++){i=a;for(var s=0;s<8;s++)i=i&1?3988292384^i>>>1:i>>>1;r[a]=i}return r}var e=t();function n(i,r,a,s){var o=e,c=s+a;i^=-1;for(var f=s;f<c;f++)i=i>>>8^o[(i^r[f])&255];return i^-1}return _i=n,_i}var gi,Ca;function br(){return Ca||(Ca=1,gi={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}),gi}var Fa;function np(){if(Fa)return te;Fa=1;var t=ve(),e=ep(),n=yo(),i=xo(),r=br(),a=0,s=1,o=3,c=4,f=5,h=0,m=1,p=-2,_=-3,T=-5,C=-1,I=1,N=2,E=3,b=4,y=0,S=2,D=8,k=9,F=15,z=8,L=29,v=256,Z=v+1+L,P=30,Q=19,nt=2*Z+1,it=15,W=3,st=258,q=st+W+1,V=32,It=42,Et=69,dt=73,Tt=91,ct=103,tt=113,ot=666,at=1,St=2,Dt=3,Lt=4,X=3;function _t(l,R){return l.msg=r[R],R}function At(l){return(l<<1)-(l>4?9:0)}function yt(l){for(var R=l.length;--R>=0;)l[R]=0}function xt(l){var R=l.state,M=R.pending;M>l.avail_out&&(M=l.avail_out),M!==0&&(t.arraySet(l.output,R.pending_buf,R.pending_out,M,l.next_out),l.next_out+=M,R.pending_out+=M,l.total_out+=M,l.avail_out-=M,R.pending-=M,R.pending===0&&(R.pending_out=0))}function K(l,R){e._tr_flush_block(l,l.block_start>=0?l.block_start:-1,l.strstart-l.block_start,R),l.block_start=l.strstart,xt(l.strm)}function rt(l,R){l.pending_buf[l.pending++]=R}function Ht(l,R){l.pending_buf[l.pending++]=R>>>8&255,l.pending_buf[l.pending++]=R&255}function Zt(l,R,M,d){var x=l.avail_in;return x>d&&(x=d),x===0?0:(l.avail_in-=x,t.arraySet(R,l.input,l.next_in,x,M),l.state.wrap===1?l.adler=n(l.adler,R,x,M):l.state.wrap===2&&(l.adler=i(l.adler,R,x,M)),l.next_in+=x,l.total_in+=x,x)}function bt(l,R){var M=l.max_chain_length,d=l.strstart,x,$,et=l.prev_length,Y=l.nice_match,J=l.strstart>l.w_size-q?l.strstart-(l.w_size-q):0,gt=l.window,ce=l.w_mask,Ct=l.prev,vt=l.strstart+st,Gt=gt[d+et-1],Vt=gt[d+et];l.prev_length>=l.good_match&&(M>>=2),Y>l.lookahead&&(Y=l.lookahead);do if(x=R,!(gt[x+et]!==Vt||gt[x+et-1]!==Gt||gt[x]!==gt[d]||gt[++x]!==gt[d+1])){d+=2,x++;do;while(gt[++d]===gt[++x]&&gt[++d]===gt[++x]&&gt[++d]===gt[++x]&&gt[++d]===gt[++x]&&gt[++d]===gt[++x]&&gt[++d]===gt[++x]&&gt[++d]===gt[++x]&&gt[++d]===gt[++x]&&d<vt);if($=st-(vt-d),d=vt-st,$>et){if(l.match_start=R,et=$,$>=Y)break;Gt=gt[d+et-1],Vt=gt[d+et]}}while((R=Ct[R&ce])>J&&--M!==0);return et<=l.lookahead?et:l.lookahead}function pt(l){var R=l.w_size,M,d,x,$,et;do{if($=l.window_size-l.lookahead-l.strstart,l.strstart>=R+(R-q)){t.arraySet(l.window,l.window,R,R,0),l.match_start-=R,l.strstart-=R,l.block_start-=R,d=l.hash_size,M=d;do x=l.head[--M],l.head[M]=x>=R?x-R:0;while(--d);d=R,M=d;do x=l.prev[--M],l.prev[M]=x>=R?x-R:0;while(--d);$+=R}if(l.strm.avail_in===0)break;if(d=Zt(l.strm,l.window,l.strstart+l.lookahead,$),l.lookahead+=d,l.lookahead+l.insert>=W)for(et=l.strstart-l.insert,l.ins_h=l.window[et],l.ins_h=(l.ins_h<<l.hash_shift^l.window[et+1])&l.hash_mask;l.insert&&(l.ins_h=(l.ins_h<<l.hash_shift^l.window[et+W-1])&l.hash_mask,l.prev[et&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=et,et++,l.insert--,!(l.lookahead+l.insert<W)););}while(l.lookahead<q&&l.strm.avail_in!==0)}function ht(l,R){var M=65535;for(M>l.pending_buf_size-5&&(M=l.pending_buf_size-5);;){if(l.lookahead<=1){if(pt(l),l.lookahead===0&&R===a)return at;if(l.lookahead===0)break}l.strstart+=l.lookahead,l.lookahead=0;var d=l.block_start+M;if((l.strstart===0||l.strstart>=d)&&(l.lookahead=l.strstart-d,l.strstart=d,K(l,!1),l.strm.avail_out===0)||l.strstart-l.block_start>=l.w_size-q&&(K(l,!1),l.strm.avail_out===0))return at}return l.insert=0,R===c?(K(l,!0),l.strm.avail_out===0?Dt:Lt):(l.strstart>l.block_start&&(K(l,!1),l.strm.avail_out===0),at)}function ut(l,R){for(var M,d;;){if(l.lookahead<q){if(pt(l),l.lookahead<q&&R===a)return at;if(l.lookahead===0)break}if(M=0,l.lookahead>=W&&(l.ins_h=(l.ins_h<<l.hash_shift^l.window[l.strstart+W-1])&l.hash_mask,M=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart),M!==0&&l.strstart-M<=l.w_size-q&&(l.match_length=bt(l,M)),l.match_length>=W)if(d=e._tr_tally(l,l.strstart-l.match_start,l.match_length-W),l.lookahead-=l.match_length,l.match_length<=l.max_lazy_match&&l.lookahead>=W){l.match_length--;do l.strstart++,l.ins_h=(l.ins_h<<l.hash_shift^l.window[l.strstart+W-1])&l.hash_mask,M=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart;while(--l.match_length!==0);l.strstart++}else l.strstart+=l.match_length,l.match_length=0,l.ins_h=l.window[l.strstart],l.ins_h=(l.ins_h<<l.hash_shift^l.window[l.strstart+1])&l.hash_mask;else d=e._tr_tally(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++;if(d&&(K(l,!1),l.strm.avail_out===0))return at}return l.insert=l.strstart<W-1?l.strstart:W-1,R===c?(K(l,!0),l.strm.avail_out===0?Dt:Lt):l.last_lit&&(K(l,!1),l.strm.avail_out===0)?at:St}function $t(l,R){for(var M,d,x;;){if(l.lookahead<q){if(pt(l),l.lookahead<q&&R===a)return at;if(l.lookahead===0)break}if(M=0,l.lookahead>=W&&(l.ins_h=(l.ins_h<<l.hash_shift^l.window[l.strstart+W-1])&l.hash_mask,M=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart),l.prev_length=l.match_length,l.prev_match=l.match_start,l.match_length=W-1,M!==0&&l.prev_length<l.max_lazy_match&&l.strstart-M<=l.w_size-q&&(l.match_length=bt(l,M),l.match_length<=5&&(l.strategy===I||l.match_length===W&&l.strstart-l.match_start>4096)&&(l.match_length=W-1)),l.prev_length>=W&&l.match_length<=l.prev_length){x=l.strstart+l.lookahead-W,d=e._tr_tally(l,l.strstart-1-l.prev_match,l.prev_length-W),l.lookahead-=l.prev_length-1,l.prev_length-=2;do++l.strstart<=x&&(l.ins_h=(l.ins_h<<l.hash_shift^l.window[l.strstart+W-1])&l.hash_mask,M=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart);while(--l.prev_length!==0);if(l.match_available=0,l.match_length=W-1,l.strstart++,d&&(K(l,!1),l.strm.avail_out===0))return at}else if(l.match_available){if(d=e._tr_tally(l,0,l.window[l.strstart-1]),d&&K(l,!1),l.strstart++,l.lookahead--,l.strm.avail_out===0)return at}else l.match_available=1,l.strstart++,l.lookahead--}return l.match_available&&(d=e._tr_tally(l,0,l.window[l.strstart-1]),l.match_available=0),l.insert=l.strstart<W-1?l.strstart:W-1,R===c?(K(l,!0),l.strm.avail_out===0?Dt:Lt):l.last_lit&&(K(l,!1),l.strm.avail_out===0)?at:St}function G(l,R){for(var M,d,x,$,et=l.window;;){if(l.lookahead<=st){if(pt(l),l.lookahead<=st&&R===a)return at;if(l.lookahead===0)break}if(l.match_length=0,l.lookahead>=W&&l.strstart>0&&(x=l.strstart-1,d=et[x],d===et[++x]&&d===et[++x]&&d===et[++x])){$=l.strstart+st;do;while(d===et[++x]&&d===et[++x]&&d===et[++x]&&d===et[++x]&&d===et[++x]&&d===et[++x]&&d===et[++x]&&d===et[++x]&&x<$);l.match_length=st-($-x),l.match_length>l.lookahead&&(l.match_length=l.lookahead)}if(l.match_length>=W?(M=e._tr_tally(l,1,l.match_length-W),l.lookahead-=l.match_length,l.strstart+=l.match_length,l.match_length=0):(M=e._tr_tally(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++),M&&(K(l,!1),l.strm.avail_out===0))return at}return l.insert=0,R===c?(K(l,!0),l.strm.avail_out===0?Dt:Lt):l.last_lit&&(K(l,!1),l.strm.avail_out===0)?at:St}function Mt(l,R){for(var M;;){if(l.lookahead===0&&(pt(l),l.lookahead===0)){if(R===a)return at;break}if(l.match_length=0,M=e._tr_tally(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++,M&&(K(l,!1),l.strm.avail_out===0))return at}return l.insert=0,R===c?(K(l,!0),l.strm.avail_out===0?Dt:Lt):l.last_lit&&(K(l,!1),l.strm.avail_out===0)?at:St}function ft(l,R,M,d,x){this.good_length=l,this.max_lazy=R,this.nice_length=M,this.max_chain=d,this.func=x}var lt;lt=[new ft(0,0,0,0,ht),new ft(4,4,8,4,ut),new ft(4,5,16,8,ut),new ft(4,6,32,32,ut),new ft(4,4,16,16,$t),new ft(8,16,32,32,$t),new ft(8,16,128,128,$t),new ft(8,32,128,256,$t),new ft(32,128,258,1024,$t),new ft(32,258,258,4096,$t)];function Nt(l){l.window_size=2*l.w_size,yt(l.head),l.max_lazy_match=lt[l.level].max_lazy,l.good_match=lt[l.level].good_length,l.nice_match=lt[l.level].nice_length,l.max_chain_length=lt[l.level].max_chain,l.strstart=0,l.block_start=0,l.lookahead=0,l.insert=0,l.match_length=l.prev_length=W-1,l.match_available=0,l.ins_h=0}function g(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=D,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new t.Buf16(nt*2),this.dyn_dtree=new t.Buf16((2*P+1)*2),this.bl_tree=new t.Buf16((2*Q+1)*2),yt(this.dyn_ltree),yt(this.dyn_dtree),yt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new t.Buf16(it+1),this.heap=new t.Buf16(2*Z+1),yt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new t.Buf16(2*Z+1),yt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function O(l){var R;return!l||!l.state?_t(l,p):(l.total_in=l.total_out=0,l.data_type=S,R=l.state,R.pending=0,R.pending_out=0,R.wrap<0&&(R.wrap=-R.wrap),R.status=R.wrap?It:tt,l.adler=R.wrap===2?0:1,R.last_flush=a,e._tr_init(R),h)}function H(l){var R=O(l);return R===h&&Nt(l.state),R}function U(l,R){return!l||!l.state||l.state.wrap!==2?p:(l.state.gzhead=R,h)}function w(l,R,M,d,x,$){if(!l)return p;var et=1;if(R===C&&(R=6),d<0?(et=0,d=-d):d>15&&(et=2,d-=16),x<1||x>k||M!==D||d<8||d>15||R<0||R>9||$<0||$>b)return _t(l,p);d===8&&(d=9);var Y=new g;return l.state=Y,Y.strm=l,Y.wrap=et,Y.gzhead=null,Y.w_bits=d,Y.w_size=1<<Y.w_bits,Y.w_mask=Y.w_size-1,Y.hash_bits=x+7,Y.hash_size=1<<Y.hash_bits,Y.hash_mask=Y.hash_size-1,Y.hash_shift=~~((Y.hash_bits+W-1)/W),Y.window=new t.Buf8(Y.w_size*2),Y.head=new t.Buf16(Y.hash_size),Y.prev=new t.Buf16(Y.w_size),Y.lit_bufsize=1<<x+6,Y.pending_buf_size=Y.lit_bufsize*4,Y.pending_buf=new t.Buf8(Y.pending_buf_size),Y.d_buf=1*Y.lit_bufsize,Y.l_buf=3*Y.lit_bufsize,Y.level=R,Y.strategy=$,Y.method=M,H(l)}function A(l,R){return w(l,R,D,F,z,y)}function u(l,R){var M,d,x,$;if(!l||!l.state||R>f||R<0)return l?_t(l,p):p;if(d=l.state,!l.output||!l.input&&l.avail_in!==0||d.status===ot&&R!==c)return _t(l,l.avail_out===0?T:p);if(d.strm=l,M=d.last_flush,d.last_flush=R,d.status===It)if(d.wrap===2)l.adler=0,rt(d,31),rt(d,139),rt(d,8),d.gzhead?(rt(d,(d.gzhead.text?1:0)+(d.gzhead.hcrc?2:0)+(d.gzhead.extra?4:0)+(d.gzhead.name?8:0)+(d.gzhead.comment?16:0)),rt(d,d.gzhead.time&255),rt(d,d.gzhead.time>>8&255),rt(d,d.gzhead.time>>16&255),rt(d,d.gzhead.time>>24&255),rt(d,d.level===9?2:d.strategy>=N||d.level<2?4:0),rt(d,d.gzhead.os&255),d.gzhead.extra&&d.gzhead.extra.length&&(rt(d,d.gzhead.extra.length&255),rt(d,d.gzhead.extra.length>>8&255)),d.gzhead.hcrc&&(l.adler=i(l.adler,d.pending_buf,d.pending,0)),d.gzindex=0,d.status=Et):(rt(d,0),rt(d,0),rt(d,0),rt(d,0),rt(d,0),rt(d,d.level===9?2:d.strategy>=N||d.level<2?4:0),rt(d,X),d.status=tt);else{var et=D+(d.w_bits-8<<4)<<8,Y=-1;d.strategy>=N||d.level<2?Y=0:d.level<6?Y=1:d.level===6?Y=2:Y=3,et|=Y<<6,d.strstart!==0&&(et|=V),et+=31-et%31,d.status=tt,Ht(d,et),d.strstart!==0&&(Ht(d,l.adler>>>16),Ht(d,l.adler&65535)),l.adler=1}if(d.status===Et)if(d.gzhead.extra){for(x=d.pending;d.gzindex<(d.gzhead.extra.length&65535)&&!(d.pending===d.pending_buf_size&&(d.gzhead.hcrc&&d.pending>x&&(l.adler=i(l.adler,d.pending_buf,d.pending-x,x)),xt(l),x=d.pending,d.pending===d.pending_buf_size));)rt(d,d.gzhead.extra[d.gzindex]&255),d.gzindex++;d.gzhead.hcrc&&d.pending>x&&(l.adler=i(l.adler,d.pending_buf,d.pending-x,x)),d.gzindex===d.gzhead.extra.length&&(d.gzindex=0,d.status=dt)}else d.status=dt;if(d.status===dt)if(d.gzhead.name){x=d.pending;do{if(d.pending===d.pending_buf_size&&(d.gzhead.hcrc&&d.pending>x&&(l.adler=i(l.adler,d.pending_buf,d.pending-x,x)),xt(l),x=d.pending,d.pending===d.pending_buf_size)){$=1;break}d.gzindex<d.gzhead.name.length?$=d.gzhead.name.charCodeAt(d.gzindex++)&255:$=0,rt(d,$)}while($!==0);d.gzhead.hcrc&&d.pending>x&&(l.adler=i(l.adler,d.pending_buf,d.pending-x,x)),$===0&&(d.gzindex=0,d.status=Tt)}else d.status=Tt;if(d.status===Tt)if(d.gzhead.comment){x=d.pending;do{if(d.pending===d.pending_buf_size&&(d.gzhead.hcrc&&d.pending>x&&(l.adler=i(l.adler,d.pending_buf,d.pending-x,x)),xt(l),x=d.pending,d.pending===d.pending_buf_size)){$=1;break}d.gzindex<d.gzhead.comment.length?$=d.gzhead.comment.charCodeAt(d.gzindex++)&255:$=0,rt(d,$)}while($!==0);d.gzhead.hcrc&&d.pending>x&&(l.adler=i(l.adler,d.pending_buf,d.pending-x,x)),$===0&&(d.status=ct)}else d.status=ct;if(d.status===ct&&(d.gzhead.hcrc?(d.pending+2>d.pending_buf_size&&xt(l),d.pending+2<=d.pending_buf_size&&(rt(d,l.adler&255),rt(d,l.adler>>8&255),l.adler=0,d.status=tt)):d.status=tt),d.pending!==0){if(xt(l),l.avail_out===0)return d.last_flush=-1,h}else if(l.avail_in===0&&At(R)<=At(M)&&R!==c)return _t(l,T);if(d.status===ot&&l.avail_in!==0)return _t(l,T);if(l.avail_in!==0||d.lookahead!==0||R!==a&&d.status!==ot){var J=d.strategy===N?Mt(d,R):d.strategy===E?G(d,R):lt[d.level].func(d,R);if((J===Dt||J===Lt)&&(d.status=ot),J===at||J===Dt)return l.avail_out===0&&(d.last_flush=-1),h;if(J===St&&(R===s?e._tr_align(d):R!==f&&(e._tr_stored_block(d,0,0,!1),R===o&&(yt(d.head),d.lookahead===0&&(d.strstart=0,d.block_start=0,d.insert=0))),xt(l),l.avail_out===0))return d.last_flush=-1,h}return R!==c?h:d.wrap<=0?m:(d.wrap===2?(rt(d,l.adler&255),rt(d,l.adler>>8&255),rt(d,l.adler>>16&255),rt(d,l.adler>>24&255),rt(d,l.total_in&255),rt(d,l.total_in>>8&255),rt(d,l.total_in>>16&255),rt(d,l.total_in>>24&255)):(Ht(d,l.adler>>>16),Ht(d,l.adler&65535)),xt(l),d.wrap>0&&(d.wrap=-d.wrap),d.pending!==0?h:m)}function B(l){var R;return!l||!l.state?p:(R=l.state.status,R!==It&&R!==Et&&R!==dt&&R!==Tt&&R!==ct&&R!==tt&&R!==ot?_t(l,p):(l.state=null,R===tt?_t(l,_):h))}function j(l,R){var M=R.length,d,x,$,et,Y,J,gt,ce;if(!l||!l.state||(d=l.state,et=d.wrap,et===2||et===1&&d.status!==It||d.lookahead))return p;for(et===1&&(l.adler=n(l.adler,R,M,0)),d.wrap=0,M>=d.w_size&&(et===0&&(yt(d.head),d.strstart=0,d.block_start=0,d.insert=0),ce=new t.Buf8(d.w_size),t.arraySet(ce,R,M-d.w_size,d.w_size,0),R=ce,M=d.w_size),Y=l.avail_in,J=l.next_in,gt=l.input,l.avail_in=M,l.next_in=0,l.input=R,pt(d);d.lookahead>=W;){x=d.strstart,$=d.lookahead-(W-1);do d.ins_h=(d.ins_h<<d.hash_shift^d.window[x+W-1])&d.hash_mask,d.prev[x&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=x,x++;while(--$);d.strstart=x,d.lookahead=W-1,pt(d)}return d.strstart+=d.lookahead,d.block_start=d.strstart,d.insert=d.lookahead,d.lookahead=0,d.match_length=d.prev_length=W-1,d.match_available=0,l.next_in=J,l.input=gt,l.avail_in=Y,d.wrap=et,h}return te.deflateInit=A,te.deflateInit2=w,te.deflateReset=H,te.deflateResetKeep=O,te.deflateSetHeader=U,te.deflate=u,te.deflateEnd=B,te.deflateSetDictionary=j,te.deflateInfo="pako deflate (from Nodeca project)",te}var xe={},za;function bo(){if(za)return xe;za=1;var t=ve(),e=!0,n=!0;try{String.fromCharCode.apply(null,[0])}catch{e=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{n=!1}for(var i=new t.Buf8(256),r=0;r<256;r++)i[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;i[254]=i[254]=1,xe.string2buf=function(s){var o,c,f,h,m,p=s.length,_=0;for(h=0;h<p;h++)c=s.charCodeAt(h),(c&64512)===55296&&h+1<p&&(f=s.charCodeAt(h+1),(f&64512)===56320&&(c=65536+(c-55296<<10)+(f-56320),h++)),_+=c<128?1:c<2048?2:c<65536?3:4;for(o=new t.Buf8(_),m=0,h=0;m<_;h++)c=s.charCodeAt(h),(c&64512)===55296&&h+1<p&&(f=s.charCodeAt(h+1),(f&64512)===56320&&(c=65536+(c-55296<<10)+(f-56320),h++)),c<128?o[m++]=c:c<2048?(o[m++]=192|c>>>6,o[m++]=128|c&63):c<65536?(o[m++]=224|c>>>12,o[m++]=128|c>>>6&63,o[m++]=128|c&63):(o[m++]=240|c>>>18,o[m++]=128|c>>>12&63,o[m++]=128|c>>>6&63,o[m++]=128|c&63);return o};function a(s,o){if(o<65534&&(s.subarray&&n||!s.subarray&&e))return String.fromCharCode.apply(null,t.shrinkBuf(s,o));for(var c="",f=0;f<o;f++)c+=String.fromCharCode(s[f]);return c}return xe.buf2binstring=function(s){return a(s,s.length)},xe.binstring2buf=function(s){for(var o=new t.Buf8(s.length),c=0,f=o.length;c<f;c++)o[c]=s.charCodeAt(c);return o},xe.buf2string=function(s,o){var c,f,h,m,p=o||s.length,_=new Array(p*2);for(f=0,c=0;c<p;){if(h=s[c++],h<128){_[f++]=h;continue}if(m=i[h],m>4){_[f++]=65533,c+=m-1;continue}for(h&=m===2?31:m===3?15:7;m>1&&c<p;)h=h<<6|s[c++]&63,m--;if(m>1){_[f++]=65533;continue}h<65536?_[f++]=h:(h-=65536,_[f++]=55296|h>>10&1023,_[f++]=56320|h&1023)}return a(_,f)},xe.utf8border=function(s,o){var c;for(o=o||s.length,o>s.length&&(o=s.length),c=o-1;c>=0&&(s[c]&192)===128;)c--;return c<0||c===0?o:c+i[s[c]]>o?c:o},xe}var mi,Ba;function ko(){if(Ba)return mi;Ba=1;function t(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}return mi=t,mi}var Pa;function ip(){if(Pa)return Oe;Pa=1;var t=np(),e=ve(),n=bo(),i=br(),r=ko(),a=Object.prototype.toString,s=0,o=4,c=0,f=1,h=2,m=-1,p=0,_=8;function T(E){if(!(this instanceof T))return new T(E);this.options=e.assign({level:m,method:_,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},E||{});var b=this.options;b.raw&&b.windowBits>0?b.windowBits=-b.windowBits:b.gzip&&b.windowBits>0&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r,this.strm.avail_out=0;var y=t.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(y!==c)throw new Error(i[y]);if(b.header&&t.deflateSetHeader(this.strm,b.header),b.dictionary){var S;if(typeof b.dictionary=="string"?S=n.string2buf(b.dictionary):a.call(b.dictionary)==="[object ArrayBuffer]"?S=new Uint8Array(b.dictionary):S=b.dictionary,y=t.deflateSetDictionary(this.strm,S),y!==c)throw new Error(i[y]);this._dict_set=!0}}T.prototype.push=function(E,b){var y=this.strm,S=this.options.chunkSize,D,k;if(this.ended)return!1;k=b===~~b?b:b===!0?o:s,typeof E=="string"?y.input=n.string2buf(E):a.call(E)==="[object ArrayBuffer]"?y.input=new Uint8Array(E):y.input=E,y.next_in=0,y.avail_in=y.input.length;do{if(y.avail_out===0&&(y.output=new e.Buf8(S),y.next_out=0,y.avail_out=S),D=t.deflate(y,k),D!==f&&D!==c)return this.onEnd(D),this.ended=!0,!1;(y.avail_out===0||y.avail_in===0&&(k===o||k===h))&&(this.options.to==="string"?this.onData(n.buf2binstring(e.shrinkBuf(y.output,y.next_out))):this.onData(e.shrinkBuf(y.output,y.next_out)))}while((y.avail_in>0||y.avail_out===0)&&D!==f);return k===o?(D=t.deflateEnd(this.strm),this.onEnd(D),this.ended=!0,D===c):(k===h&&(this.onEnd(c),y.avail_out=0),!0)},T.prototype.onData=function(E){this.chunks.push(E)},T.prototype.onEnd=function(E){E===c&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=e.flattenChunks(this.chunks)),this.chunks=[],this.err=E,this.msg=this.strm.msg};function C(E,b){var y=new T(b);if(y.push(E,!0),y.err)throw y.msg||i[y.err];return y.result}function I(E,b){return b=b||{},b.raw=!0,C(E,b)}function N(E,b){return b=b||{},b.gzip=!0,C(E,b)}return Oe.Deflate=T,Oe.deflate=C,Oe.deflateRaw=I,Oe.gzip=N,Oe}var Le={},Jt={},vi,Ga;function rp(){if(Ga)return vi;Ga=1;var t=30,e=12;return vi=function(i,r){var a,s,o,c,f,h,m,p,_,T,C,I,N,E,b,y,S,D,k,F,z,L,v,Z,P;a=i.state,s=i.next_in,Z=i.input,o=s+(i.avail_in-5),c=i.next_out,P=i.output,f=c-(r-i.avail_out),h=c+(i.avail_out-257),m=a.dmax,p=a.wsize,_=a.whave,T=a.wnext,C=a.window,I=a.hold,N=a.bits,E=a.lencode,b=a.distcode,y=(1<<a.lenbits)-1,S=(1<<a.distbits)-1;t:do{N<15&&(I+=Z[s++]<<N,N+=8,I+=Z[s++]<<N,N+=8),D=E[I&y];e:for(;;){if(k=D>>>24,I>>>=k,N-=k,k=D>>>16&255,k===0)P[c++]=D&65535;else if(k&16){F=D&65535,k&=15,k&&(N<k&&(I+=Z[s++]<<N,N+=8),F+=I&(1<<k)-1,I>>>=k,N-=k),N<15&&(I+=Z[s++]<<N,N+=8,I+=Z[s++]<<N,N+=8),D=b[I&S];n:for(;;){if(k=D>>>24,I>>>=k,N-=k,k=D>>>16&255,k&16){if(z=D&65535,k&=15,N<k&&(I+=Z[s++]<<N,N+=8,N<k&&(I+=Z[s++]<<N,N+=8)),z+=I&(1<<k)-1,z>m){i.msg="invalid distance too far back",a.mode=t;break t}if(I>>>=k,N-=k,k=c-f,z>k){if(k=z-k,k>_&&a.sane){i.msg="invalid distance too far back",a.mode=t;break t}if(L=0,v=C,T===0){if(L+=p-k,k<F){F-=k;do P[c++]=C[L++];while(--k);L=c-z,v=P}}else if(T<k){if(L+=p+T-k,k-=T,k<F){F-=k;do P[c++]=C[L++];while(--k);if(L=0,T<F){k=T,F-=k;do P[c++]=C[L++];while(--k);L=c-z,v=P}}}else if(L+=T-k,k<F){F-=k;do P[c++]=C[L++];while(--k);L=c-z,v=P}for(;F>2;)P[c++]=v[L++],P[c++]=v[L++],P[c++]=v[L++],F-=3;F&&(P[c++]=v[L++],F>1&&(P[c++]=v[L++]))}else{L=c-z;do P[c++]=P[L++],P[c++]=P[L++],P[c++]=P[L++],F-=3;while(F>2);F&&(P[c++]=P[L++],F>1&&(P[c++]=P[L++]))}}else if((k&64)===0){D=b[(D&65535)+(I&(1<<k)-1)];continue n}else{i.msg="invalid distance code",a.mode=t;break t}break}}else if((k&64)===0){D=E[(D&65535)+(I&(1<<k)-1)];continue e}else if(k&32){a.mode=e;break t}else{i.msg="invalid literal/length code",a.mode=t;break t}break}}while(s<o&&c<h);F=N>>3,s-=F,N-=F<<3,I&=(1<<N)-1,i.next_in=s,i.next_out=c,i.avail_in=s<o?5+(o-s):5-(s-o),i.avail_out=c<h?257+(h-c):257-(c-h),a.hold=I,a.bits=N},vi}var wi,Ua;function ap(){if(Ua)return wi;Ua=1;var t=ve(),e=15,n=852,i=592,r=0,a=1,s=2,o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],c=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],f=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];return wi=function(p,_,T,C,I,N,E,b){var y=b.bits,S=0,D=0,k=0,F=0,z=0,L=0,v=0,Z=0,P=0,Q=0,nt,it,W,st,q,V=null,It=0,Et,dt=new t.Buf16(e+1),Tt=new t.Buf16(e+1),ct=null,tt=0,ot,at,St;for(S=0;S<=e;S++)dt[S]=0;for(D=0;D<C;D++)dt[_[T+D]]++;for(z=y,F=e;F>=1&&dt[F]===0;F--);if(z>F&&(z=F),F===0)return I[N++]=1<<24|64<<16|0,I[N++]=1<<24|64<<16|0,b.bits=1,0;for(k=1;k<F&&dt[k]===0;k++);for(z<k&&(z=k),Z=1,S=1;S<=e;S++)if(Z<<=1,Z-=dt[S],Z<0)return-1;if(Z>0&&(p===r||F!==1))return-1;for(Tt[1]=0,S=1;S<e;S++)Tt[S+1]=Tt[S]+dt[S];for(D=0;D<C;D++)_[T+D]!==0&&(E[Tt[_[T+D]]++]=D);if(p===r?(V=ct=E,Et=19):p===a?(V=o,It-=257,ct=c,tt-=257,Et=256):(V=f,ct=h,Et=-1),Q=0,D=0,S=k,q=N,L=z,v=0,W=-1,P=1<<z,st=P-1,p===a&&P>n||p===s&&P>i)return 1;for(;;){ot=S-v,E[D]<Et?(at=0,St=E[D]):E[D]>Et?(at=ct[tt+E[D]],St=V[It+E[D]]):(at=96,St=0),nt=1<<S-v,it=1<<L,k=it;do it-=nt,I[q+(Q>>v)+it]=ot<<24|at<<16|St|0;while(it!==0);for(nt=1<<S-1;Q&nt;)nt>>=1;if(nt!==0?(Q&=nt-1,Q+=nt):Q=0,D++,--dt[S]===0){if(S===F)break;S=_[T+E[D]]}if(S>z&&(Q&st)!==W){for(v===0&&(v=z),q+=k,L=S-v,Z=1<<L;L+v<F&&(Z-=dt[L+v],!(Z<=0));)L++,Z<<=1;if(P+=1<<L,p===a&&P>n||p===s&&P>i)return 1;W=Q&st,I[W]=z<<24|L<<16|q-N|0}}return Q!==0&&(I[q+Q]=S-v<<24|64<<16|0),b.bits=z,0},wi}var Va;function sp(){if(Va)return Jt;Va=1;var t=ve(),e=yo(),n=xo(),i=rp(),r=ap(),a=0,s=1,o=2,c=4,f=5,h=6,m=0,p=1,_=2,T=-2,C=-3,I=-4,N=-5,E=8,b=1,y=2,S=3,D=4,k=5,F=6,z=7,L=8,v=9,Z=10,P=11,Q=12,nt=13,it=14,W=15,st=16,q=17,V=18,It=19,Et=20,dt=21,Tt=22,ct=23,tt=24,ot=25,at=26,St=27,Dt=28,Lt=29,X=30,_t=31,At=32,yt=852,xt=592,K=15,rt=K;function Ht(w){return(w>>>24&255)+(w>>>8&65280)+((w&65280)<<8)+((w&255)<<24)}function Zt(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new t.Buf16(320),this.work=new t.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function bt(w){var A;return!w||!w.state?T:(A=w.state,w.total_in=w.total_out=A.total=0,w.msg="",A.wrap&&(w.adler=A.wrap&1),A.mode=b,A.last=0,A.havedict=0,A.dmax=32768,A.head=null,A.hold=0,A.bits=0,A.lencode=A.lendyn=new t.Buf32(yt),A.distcode=A.distdyn=new t.Buf32(xt),A.sane=1,A.back=-1,m)}function pt(w){var A;return!w||!w.state?T:(A=w.state,A.wsize=0,A.whave=0,A.wnext=0,bt(w))}function ht(w,A){var u,B;return!w||!w.state||(B=w.state,A<0?(u=0,A=-A):(u=(A>>4)+1,A<48&&(A&=15)),A&&(A<8||A>15))?T:(B.window!==null&&B.wbits!==A&&(B.window=null),B.wrap=u,B.wbits=A,pt(w))}function ut(w,A){var u,B;return w?(B=new Zt,w.state=B,B.window=null,u=ht(w,A),u!==m&&(w.state=null),u):T}function $t(w){return ut(w,rt)}var G=!0,Mt,ft;function lt(w){if(G){var A;for(Mt=new t.Buf32(512),ft=new t.Buf32(32),A=0;A<144;)w.lens[A++]=8;for(;A<256;)w.lens[A++]=9;for(;A<280;)w.lens[A++]=7;for(;A<288;)w.lens[A++]=8;for(r(s,w.lens,0,288,Mt,0,w.work,{bits:9}),A=0;A<32;)w.lens[A++]=5;r(o,w.lens,0,32,ft,0,w.work,{bits:5}),G=!1}w.lencode=Mt,w.lenbits=9,w.distcode=ft,w.distbits=5}function Nt(w,A,u,B){var j,l=w.state;return l.window===null&&(l.wsize=1<<l.wbits,l.wnext=0,l.whave=0,l.window=new t.Buf8(l.wsize)),B>=l.wsize?(t.arraySet(l.window,A,u-l.wsize,l.wsize,0),l.wnext=0,l.whave=l.wsize):(j=l.wsize-l.wnext,j>B&&(j=B),t.arraySet(l.window,A,u-B,j,l.wnext),B-=j,B?(t.arraySet(l.window,A,u-B,B,0),l.wnext=B,l.whave=l.wsize):(l.wnext+=j,l.wnext===l.wsize&&(l.wnext=0),l.whave<l.wsize&&(l.whave+=j))),0}function g(w,A){var u,B,j,l,R,M,d,x,$,et,Y,J,gt,ce,Ct=0,vt,Gt,Vt,Wt,cn,fn,zt,Yt,Ut=new t.Buf8(4),fe,ae,Tr=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!w||!w.state||!w.output||!w.input&&w.avail_in!==0)return T;u=w.state,u.mode===Q&&(u.mode=nt),R=w.next_out,j=w.output,d=w.avail_out,l=w.next_in,B=w.input,M=w.avail_in,x=u.hold,$=u.bits,et=M,Y=d,Yt=m;t:for(;;)switch(u.mode){case b:if(u.wrap===0){u.mode=nt;break}for(;$<16;){if(M===0)break t;M--,x+=B[l++]<<$,$+=8}if(u.wrap&2&&x===35615){u.check=0,Ut[0]=x&255,Ut[1]=x>>>8&255,u.check=n(u.check,Ut,2,0),x=0,$=0,u.mode=y;break}if(u.flags=0,u.head&&(u.head.done=!1),!(u.wrap&1)||(((x&255)<<8)+(x>>8))%31){w.msg="incorrect header check",u.mode=X;break}if((x&15)!==E){w.msg="unknown compression method",u.mode=X;break}if(x>>>=4,$-=4,zt=(x&15)+8,u.wbits===0)u.wbits=zt;else if(zt>u.wbits){w.msg="invalid window size",u.mode=X;break}u.dmax=1<<zt,w.adler=u.check=1,u.mode=x&512?Z:Q,x=0,$=0;break;case y:for(;$<16;){if(M===0)break t;M--,x+=B[l++]<<$,$+=8}if(u.flags=x,(u.flags&255)!==E){w.msg="unknown compression method",u.mode=X;break}if(u.flags&57344){w.msg="unknown header flags set",u.mode=X;break}u.head&&(u.head.text=x>>8&1),u.flags&512&&(Ut[0]=x&255,Ut[1]=x>>>8&255,u.check=n(u.check,Ut,2,0)),x=0,$=0,u.mode=S;case S:for(;$<32;){if(M===0)break t;M--,x+=B[l++]<<$,$+=8}u.head&&(u.head.time=x),u.flags&512&&(Ut[0]=x&255,Ut[1]=x>>>8&255,Ut[2]=x>>>16&255,Ut[3]=x>>>24&255,u.check=n(u.check,Ut,4,0)),x=0,$=0,u.mode=D;case D:for(;$<16;){if(M===0)break t;M--,x+=B[l++]<<$,$+=8}u.head&&(u.head.xflags=x&255,u.head.os=x>>8),u.flags&512&&(Ut[0]=x&255,Ut[1]=x>>>8&255,u.check=n(u.check,Ut,2,0)),x=0,$=0,u.mode=k;case k:if(u.flags&1024){for(;$<16;){if(M===0)break t;M--,x+=B[l++]<<$,$+=8}u.length=x,u.head&&(u.head.extra_len=x),u.flags&512&&(Ut[0]=x&255,Ut[1]=x>>>8&255,u.check=n(u.check,Ut,2,0)),x=0,$=0}else u.head&&(u.head.extra=null);u.mode=F;case F:if(u.flags&1024&&(J=u.length,J>M&&(J=M),J&&(u.head&&(zt=u.head.extra_len-u.length,u.head.extra||(u.head.extra=new Array(u.head.extra_len)),t.arraySet(u.head.extra,B,l,J,zt)),u.flags&512&&(u.check=n(u.check,B,J,l)),M-=J,l+=J,u.length-=J),u.length))break t;u.length=0,u.mode=z;case z:if(u.flags&2048){if(M===0)break t;J=0;do zt=B[l+J++],u.head&&zt&&u.length<65536&&(u.head.name+=String.fromCharCode(zt));while(zt&&J<M);if(u.flags&512&&(u.check=n(u.check,B,J,l)),M-=J,l+=J,zt)break t}else u.head&&(u.head.name=null);u.length=0,u.mode=L;case L:if(u.flags&4096){if(M===0)break t;J=0;do zt=B[l+J++],u.head&&zt&&u.length<65536&&(u.head.comment+=String.fromCharCode(zt));while(zt&&J<M);if(u.flags&512&&(u.check=n(u.check,B,J,l)),M-=J,l+=J,zt)break t}else u.head&&(u.head.comment=null);u.mode=v;case v:if(u.flags&512){for(;$<16;){if(M===0)break t;M--,x+=B[l++]<<$,$+=8}if(x!==(u.check&65535)){w.msg="header crc mismatch",u.mode=X;break}x=0,$=0}u.head&&(u.head.hcrc=u.flags>>9&1,u.head.done=!0),w.adler=u.check=0,u.mode=Q;break;case Z:for(;$<32;){if(M===0)break t;M--,x+=B[l++]<<$,$+=8}w.adler=u.check=Ht(x),x=0,$=0,u.mode=P;case P:if(u.havedict===0)return w.next_out=R,w.avail_out=d,w.next_in=l,w.avail_in=M,u.hold=x,u.bits=$,_;w.adler=u.check=1,u.mode=Q;case Q:if(A===f||A===h)break t;case nt:if(u.last){x>>>=$&7,$-=$&7,u.mode=St;break}for(;$<3;){if(M===0)break t;M--,x+=B[l++]<<$,$+=8}switch(u.last=x&1,x>>>=1,$-=1,x&3){case 0:u.mode=it;break;case 1:if(lt(u),u.mode=Et,A===h){x>>>=2,$-=2;break t}break;case 2:u.mode=q;break;case 3:w.msg="invalid block type",u.mode=X}x>>>=2,$-=2;break;case it:for(x>>>=$&7,$-=$&7;$<32;){if(M===0)break t;M--,x+=B[l++]<<$,$+=8}if((x&65535)!==(x>>>16^65535)){w.msg="invalid stored block lengths",u.mode=X;break}if(u.length=x&65535,x=0,$=0,u.mode=W,A===h)break t;case W:u.mode=st;case st:if(J=u.length,J){if(J>M&&(J=M),J>d&&(J=d),J===0)break t;t.arraySet(j,B,l,J,R),M-=J,l+=J,d-=J,R+=J,u.length-=J;break}u.mode=Q;break;case q:for(;$<14;){if(M===0)break t;M--,x+=B[l++]<<$,$+=8}if(u.nlen=(x&31)+257,x>>>=5,$-=5,u.ndist=(x&31)+1,x>>>=5,$-=5,u.ncode=(x&15)+4,x>>>=4,$-=4,u.nlen>286||u.ndist>30){w.msg="too many length or distance symbols",u.mode=X;break}u.have=0,u.mode=V;case V:for(;u.have<u.ncode;){for(;$<3;){if(M===0)break t;M--,x+=B[l++]<<$,$+=8}u.lens[Tr[u.have++]]=x&7,x>>>=3,$-=3}for(;u.have<19;)u.lens[Tr[u.have++]]=0;if(u.lencode=u.lendyn,u.lenbits=7,fe={bits:u.lenbits},Yt=r(a,u.lens,0,19,u.lencode,0,u.work,fe),u.lenbits=fe.bits,Yt){w.msg="invalid code lengths set",u.mode=X;break}u.have=0,u.mode=It;case It:for(;u.have<u.nlen+u.ndist;){for(;Ct=u.lencode[x&(1<<u.lenbits)-1],vt=Ct>>>24,Gt=Ct>>>16&255,Vt=Ct&65535,!(vt<=$);){if(M===0)break t;M--,x+=B[l++]<<$,$+=8}if(Vt<16)x>>>=vt,$-=vt,u.lens[u.have++]=Vt;else{if(Vt===16){for(ae=vt+2;$<ae;){if(M===0)break t;M--,x+=B[l++]<<$,$+=8}if(x>>>=vt,$-=vt,u.have===0){w.msg="invalid bit length repeat",u.mode=X;break}zt=u.lens[u.have-1],J=3+(x&3),x>>>=2,$-=2}else if(Vt===17){for(ae=vt+3;$<ae;){if(M===0)break t;M--,x+=B[l++]<<$,$+=8}x>>>=vt,$-=vt,zt=0,J=3+(x&7),x>>>=3,$-=3}else{for(ae=vt+7;$<ae;){if(M===0)break t;M--,x+=B[l++]<<$,$+=8}x>>>=vt,$-=vt,zt=0,J=11+(x&127),x>>>=7,$-=7}if(u.have+J>u.nlen+u.ndist){w.msg="invalid bit length repeat",u.mode=X;break}for(;J--;)u.lens[u.have++]=zt}}if(u.mode===X)break;if(u.lens[256]===0){w.msg="invalid code -- missing end-of-block",u.mode=X;break}if(u.lenbits=9,fe={bits:u.lenbits},Yt=r(s,u.lens,0,u.nlen,u.lencode,0,u.work,fe),u.lenbits=fe.bits,Yt){w.msg="invalid literal/lengths set",u.mode=X;break}if(u.distbits=6,u.distcode=u.distdyn,fe={bits:u.distbits},Yt=r(o,u.lens,u.nlen,u.ndist,u.distcode,0,u.work,fe),u.distbits=fe.bits,Yt){w.msg="invalid distances set",u.mode=X;break}if(u.mode=Et,A===h)break t;case Et:u.mode=dt;case dt:if(M>=6&&d>=258){w.next_out=R,w.avail_out=d,w.next_in=l,w.avail_in=M,u.hold=x,u.bits=$,i(w,Y),R=w.next_out,j=w.output,d=w.avail_out,l=w.next_in,B=w.input,M=w.avail_in,x=u.hold,$=u.bits,u.mode===Q&&(u.back=-1);break}for(u.back=0;Ct=u.lencode[x&(1<<u.lenbits)-1],vt=Ct>>>24,Gt=Ct>>>16&255,Vt=Ct&65535,!(vt<=$);){if(M===0)break t;M--,x+=B[l++]<<$,$+=8}if(Gt&&(Gt&240)===0){for(Wt=vt,cn=Gt,fn=Vt;Ct=u.lencode[fn+((x&(1<<Wt+cn)-1)>>Wt)],vt=Ct>>>24,Gt=Ct>>>16&255,Vt=Ct&65535,!(Wt+vt<=$);){if(M===0)break t;M--,x+=B[l++]<<$,$+=8}x>>>=Wt,$-=Wt,u.back+=Wt}if(x>>>=vt,$-=vt,u.back+=vt,u.length=Vt,Gt===0){u.mode=at;break}if(Gt&32){u.back=-1,u.mode=Q;break}if(Gt&64){w.msg="invalid literal/length code",u.mode=X;break}u.extra=Gt&15,u.mode=Tt;case Tt:if(u.extra){for(ae=u.extra;$<ae;){if(M===0)break t;M--,x+=B[l++]<<$,$+=8}u.length+=x&(1<<u.extra)-1,x>>>=u.extra,$-=u.extra,u.back+=u.extra}u.was=u.length,u.mode=ct;case ct:for(;Ct=u.distcode[x&(1<<u.distbits)-1],vt=Ct>>>24,Gt=Ct>>>16&255,Vt=Ct&65535,!(vt<=$);){if(M===0)break t;M--,x+=B[l++]<<$,$+=8}if((Gt&240)===0){for(Wt=vt,cn=Gt,fn=Vt;Ct=u.distcode[fn+((x&(1<<Wt+cn)-1)>>Wt)],vt=Ct>>>24,Gt=Ct>>>16&255,Vt=Ct&65535,!(Wt+vt<=$);){if(M===0)break t;M--,x+=B[l++]<<$,$+=8}x>>>=Wt,$-=Wt,u.back+=Wt}if(x>>>=vt,$-=vt,u.back+=vt,Gt&64){w.msg="invalid distance code",u.mode=X;break}u.offset=Vt,u.extra=Gt&15,u.mode=tt;case tt:if(u.extra){for(ae=u.extra;$<ae;){if(M===0)break t;M--,x+=B[l++]<<$,$+=8}u.offset+=x&(1<<u.extra)-1,x>>>=u.extra,$-=u.extra,u.back+=u.extra}if(u.offset>u.dmax){w.msg="invalid distance too far back",u.mode=X;break}u.mode=ot;case ot:if(d===0)break t;if(J=Y-d,u.offset>J){if(J=u.offset-J,J>u.whave&&u.sane){w.msg="invalid distance too far back",u.mode=X;break}J>u.wnext?(J-=u.wnext,gt=u.wsize-J):gt=u.wnext-J,J>u.length&&(J=u.length),ce=u.window}else ce=j,gt=R-u.offset,J=u.length;J>d&&(J=d),d-=J,u.length-=J;do j[R++]=ce[gt++];while(--J);u.length===0&&(u.mode=dt);break;case at:if(d===0)break t;j[R++]=u.length,d--,u.mode=dt;break;case St:if(u.wrap){for(;$<32;){if(M===0)break t;M--,x|=B[l++]<<$,$+=8}if(Y-=d,w.total_out+=Y,u.total+=Y,Y&&(w.adler=u.check=u.flags?n(u.check,j,Y,R-Y):e(u.check,j,Y,R-Y)),Y=d,(u.flags?x:Ht(x))!==u.check){w.msg="incorrect data check",u.mode=X;break}x=0,$=0}u.mode=Dt;case Dt:if(u.wrap&&u.flags){for(;$<32;){if(M===0)break t;M--,x+=B[l++]<<$,$+=8}if(x!==(u.total&4294967295)){w.msg="incorrect length check",u.mode=X;break}x=0,$=0}u.mode=Lt;case Lt:Yt=p;break t;case X:Yt=C;break t;case _t:return I;case At:default:return T}return w.next_out=R,w.avail_out=d,w.next_in=l,w.avail_in=M,u.hold=x,u.bits=$,(u.wsize||Y!==w.avail_out&&u.mode<X&&(u.mode<St||A!==c))&&Nt(w,w.output,w.next_out,Y-w.avail_out),et-=w.avail_in,Y-=w.avail_out,w.total_in+=et,w.total_out+=Y,u.total+=Y,u.wrap&&Y&&(w.adler=u.check=u.flags?n(u.check,j,Y,w.next_out-Y):e(u.check,j,Y,w.next_out-Y)),w.data_type=u.bits+(u.last?64:0)+(u.mode===Q?128:0)+(u.mode===Et||u.mode===W?256:0),(et===0&&Y===0||A===c)&&Yt===m&&(Yt=N),Yt}function O(w){if(!w||!w.state)return T;var A=w.state;return A.window&&(A.window=null),w.state=null,m}function H(w,A){var u;return!w||!w.state||(u=w.state,(u.wrap&2)===0)?T:(u.head=A,A.done=!1,m)}function U(w,A){var u=A.length,B,j,l;return!w||!w.state||(B=w.state,B.wrap!==0&&B.mode!==P)?T:B.mode===P&&(j=1,j=e(j,A,u,0),j!==B.check)?C:(l=Nt(w,A,u,u),l?(B.mode=_t,I):(B.havedict=1,m))}return Jt.inflateReset=pt,Jt.inflateReset2=ht,Jt.inflateResetKeep=bt,Jt.inflateInit=$t,Jt.inflateInit2=ut,Jt.inflate=g,Jt.inflateEnd=O,Jt.inflateGetHeader=H,Jt.inflateSetDictionary=U,Jt.inflateInfo="pako inflate (from Nodeca project)",Jt}var yi,Za;function Eo(){return Za||(Za=1,yi={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}),yi}var xi,qa;function op(){if(qa)return xi;qa=1;function t(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}return xi=t,xi}var Wa;function lp(){if(Wa)return Le;Wa=1;var t=sp(),e=ve(),n=bo(),i=Eo(),r=br(),a=ko(),s=op(),o=Object.prototype.toString;function c(m){if(!(this instanceof c))return new c(m);this.options=e.assign({chunkSize:16384,windowBits:0,to:""},m||{});var p=this.options;p.raw&&p.windowBits>=0&&p.windowBits<16&&(p.windowBits=-p.windowBits,p.windowBits===0&&(p.windowBits=-15)),p.windowBits>=0&&p.windowBits<16&&!(m&&m.windowBits)&&(p.windowBits+=32),p.windowBits>15&&p.windowBits<48&&(p.windowBits&15)===0&&(p.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var _=t.inflateInit2(this.strm,p.windowBits);if(_!==i.Z_OK)throw new Error(r[_]);if(this.header=new s,t.inflateGetHeader(this.strm,this.header),p.dictionary&&(typeof p.dictionary=="string"?p.dictionary=n.string2buf(p.dictionary):o.call(p.dictionary)==="[object ArrayBuffer]"&&(p.dictionary=new Uint8Array(p.dictionary)),p.raw&&(_=t.inflateSetDictionary(this.strm,p.dictionary),_!==i.Z_OK)))throw new Error(r[_])}c.prototype.push=function(m,p){var _=this.strm,T=this.options.chunkSize,C=this.options.dictionary,I,N,E,b,y,S=!1;if(this.ended)return!1;N=p===~~p?p:p===!0?i.Z_FINISH:i.Z_NO_FLUSH,typeof m=="string"?_.input=n.binstring2buf(m):o.call(m)==="[object ArrayBuffer]"?_.input=new Uint8Array(m):_.input=m,_.next_in=0,_.avail_in=_.input.length;do{if(_.avail_out===0&&(_.output=new e.Buf8(T),_.next_out=0,_.avail_out=T),I=t.inflate(_,i.Z_NO_FLUSH),I===i.Z_NEED_DICT&&C&&(I=t.inflateSetDictionary(this.strm,C)),I===i.Z_BUF_ERROR&&S===!0&&(I=i.Z_OK,S=!1),I!==i.Z_STREAM_END&&I!==i.Z_OK)return this.onEnd(I),this.ended=!0,!1;_.next_out&&(_.avail_out===0||I===i.Z_STREAM_END||_.avail_in===0&&(N===i.Z_FINISH||N===i.Z_SYNC_FLUSH))&&(this.options.to==="string"?(E=n.utf8border(_.output,_.next_out),b=_.next_out-E,y=n.buf2string(_.output,E),_.next_out=b,_.avail_out=T-b,b&&e.arraySet(_.output,_.output,E,b,0),this.onData(y)):this.onData(e.shrinkBuf(_.output,_.next_out))),_.avail_in===0&&_.avail_out===0&&(S=!0)}while((_.avail_in>0||_.avail_out===0)&&I!==i.Z_STREAM_END);return I===i.Z_STREAM_END&&(N=i.Z_FINISH),N===i.Z_FINISH?(I=t.inflateEnd(this.strm),this.onEnd(I),this.ended=!0,I===i.Z_OK):(N===i.Z_SYNC_FLUSH&&(this.onEnd(i.Z_OK),_.avail_out=0),!0)},c.prototype.onData=function(m){this.chunks.push(m)},c.prototype.onEnd=function(m){m===i.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=e.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg};function f(m,p){var _=new c(p);if(_.push(m,!0),_.err)throw _.msg||r[_.err];return _.result}function h(m,p){return p=p||{},p.raw=!0,f(m,p)}return Le.Inflate=c,Le.inflate=f,Le.inflateRaw=h,Le.ungzip=f,Le}var bi,Xa;function cp(){if(Xa)return bi;Xa=1;var t=ve().assign,e=ip(),n=lp(),i=Eo(),r={};return t(r,e,n,i),bi=r,bi}var fp=cp();const hp=wr(fp);function up(t){let e=0;for(const n of t)e+=n.length;return e}function To(t){const e=new Uint8Array(up(t));let n=0;for(const i of t)e.set(i,n),n+=i.length;return e}const{Z_SYNC_FLUSH:So,Inflate:Ao}=hp;function dp(t,e){const n=e.subarray(0,Math.min(32,e.length));let i=0;const r=n.length;for(let a=0;a<r;a++)i=(i<<5)-i+n[a]&4294967295;return`${t}_${i}`}async function kr(t){try{let e,n=0,i;const r=[];do{const a=t.subarray(n);if(i=new Ao,{strm:e}=i,i.push(a,So),i.err)throw new Error(i.msg);n+=e.next_in,r.push(i.result)}while(e.avail_in);return To(r)}catch(e){throw/incorrect header check/.exec(`${e}`)?new Error("problem decompressing block: incorrect gzip header check"):e}}async function pp(t,e,n){try{let i;const{minv:r,maxv:a}=e;let s=r.blockPosition,o=r.dataPosition;const c=[],f=[],h=[];let m=0,p=!1;do{const _=t.subarray(s-r.blockPosition),T=dp(s,_);let C,I;const N=n?.get(T);if(N)C=N.buffer,I=N.nextIn,p=!0;else{const y=new Ao;if({strm:i}=y,y.push(_,So),y.err)throw new Error(y.msg);C=y.result,I=i.next_in,p=!1,n?.set(T,{buffer:C,nextIn:I})}c.push(C);let E=C.length;f.push(s),h.push(o),c.length===1&&r.dataPosition&&(c[0]=c[0].subarray(r.dataPosition),E=c[0].length);const b=s;if(s+=I,o+=E,b>=a.blockPosition){c[m]=c[m].subarray(0,a.blockPosition===r.blockPosition?a.dataPosition-r.dataPosition+1:a.dataPosition+1),f.push(s),h.push(o);break}m++}while(p?s<t.length+r.blockPosition:i.avail_in);return{buffer:To(c),cpositions:f,dpositions:h}}catch(i){throw/incorrect header check/.exec(`${i}`)?new Error("problem decompressing block: incorrect gzip header check"):i}}function Ka(t){return(typeof t=="object"&&t!==null&&"message"in t?t.message:`${t}`).replace(/\.$/,"")}class Ee{constructor(e,n={}){this.baseOverrides={},this.url=e;const i=n.fetch||globalThis.fetch.bind(globalThis);n.overrides&&(this.baseOverrides=n.overrides),this.fetchImplementation=i}async fetch(e,n){let i;try{i=await this.fetchImplementation(e,n)}catch(r){if(`${r}`.includes("Failed to fetch")){console.warn(`generic-filehandle: refetching ${e} to attempt to work around chrome CORS header caching bug`);try{i=await this.fetchImplementation(e,{...n,cache:"reload"})}catch(a){throw new Error(`${Ka(a)} fetching ${e}`,{cause:a})}}else throw new Error(`${Ka(r)} fetching ${e}`,{cause:r})}return i}async read(e,n,i={}){const{headers:r={},signal:a,overrides:s={}}=i;e<1/0?r.range=`bytes=${n}-${n+e}`:e===1/0&&n!==0&&(r.range=`bytes=${n}-`);const o=await this.fetch(this.url,{...this.baseOverrides,...s,headers:{...r,...s.headers,...this.baseOverrides.headers},method:"GET",redirect:"follow",mode:"cors",signal:a});if(!o.ok)throw new Error(`HTTP ${o.status} fetching ${this.url}`);if(o.status===200&&n===0||o.status===206){const c=await o.arrayBuffer(),f=o.headers.get("content-range"),h=/\/(\d+)$/.exec(f||"");return h?.[1]&&(this._stat={size:parseInt(h[1],10)}),new Uint8Array(c.slice(0,e))}throw o.status===200?new Error(`${this.url} fetch returned status 200, expected 206`):new Error(`HTTP ${o.status} fetching ${this.url}`)}async readFile(e={}){let n,i;typeof e=="string"?(n=e,i={}):(n=e.encoding,i=e,delete i.encoding);const{headers:r={},signal:a,overrides:s={}}=i,o=await this.fetch(this.url,{headers:r,method:"GET",redirect:"follow",mode:"cors",signal:a,...this.baseOverrides,...s});if(o.status!==200)throw new Error(`HTTP ${o.status} fetching ${this.url}`);if(n==="utf8")return o.text();if(n)throw new Error(`unsupported encoding: ${n}`);return new Uint8Array(await o.arrayBuffer())}async stat(){if(!this._stat&&(await this.read(10,0),!this._stat))throw new Error(`unable to determine size of file at ${this.url}`);return this._stat}async close(){}}class bn{readFile(){throw new Error("unimplemented")}read(){throw new Error("unimplemented")}close(){throw new Error("unimplemented")}}class qn{constructor(e,n,i,r){this.minv=e,this.maxv=n,this.bin=i,this._fetchedSize=r}toUniqueString(){return`${this.minv}..${this.maxv} (bin ${this.bin}, fetchedSize ${this.fetchedSize()})`}toString(){return this.toUniqueString()}compareTo(e){return this.minv.compareTo(e.minv)||this.maxv.compareTo(e.maxv)||this.bin-e.bin}fetchedSize(){return this._fetchedSize!==void 0?this._fetchedSize:this.maxv.blockPosition+65536-this.minv.blockPosition}}class No{constructor({filehandle:e,renameRefSeqs:n=i=>i}){this.filehandle=e,this.renameRefSeq=n}async getMetadata(e={}){const{indices:n,...i}=await this.parse(e);return i}_findFirstData(e,n){return e?e.compareTo(n)>0?n:e:n}async parse(e={}){return this.parseP||(this.parseP=this._parse(e).catch(n=>{throw this.parseP=void 0,n})),this.parseP}async hasRefSeq(e,n={}){return!!(await this.parse(n)).indices[e]?.binIndex}}const Ya=65536,_p=Ya*Ya;function Io(t,e=0){const n=t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24;return((t[e+4]|t[e+5]<<8|t[e+6]<<16|t[e+7]<<24)>>>0)*_p+(n>>>0)}class gp extends Error{}function Qe(t){if(t&&t.aborted)if(typeof DOMException>"u"){const e=new gp("aborted");throw e.code="ERR_ABORTED",e}else throw new DOMException("aborted","AbortError")}function mp(t,e){return e.minv.blockPosition-t.maxv.blockPosition<65e3&&e.maxv.blockPosition-t.minv.blockPosition<5e6}function $o(t,e){const n=[];let i;if(t.length===0)return t;t.sort(function(r,a){const s=r.minv.blockPosition-a.minv.blockPosition;return s===0?r.minv.dataPosition-a.minv.dataPosition:s});for(const r of t)(!e||r.maxv.compareTo(e)>0)&&(i===void 0?(n.push(r),i=r):mp(i,r)?r.maxv.compareTo(i.maxv)>0&&(i.maxv=r.maxv):(n.push(r),i=r));return n}class Er{constructor(e,n){this.blockPosition=e,this.dataPosition=n}toString(){return`${this.blockPosition}:${this.dataPosition}`}compareTo(e){return this.blockPosition-e.blockPosition||this.dataPosition-e.dataPosition}}function ze(t,e=0){return new Er(t[e+7]*1099511627776+t[e+6]*4294967296+t[e+5]*16777216+t[e+4]*65536+t[e+3]*256+t[e+2],t[e+1]<<8|t[e])}const vp=21582659,wp=38359875,yp={0:"generic",1:"SAM",2:"VCF"};function xp(t,e){return t*2**e}function Ja(t,e){return Math.floor(t/2**e)}class ki extends No{constructor(e){super(e),this.maxBinNumber=0,this.depth=0,this.minShift=0}async lineCount(e,n={}){const i=await this.parse(n),r=i.refNameToId[e];if(r===void 0||!i.indices[r])return-1;const{stats:s}=i.indices[r];return s?s.lineCount:-1}indexCov(){throw new Error("CSI indexes do not support indexcov")}parseAuxData(e,n){const i=new DataView(e.buffer),r=i.getInt32(n,!0),a=r&65536?"zero-based-half-open":"1-based-closed",s=yp[r&15];if(!s)throw new Error(`invalid Tabix preset format flags ${r}`);const o={ref:i.getInt32(n+4,!0),start:i.getInt32(n+8,!0),end:i.getInt32(n+12,!0)},c=i.getInt32(n+16,!0),f=c?String.fromCharCode(c):void 0,h=i.getInt32(n+20,!0),m=i.getInt32(n+24,!0),{refIdToName:p,refNameToId:_}=this._parseNameBytes(e.subarray(n+28,n+28+m));return{refIdToName:p,refNameToId:_,skipLines:h,metaChar:f,columnNumbers:o,format:s,coordinateType:a}}_parseNameBytes(e){let n=0,i=0;const r=[],a={},s=new TextDecoder("utf8");for(let o=0;o<e.length;o+=1)if(!e[o]){if(i<o){const c=this.renameRefSeq(s.decode(e.subarray(i,o)));r[n]=c,a[c]=n}i=o+1,n+=1}return{refNameToId:a,refIdToName:r}}async _parse(e={}){const n=await kr(await this.filehandle.readFile(e)),i=new DataView(n.buffer);let r;if(i.getUint32(0,!0)===vp)r=1;else if(i.getUint32(0,!0)===wp)r=2;else throw new Error("Not a CSI file");this.minShift=i.getInt32(4,!0),this.depth=i.getInt32(8,!0),this.maxBinNumber=((1<<(this.depth+1)*3)-1)/7;const a=2**(this.minShift+this.depth*3),s=i.getInt32(12,!0),o=s&&s>=30?this.parseAuxData(n,16):{refIdToName:[],refNameToId:{},metaChar:void 0,columnNumbers:{ref:0,start:1,end:2},coordinateType:"zero-based-half-open",format:"generic"},c=i.getInt32(16+s,!0);let f,h=16+s+4;const m=new Array(c).fill(0).map(()=>{const p=i.getInt32(h,!0);h+=4;const _={};let T;for(let C=0;C<p;C+=1){const I=i.getUint32(h,!0);if(I>this.maxBinNumber)T=this.parsePseudoBin(n,h+4),h+=48;else{const N=ze(n,h+4);f=this._findFirstData(f,N);const E=i.getInt32(h+12,!0);h+=16;const b=new Array(E);for(let y=0;y<E;y+=1){const S=ze(n,h),D=ze(n,h+8);h+=16,b[y]=new qn(S,D,I)}_[I]=b}}return{binIndex:_,stats:T}});return{...o,csi:!0,refCount:c,maxBlockSize:65536,firstDataLine:f,csiVersion:r,indices:m,depth:this.depth,maxBinNumber:this.maxBinNumber,maxRefLength:a}}parsePseudoBin(e,n){return{lineCount:Io(e,n+28)}}async blocksForRange(e,n,i,r={}){n<0&&(n=0);const a=await this.parse(r),s=a.refNameToId[e];if(s===void 0)return[];const o=a.indices[s];if(!o)return[];const c=this.reg2bins(n,i),f=[];for(const[h,m]of c)for(let p=h;p<=m;p++)if(o.binIndex[p])for(const _ of o.binIndex[p])f.push(new qn(_.minv,_.maxv,p));return $o(f,new Er(0,0))}reg2bins(e,n){e-=1,e<1&&(e=1),n>2**50&&(n=2**34),n-=1;let i=0,r=0,a=this.minShift+this.depth*3;const s=[];for(;i<=this.depth;a-=3,r+=xp(1,i*3),i+=1){const o=r+Ja(e,a),c=r+Ja(n,a);if(c-o+s.length>this.maxBinNumber)throw new Error(`query ${e}-${n} is too large for current binning scheme (shift ${this.minShift}, depth ${this.depth}), try a smaller query or a coarser index binning scheme`);s.push([o,c])}return s}}const bp=21578324,Qa=14;function kp(t,e){return t+=1,e-=1,[[0,0],[1+(t>>26),1+(e>>26)],[9+(t>>23),9+(e>>23)],[73+(t>>20),73+(e>>20)],[585+(t>>17),585+(e>>17)],[4681+(t>>14),4681+(e>>14)]]}class We extends No{async lineCount(e,n={}){const i=await this.parse(n),r=i.refNameToId[e];return r===void 0||!i.indices[r]?-1:i.indices[r].stats?.lineCount??-1}async _parse(e={}){const n=await this.filehandle.readFile(e),i=await kr(n);Qe(e.signal);const r=new DataView(i.buffer);if(r.getUint32(0,!0)!==bp)throw new Error("Not a TBI file");const s=r.getUint32(4,!0),o=r.getUint32(8,!0),c=o&65536?"zero-based-half-open":"1-based-closed",h={0:"generic",1:"SAM",2:"VCF"}[o&15];if(!h)throw new Error(`invalid Tabix preset format flags ${o}`);const m={ref:r.getInt32(12,!0),start:r.getInt32(16,!0),end:r.getInt32(20,!0)},p=r.getInt32(24,!0),_=5,T=((1<<(_+1)*3)-1)/7,C=2**(14+_*3),I=p?String.fromCharCode(p):void 0,N=r.getInt32(28,!0),E=r.getInt32(32,!0),{refNameToId:b,refIdToName:y}=this._parseNameBytes(i.slice(36,36+E));let S=36+E,D;return{indices:new Array(s).fill(0).map(()=>{const F=r.getInt32(S,!0);S+=4;const z={};let L;for(let P=0;P<F;P+=1){const Q=r.getUint32(S,!0);if(S+=4,Q>T+1)throw new Error("tabix index contains too many bins, please use a CSI index");if(Q===T+1){const nt=r.getInt32(S,!0);S+=4,nt===2&&(L=this.parsePseudoBin(i,S)),S+=16*nt}else{const nt=r.getInt32(S,!0);S+=4;const it=new Array(nt);for(let W=0;W<nt;W+=1){const st=ze(i,S),q=ze(i,S+8);S+=16,D=this._findFirstData(D,st),it[W]=new qn(st,q,Q)}z[Q]=it}}const v=r.getInt32(S,!0);S+=4;const Z=new Array(v);for(let P=0;P<v;P+=1)Z[P]=ze(i,S),S+=8,D=this._findFirstData(D,Z[P]);return{binIndex:z,linearIndex:Z,stats:L}}),metaChar:I,maxBinNumber:T,maxRefLength:C,skipLines:N,firstDataLine:D,columnNumbers:m,coordinateType:c,format:h,refIdToName:y,refNameToId:b,maxBlockSize:65536}}parsePseudoBin(e,n){return{lineCount:Io(e,n+16)}}_parseNameBytes(e){let n=0,i=0;const r=[],a={},s=new TextDecoder("utf8");for(let o=0;o<e.length;o+=1)if(!e[o]){if(i<o){const c=this.renameRefSeq(s.decode(e.subarray(i,o)));r[n]=c,a[c]=n}i=o+1,n+=1}return{refNameToId:a,refIdToName:r}}async blocksForRange(e,n,i,r={}){n<0&&(n=0);const a=await this.parse(r),s=a.refNameToId[e];if(s===void 0)return[];const o=a.indices[s];if(!o)return[];(o.linearIndex.length>0?o.linearIndex[n>>Qa>=o.linearIndex.length?o.linearIndex.length-1:n>>Qa]:new Er(0,0))||console.warn("querying outside of possible tabix range");const f=kp(n,i),h=[];for(const[C,I]of f)for(let N=C;N<=I;N++)if(o.binIndex[N])for(const E of o.binIndex[N])h.push(new qn(E.minv,E.maxv,N));const m=o.linearIndex.length;let p;const _=Math.min(n>>14,m-1),T=Math.min(i>>14,m-1);for(let C=_;C<=T;++C){const I=o.linearIndex[C];I&&(!p||I.compareTo(p)<0)&&(p=I)}return $o(h,p)}}function Ep(t){return/^[\u0000-\u007F]*$/.test(t)}class Tp{constructor({path:e,filehandle:n,url:i,tbiPath:r,tbiUrl:a,tbiFilehandle:s,csiPath:o,csiUrl:c,csiFilehandle:f,renameRefSeqs:h=p=>p,chunkCacheSize:m=5*2**20}){if(this.cache=new an({maxSize:1e3}),n)this.filehandle=n;else if(e)this.filehandle=new bn(e);else if(i)this.filehandle=new Ee(i);else throw new TypeError("must provide either filehandle or path");if(s)this.index=new We({filehandle:s,renameRefSeqs:h});else if(f)this.index=new ki({filehandle:f,renameRefSeqs:h});else if(r)this.index=new We({filehandle:new bn(r),renameRefSeqs:h});else if(o)this.index=new ki({filehandle:new bn(o),renameRefSeqs:h});else if(e)this.index=new We({filehandle:new bn(`${e}.tbi`),renameRefSeqs:h});else if(c)this.index=new ki({filehandle:new Ee(c)});else if(a)this.index=new We({filehandle:new Ee(a)});else if(i)this.index=new We({filehandle:new Ee(`${i}.tbi`)});else throw new TypeError("must provide one of tbiFilehandle, tbiPath, csiFilehandle, csiPath, tbiUrl, csiUrl");this.renameRefSeq=h,this.chunkCache=new Ie({cache:new an({maxSize:Math.floor(m/65536)}),fill:(p,_)=>this.readChunk(p,{signal:_})})}async getLines(e,n,i,r){let a,s={},o;typeof r=="function"?o=r:(s=r,o=r.lineCallback,a=r.signal);const c=await this.index.getMetadata(s);Qe(a);const f=n??0,h=i??c.maxRefLength;if(!(f<=h))throw new TypeError("invalid start and end coordinates. start must be less than or equal to end");if(f===h)return;const m=await this.index.blocksForRange(e,f,h,s);Qe(a);const p=new TextDecoder("utf8");for(const _ of m){const{buffer:T,cpositions:C,dpositions:I}=await this.chunkCache.get(_.toString(),_,a);Qe(a);let N=0,E=0;const b=p.decode(T),y=Ep(b);for(;N<b.length;){let S,D;if(y){if(D=b.indexOf(`
`,N),D===-1)break;S=b.slice(N,D)}else{if(D=T.indexOf(10,N),D===-1)break;const z=T.slice(N,D);S=p.decode(z)}if(I){for(;N+_.minv.dataPosition>=I[E++];);E--}const{startCoordinate:k,overlaps:F}=this.checkLine(c,e,f,h,S);if(F)o(S,C[E]*256+(N-I[E])+_.minv.dataPosition+1);else if(k!==void 0&&k>=h)return;N=D+1}}}async getMetadata(e={}){return this.index.getMetadata(e)}async getHeaderBuffer(e={}){const{firstDataLine:n,metaChar:i,maxBlockSize:r}=await this.getMetadata(e);Qe(e.signal);const a=(n?.blockPosition||0)+r,s=await this.filehandle.read(a,0,e),o=await kr(s);if(i){let c=-1;const f=10,h=i.charCodeAt(0);for(let m=0,p=o.length;m<p;m++){const _=o[m];if(m===c+1&&_!==h)break;_===f&&(c=m)}return o.subarray(0,c+1)}return o}async getHeader(e={}){const n=new TextDecoder("utf8"),i=await this.getHeaderBuffer(e);return n.decode(i)}async getReferenceSequenceNames(e={}){return(await this.getMetadata(e)).refIdToName}checkLine(e,n,i,r,a){const{columnNumbers:s,metaChar:o,coordinateType:c,format:f}=e;if(o&&a.startsWith(o))return{overlaps:!1};let{ref:h,start:m,end:p}=s;h||(h=0),m||(m=0),p||(p=0),f==="VCF"&&(p=8);const _=Math.max(h,m,p);let T=1,C=0,I="",N=-1/0;const E=a.length;for(let b=0;b<E+1;b++)if(a[b]==="	"||b===E){if(T===h){if(this.renameRefSeq(a.slice(C,b))!==n)return{overlaps:!1}}else if(T===m){if(N=Number.parseInt(a.slice(C,b),10),c==="1-based-closed"&&(N-=1),N>=r)return{startCoordinate:N,overlaps:!1};if((p===0||p===m)&&N+1<=i)return{startCoordinate:N,overlaps:!1}}else if(f==="VCF"&&T===4)I=a.slice(C,b);else if(T===p&&(f==="VCF"?this._getVcfEnd(N,I,a.slice(C,b)):Number.parseInt(a.slice(C,b),10))<=i)return{overlaps:!1};if(C=b+1,T+=1,T>_)break}return{startCoordinate:N,overlaps:!0}}_getVcfEnd(e,n,i){let r=e+n.length;const a=i.includes("SVTYPE=TRA");if(i[0]!=="."&&!a){let s=";";for(let o=0;o<i.length;o+=1){if(s===";"&&i.slice(o,o+4)==="END="){let c=i.indexOf(";",o);c===-1&&(c=i.length),r=Number.parseInt(i.slice(o+4,c),10);break}s=i[o]}}else if(a)return e+1;return r}async lineCount(e,n={}){return this.index.lineCount(e,n)}async readChunk(e,n={}){const i=await this.filehandle.read(e.fetchedSize(),e.minv.blockPosition,n);return pp(i,e,this.cache)}}function Sp(t,e,n){const i=e.split("	"),r={};let a=0;if(t.includes("GT")){const s=t.split(":");if(s.length===1)for(const o of n)r[o]=i[a++];else{const o=s.indexOf("GT");if(o===0)for(const c of n){const f=i[a++],h=f.indexOf(":");r[c]=h!==-1?f.slice(0,h):f}else for(const c of n){const f=i[a++].split(":");r[c]=f[o]}}}return r}function Ap(t){const e=[];let n="",i=!1,r=!1;for(const a of t)a==='"'?(i=!i,n+=a):a==="["?(r=!0,n+=a):a==="]"?(r=!1,n+=a):a===","&&!i&&!r?(e.push(n.trim()),n=""):n+=a;return n&&e.push(n.trim()),e}function Np(t,e){const n=t.indexOf(e);return[t.slice(0,n),t.slice(n+1)]}function Ip(t){const e=t.replace(/^<|>$/g,"");return Object.fromEntries(Ap(e).map(n=>{const[i,r]=Np(n,"=");return r&&r.startsWith("[")&&r.endsWith("]")?[i,r.slice(1,-1).split(",").map(a=>a.trim())]:r&&r.startsWith('"')&&r.endsWith('"')?[i,r.slice(1,-1)]:[i,r?.replaceAll(/^"|"$/g,"")]}))}const kn={InfoFields:{AA:{Number:1,Type:"String",Description:"Ancestral allele"},AC:{Number:"A",Type:"Integer",Description:"Allele count in genotypes, for each ALT allele, in the same order as listed"},AD:{Number:"R",Type:"Integer",Description:"Total read depth for each allele"},ADF:{Number:"R",Type:"Integer",Description:"Read depth for each allele on the forward strand"},ADR:{Number:"R",Type:"Integer",Description:"Read depth for each allele on the reverse strand"},AF:{Number:"A",Type:"Float",Description:"Allele frequency for each ALT allele in the same order as listed (estimated from primary data, not called genotypes)"},AN:{Number:1,Type:"Integer",Description:"Total number of alleles in called genotypes"},BQ:{Number:1,Type:"Float",Description:"RMS base quality"},CIGAR:{Number:1,Type:"Float",Description:"Cigar string describing how to align an alternate allele to the reference allele"},DB:{Number:0,Type:"Flag",Description:"dbSNP membership"},DP:{Number:1,Type:"Integer",Description:"combined depth across samples"},END:{Number:1,Type:"Integer",Description:"End position (for use with symbolic alleles)"},H2:{Number:0,Type:"Flag",Description:"HapMap2 membership"},H3:{Number:0,Type:"Flag",Description:"HapMap3 membership"},MQ:{Number:1,Type:null,Description:"RMS mapping quality"},MQ0:{Number:1,Type:"Integer",Description:"Number of MAPQ == 0 reads"},NS:{Number:1,Type:"Integer",Description:"Number of samples with data"},SB:{Number:4,Type:"Integer",Description:"Strand bias"},SOMATIC:{Number:0,Type:"Flag",Description:"Somatic mutation (for cancer genomics)"},VALIDATED:{Number:0,Type:"Flag",Description:"Validated by follow-up experiment"},"1000G":{Number:0,Type:"Flag",Description:"1000 Genomes membership"},IMPRECISE:{Number:0,Type:"Flag",Description:"Imprecise structural variation"},NOVEL:{Number:0,Type:"Flag",Description:"Indicates a novel structural variation"},SVTYPE:{Number:1,Type:"String",Description:"Type of structural variant"},SVLEN:{Number:null,Type:"Integer",Description:"Difference in length between REF and ALT alleles"},CIPOS:{Number:2,Type:"Integer",Description:"Confidence interval around POS for imprecise variants"},CIEND:{Number:2,Type:"Integer",Description:"Confidence interval around END for imprecise variants"},HOMLEN:{Type:"Integer",Description:"Length of base pair identical micro-homology at event breakpoints"},HOMSEQ:{Type:"String",Description:"Sequence of base pair identical micro-homology at event breakpoints"},BKPTID:{Type:"String",Description:"ID of the assembled alternate allele in the assembly file"},MEINFO:{Number:4,Type:"String",Description:"Mobile element info of the form NAME,START,END,POLARITY"},METRANS:{Number:4,Type:"String",Description:"Mobile element transduction info of the form CHR,START,END,POLARITY"},DGVID:{Number:1,Type:"String",Description:"ID of this element in Database of Genomic Variation"},DBVARID:{Number:1,Type:"String",Description:"ID of this element in DBVAR"},DBRIPID:{Number:1,Type:"String",Description:"ID of this element in DBRIP"},MATEID:{Number:null,Type:"String",Description:"ID of mate breakends"},PARID:{Number:1,Type:"String",Description:"ID of partner breakend"},EVENT:{Number:1,Type:"String",Description:"ID of event associated to breakend"},CILEN:{Number:2,Type:"Integer",Description:"Confidence interval around the inserted material between breakend"},DPADJ:{Type:"Integer",Description:"Read Depth of adjacency"},CN:{Number:1,Type:"Integer",Description:"Copy number of segment containing breakend"},CNADJ:{Number:null,Type:"Integer",Description:"Copy number of adjacency"},CICN:{Number:2,Type:"Integer",Description:"Confidence interval around copy number for the segment"},CICNADJ:{Number:null,Type:"Integer",Description:"Confidence interval around copy number for the adjacency"}},GenotypeFields:{AD:{Number:"R",Type:"Integer",Description:"Read depth for each allele"},ADF:{Number:"R",Type:"Integer",Description:"Read depth for each allele on the forward strand"},ADR:{Number:"R",Type:"Integer",Description:"Read depth for each allele on the reverse strand"},DP:{Number:1,Type:"Integer",Description:"Read depth"},EC:{Number:"A",Type:"Integer",Description:"Expected alternate allele counts"},FT:{Number:1,Type:"String",Description:'Filter indicating if this genotype was "called"'},GL:{Number:"G",Type:"Float",Description:"Genotype likelihoods"},GP:{Number:"G",Type:"Float",Description:"Genotype posterior probabilities"},GQ:{Number:1,Type:"Integer",Description:"Conditional genotype quality"},GT:{Number:1,Type:"String",Description:"Genotype"},HQ:{Number:2,Type:"Integer",Description:"Haplotype quality"},MQ:{Number:1,Type:"Integer",Description:"RMS mapping quality"},PL:{Number:"G",Type:"Integer",Description:"Phred-scaled genotype likelihoods rounded to the closest integer"},PQ:{Number:1,Type:"Integer",Description:"Phasing quality"},PS:{Number:1,Type:"Integer",Description:"Phase set"}},AltTypes:{DEL:{Description:"Deletion relative to the reference"},INS:{Description:"Insertion of novel sequence relative to the reference"},DUP:{Description:"Region of elevated copy number relative to the reference"},INV:{Description:"Inversion of reference sequence"},CNV:{Description:"Copy number variable region (may be both deletion and duplication)"},"DUP:TANDEM":{Description:"Tandem duplication"},"DEL:ME":{Description:"Deletion of mobile element relative to the reference"},"INS:ME":{Description:"Insertion of a mobile element relative to the reference"},NON_REF:{Description:"Represents any possible alternative allele at this location"},"*":{Description:"Represents any possible alternative allele at this location"}},FilterTypes:{PASS:{Description:"Passed all filters"}}};function $p(t){try{return decodeURIComponent(t)}catch{return t}}class Rp{constructor({header:e="",strict:n=!0}){if(!e.length)throw new Error("empty header received");const i=e.split(/[\r\n]+/).filter(Boolean);if(!i.length)throw new Error("no non-empty header lines specified");this.strict=n,this.metadata=JSON.parse(JSON.stringify({INFO:kn.InfoFields,FORMAT:kn.GenotypeFields,ALT:kn.AltTypes,FILTER:kn.FilterTypes}));let r;if(i.forEach(c=>{if(c.startsWith("#"))c.startsWith("##")?this.parseMetadata(c):r=c;else throw new Error(`Bad line in header:
${c}`)}),!r)throw new Error("No format line found in header");const a=r.trim().split("	"),s=a.slice(0,8),o=["#CHROM","POS","ID","REF","ALT","QUAL","FILTER","INFO"];if(a.length<8)throw new Error(`VCF header missing columns:
${r}`);if(s.length!==o.length||!s.every((c,f)=>c===o[f]))throw new Error(`VCF column headers not correct:
${r}`);this.samples=a.slice(9)}parseSamples(e,n){const i={};if(e){const r=n.split("	"),a=e.split(":"),s=a.map(o=>{const c=this.getMetadata("FORMAT",o,"Type");return c==="Integer"||c==="Float"});for(let o=0;o<this.samples.length;o++){const c=this.samples[o];i[c]={};const f=r[o].split(":");for(let h=0;h<f.length;h++){const m=f[h];i[c][a[h]]=m===""||m==="."?void 0:m.split(",").map(p=>p==="."?void 0:s[h]?+p:p)}}}return i}parseMetadata(e){const n=/^##(.+?)=(.*)/.exec(e.trim());if(!n)throw new Error(`Line is not a valid metadata line: ${e}`);const[i,r]=n.slice(1,3),a=i;if(r?.startsWith("<")){a in this.metadata||(this.metadata[a]={});const[s,o]=this.parseStructuredMetaVal(r);s?this.metadata[a][s]=o:this.metadata[a]=o}else this.metadata[a]=r}parseStructuredMetaVal(e){const n=Ip(e),i=n.ID;return delete n.ID,"Number"in n&&(Number.isNaN(Number(n.Number))||(n.Number=Number(n.Number))),[i,n]}getMetadata(...e){let n=this.metadata;for(const i of e)if(n=n[i],!n)return n;return n}parseLine(e){let n=0;for(let D=0;n<e.length&&(e[n]==="	"&&(D+=1),D!==9);n+=1);const i=e.slice(0,n).split("	"),r=e.slice(n+1),[a,s,o,c,f,h,m]=i,p=a,_=+s,T=o==="."?void 0:o.split(";"),C=c,I=f==="."?void 0:f.split(","),N=h==="."?void 0:+h,E=m==="."?void 0:m.split(";"),b=i[8];if(this.strict&&!i[7])throw new Error("no INFO field specified, must contain at least a '.' (turn off strict mode to allow)");const y=i[7]?.includes("%"),S=i[7]===void 0||i[7]==="."?{}:Object.fromEntries(i[7].split(";").map(D=>{const[k,F]=D.split("="),z=F?.split(",").map(v=>v==="."?void 0:v).map(v=>v&&y?$p(v):v),L=this.getMetadata("INFO",k,"Type");return L==="Integer"||L==="Float"?[k,z?.map(v=>v===void 0?void 0:Number(v))]:L==="Flag"?[k,!0]:[k,z??!0]}));return{CHROM:p,POS:_,ALT:I,INFO:S,REF:C,FILTER:E&&E.length===1&&E[0]==="PASS"?"PASS":E,ID:T,QUAL:N,FORMAT:b,SAMPLES:()=>this.parseSamples(i[8]??"",r),GENOTYPES:()=>Sp(i[8]??"",r,this.samples)}}}function Dp(t){const e=t.split(/[[\]]/);if(e.length>1){const n=t.includes("[")?"right":"left";let i,r,a;for(const s of e)s&&(s.includes(":")?(a=s,i=r?"right":"left"):r=s);if(!(a&&i&&r))throw new Error(`Invalid breakend: ${t}`);return{MatePosition:a,Join:i,Replacement:r,MateDirection:n}}else{if(t.startsWith("."))return{Join:"left",SingleBreakend:!0,Replacement:t.slice(1)};if(t.endsWith("."))return{Join:"right",SingleBreakend:!0,Replacement:t.slice(0,-1)};if(t.startsWith("<")){const n=/<(.*)>(.*)/.exec(t);if(!n)throw new Error(`failed to parse ${t}`);const i=n[2];return i?{Join:"left",Replacement:i,MateDirection:"right",MatePosition:`<${n[1]}>:1`}:void 0}else if(t.includes("<")){const n=/(.*)<(.*)>/.exec(t);if(!n)throw new Error(`failed to parse ${t}`);const i=n[1];return i?{Join:"right",Replacement:i,MateDirection:"right",MatePosition:`<${n[2]}>:1`}:void 0}}}const Mp={DEL:"deletion",INS:"insertion",DUP:"duplication",INV:"inversion",INVDUP:"inverted_duplication",CNV:"copy_number_variation",TRA:"translocation","DUP:TANDEM":"tandem_duplication",NON_REF:"sequence_variant","*":"sequence_variant"};function Op(t,e,n){if(!e||e.length===0)return["remark","no alternative alleles"];const i=new Set;let r=new Set;if(e.forEach(a=>{let[s,o]=Ro(a,n);s||([s,o]=Lp(t,a)),s&&o&&(i.add(s),r.add(o))}),r.size>1){const a=[...r],s=new Set(a.map(o=>{const c=o.split("->");return c[1]?c[0]:o}).filter(o=>!!o));r=new Set([...s].map(o=>o.trim()).map(o=>{const c=a.map(f=>f.split("->").map(h=>h.trim())).map(f=>f[1]&&f[0]===o?f[1]:"").filter(f=>!!f);return c.length?`${o} -> ${c.join(",")}`:o}))}return i.size?[[...i].join(","),[...r].join(",")]:[]}function Ro(t,e){if(typeof t=="string"&&!t.startsWith("<"))return[];let n=Mp[t];if(!n&&e.getMetadata("ALT",t)&&(n="sequence_variant"),n)return[n,t];const i=t.split(":");return i.length>1?Ro(`<${i.slice(0,-1).join(":")}>`,e):[]}function Lp(t,e){if(Dp(e))return["breakend",e];if(t.length===1&&e.length===1)return["SNV",He("SNV",t,e)];if(e==="<INS>")return["insertion",e];if(e==="<DEL>")return["deletion",e];if(e==="<DUP>")return["duplication",e];if(e==="<CNV>")return["cnv",e];if(e==="<INV>")return["inversion",e];if(e==="<TRA>")return["translocation",e];if(e.includes("<"))return["sv",e];if(t.length===e.length)return t.split("").reverse().join("")===e?["inversion",He("inversion",t,e)]:["substitution",He("substitution",t,e)];if(t.length<=e.length){const i=e.length-t.length,r=i.toLocaleString("en-US");return["insertion",i>5?`${r}bp INS`:He("insertion",t,e)]}if(t.length>e.length){const i=t.length-e.length,r=i.toLocaleString("en-US");return["deletion",i>5?`${r}bp DEL`:He("deletion",t,e)]}return["indel",He("indel",t,e)]}function He(t,e,n){return`${t} ${e} -> ${n}`}function Hp(t,e){const{REF:n="",ALT:i,POS:r,CHROM:a,ID:s}=t,o=r-1,[c,f]=Op(n,i,e);return{refName:a,start:o,end:Cp(t),description:f,type:c,name:s?.join(","),aliases:s&&s.length>1?s.slice(1):void 0}}function Cp(t){const{POS:e,REF:n="",ALT:i}=t,r=i?.includes("<TRA>"),a=e-1;if(i?.some(o=>o.includes("<"))){const o=t.INFO;if(o.END&&!r)return+o.END[0]}return a+n.length}class Fp{constructor(e){this.variant=e.variant,this.parser=e.parser,this.data=Hp(this.variant,this.parser),this._id=e.id}get(e){return e==="samples"?this.variant.SAMPLES():e==="genotypes"?this.variant.GENOTYPES():this.data[e]??this.variant[e]}parent(){}children(){}id(){return this._id}toJSON(){const{SAMPLES:e,GENOTYPES:n,...i}=this.variant;return{uniqueId:this._id,...i,...this.data,samples:this.variant.SAMPLES()}}}async function Bp({url:t,indexUrl:e,indexType:n="TBI",region:i}){const r=e??t+(n==="TBI"?".tbi":".csi"),a=new Tp({tbiFilehandle:n==="TBI"?new Ee(r):void 0,csiFilehandle:n==="CSI"?new Ee(r):void 0,filehandle:new Ee(t)}),s=new Rp({header:await a.getHeader()}),o=[];let c=0;return await a.getLines(i.chromosome,i.start,i.end,{lineCallback:f=>{const h=s.parseLine(f),m=new Fp({variant:h,parser:s,id:`${c++}`}),p=m.get("INFO");o.push({id:m.get("ID"),reference_allele:m.get("REF"),alternative_alleles:{values:m.get("ALT")},name:m.get("name"),seqId:m.get("refName"),fmin:m.get("start"),fmax:m.get("end"),strand:1,source:"",type:ja(p.soTerm[0])??m.get("type"),...Object.fromEntries(Object.entries(p).map(([_,T])=>[_,{values:[JSON.stringify(T.map(C=>ja(C)))]}]))})}}),o}function ja(t){return t?.replace(/['"]+/g,"")}Re.prototype.first=function(){return Ot(this.nodes()[0])};Re.prototype.last=function(){return Ot(this.nodes()[this.size()-1])};class Pp{constructor(e,n,i,r){this.height=r,this.width=i,this.config=e,this.svg_target=n,this.viewer=this._initViewer(n),this.draw()}generateLegend(){return Kh()}get tracks(){return this.config.tracks??[]}get genome(){return this.config.genome}closeModal(){for(const e of document.getElementsByClassName("gfc-tooltip"))e.style.visibility="hidden"}setSelectedAlleles(e,n){const i=Ot(n);i.selectAll(".highlight").remove(),i.selectAll(".variant-deletion,.variant-SNV,.variant-insertion,.variant-delins").filter(r=>r.selected==="true").style("stroke",null).datum(r=>(r.selected="false",r)),fr(e,i)}_initViewer(e){Ot(e).selectAll("*").remove();const n=Ot(e),r=`${e.replace("#","")} main-view`,a={top:8,right:30,bottom:30,left:40};return n.attr("width",this.width).attr("height",this.height).append("g").attr("transform",`translate(${a.left},${a.top})`).attr("class",r),this.width=this.width-a.left-a.right,this.height=this.height-a.top-a.bottom,Ot(`${e} .main-view`)}getTracks(e){return e?this.tracks[0]:this.tracks}draw(){const e=this.width,n=this.config.transcriptTypes??Uh,i=this.config.variantTypes??Vh,r=this.config.binRatio??.01,a=this.config.region,s=this._configureRange(a.start,a.end,e),o=s.range,c=a.chromosome,f=this.config.variantFilter??[],h=this.config.isoformFilter??[],m=this.config.htpVariant??"",p=s.start,_=s.end;new Jh({viewer:this.viewer,track:{chromosome:c,start:p,end:_,range:s.range},height:this.height,width:e}).DrawOverviewTrack();let I=100;const N=this.config.showVariantLabel??!0,{viewer:E,genome:b,height:y,tracks:S}=this;S.map(D=>{const{variantData:k,trackData:F}=D;if(D.type===qe.ISOFORM_AND_VARIANT){const z=new Gi({viewer:E,height:y,width:e,transcriptTypes:n,variantTypes:i,showVariantLabel:N,trackData:F,variantData:k,variantFilter:f,binRatio:r,isoformFilter:h});I+=z.DrawTrack()}else if(D.type===qe.ISOFORM_EMBEDDED_VARIANT){const z=new Ui({viewer:E,height:y,width:e,transcriptTypes:n,variantData:k,trackData:F,variantTypes:i,showVariantLabel:N,variantFilter:f});I+=z.DrawTrack()}else if(D.type===qe.ISOFORM){const z=new Vi({region:a,viewer:E,height:y,width:e,genome:b,trackData:F,transcriptTypes:n,htpVariant:m});I+=z.DrawTrack()}else D.type===qe.VARIANT?new Wi({region:a,viewer:E,range:o,height:y,width:e}).DrawTrack():D.type===qe.VARIANT_GLOBAL?new Xi({region:a,viewer:E,track:{...D,range:o},height:y,width:e}).DrawTrack():console.error(`TrackType not found ${D.type}`);Ot(this.svg_target).attr("height",I)})}_configureRange(e,n,i){let r=null;const a=17;let s=0,o=[0,0];if(e===n){r=300,s=a*r,e=e-r/2-1,n=n+r/2;const c=Ot("#clip-rect").node().getBoundingClientRect().width/2+100;o=[c-s/2,c+s/2]}else return{range:[0,i],start:e,end:n};return{range:o,start:e,end:n}}}export{Pp as G,qe as T,Bp as a,zp as f};
